<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ansible | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Information about RedHat Ansible">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.55a61b91.css" as="style"><link rel="preload" href="/assets/js/app.679df8d8.js" as="script"><link rel="preload" href="/assets/js/2.cf47c10a.js" as="script"><link rel="preload" href="/assets/js/18.24c6013a.js" as="script"><link rel="prefetch" href="/assets/js/10.1ec227fa.js"><link rel="prefetch" href="/assets/js/11.21b10bd4.js"><link rel="prefetch" href="/assets/js/12.ea3b75dc.js"><link rel="prefetch" href="/assets/js/13.fb347d9a.js"><link rel="prefetch" href="/assets/js/14.7eadcf3b.js"><link rel="prefetch" href="/assets/js/15.21afd8dd.js"><link rel="prefetch" href="/assets/js/16.8d13e142.js"><link rel="prefetch" href="/assets/js/17.935698e9.js"><link rel="prefetch" href="/assets/js/19.4f66cb80.js"><link rel="prefetch" href="/assets/js/20.e3d3b2df.js"><link rel="prefetch" href="/assets/js/21.fc4a6435.js"><link rel="prefetch" href="/assets/js/22.db597552.js"><link rel="prefetch" href="/assets/js/23.293323bd.js"><link rel="prefetch" href="/assets/js/24.e89c8b0e.js"><link rel="prefetch" href="/assets/js/25.fd57e472.js"><link rel="prefetch" href="/assets/js/26.952c5a88.js"><link rel="prefetch" href="/assets/js/27.2f1153ef.js"><link rel="prefetch" href="/assets/js/28.0bbc72e7.js"><link rel="prefetch" href="/assets/js/29.1b656496.js"><link rel="prefetch" href="/assets/js/3.17bc78ba.js"><link rel="prefetch" href="/assets/js/30.2056a64d.js"><link rel="prefetch" href="/assets/js/31.cbcbf420.js"><link rel="prefetch" href="/assets/js/32.605264a8.js"><link rel="prefetch" href="/assets/js/33.8728377b.js"><link rel="prefetch" href="/assets/js/34.a17a7de2.js"><link rel="prefetch" href="/assets/js/35.b673ca65.js"><link rel="prefetch" href="/assets/js/36.09bd2388.js"><link rel="prefetch" href="/assets/js/37.d4668cfc.js"><link rel="prefetch" href="/assets/js/38.08dbe132.js"><link rel="prefetch" href="/assets/js/39.bb5acebf.js"><link rel="prefetch" href="/assets/js/4.4cbfc58c.js"><link rel="prefetch" href="/assets/js/40.6a65d731.js"><link rel="prefetch" href="/assets/js/41.b1d4faa0.js"><link rel="prefetch" href="/assets/js/42.b71eeab2.js"><link rel="prefetch" href="/assets/js/43.af66eb1d.js"><link rel="prefetch" href="/assets/js/44.e539548e.js"><link rel="prefetch" href="/assets/js/45.00cf327b.js"><link rel="prefetch" href="/assets/js/46.6482a59c.js"><link rel="prefetch" href="/assets/js/47.ed7b9a73.js"><link rel="prefetch" href="/assets/js/48.7e4ad647.js"><link rel="prefetch" href="/assets/js/49.514e8fe8.js"><link rel="prefetch" href="/assets/js/5.3bdbf7d2.js"><link rel="prefetch" href="/assets/js/50.623f33bb.js"><link rel="prefetch" href="/assets/js/51.f0d02832.js"><link rel="prefetch" href="/assets/js/52.8e1750b5.js"><link rel="prefetch" href="/assets/js/53.63b92f61.js"><link rel="prefetch" href="/assets/js/54.9b731159.js"><link rel="prefetch" href="/assets/js/55.7954d3da.js"><link rel="prefetch" href="/assets/js/56.4096183a.js"><link rel="prefetch" href="/assets/js/57.1f894343.js"><link rel="prefetch" href="/assets/js/58.76d2a4eb.js"><link rel="prefetch" href="/assets/js/59.94746ee6.js"><link rel="prefetch" href="/assets/js/6.db5724cb.js"><link rel="prefetch" href="/assets/js/60.a38ced8d.js"><link rel="prefetch" href="/assets/js/61.d620fdb0.js"><link rel="prefetch" href="/assets/js/62.9fdf5d51.js"><link rel="prefetch" href="/assets/js/63.bc6f6a7c.js"><link rel="prefetch" href="/assets/js/64.b344af89.js"><link rel="prefetch" href="/assets/js/65.b1f943fa.js"><link rel="prefetch" href="/assets/js/66.4e29eea6.js"><link rel="prefetch" href="/assets/js/67.185321f4.js"><link rel="prefetch" href="/assets/js/68.771f22b3.js"><link rel="prefetch" href="/assets/js/69.1bf2ef7f.js"><link rel="prefetch" href="/assets/js/7.c18aa033.js"><link rel="prefetch" href="/assets/js/70.defb5b8f.js"><link rel="prefetch" href="/assets/js/71.e85c9ce8.js"><link rel="prefetch" href="/assets/js/72.34c54ec3.js"><link rel="prefetch" href="/assets/js/73.47647596.js"><link rel="prefetch" href="/assets/js/8.66e6de71.js"><link rel="prefetch" href="/assets/js/9.3213ddc2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55a61b91.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/dev-tools/" aria-current="page" class="sidebar-link">/dev-tools/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Ansible</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev-tools/ansible/ansible.html" aria-current="page" class="active sidebar-link">Ansible</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#manual-automation" class="sidebar-link">Manual -&gt; Automation</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#modules" class="sidebar-link">Modules</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#documentation" class="sidebar-link">Documentation</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#ad-hoc-commands" class="sidebar-link">Ad-hoc commands</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#playbooks" class="sidebar-link">Playbooks</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#multiple-hosts" class="sidebar-link">Multiple hosts</a></li><li class="sidebar-sub-header"><a href="/dev-tools/ansible/ansible.html#ansible-galaxy" class="sidebar-link">Ansible Galaxy</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azure</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="ansible"><a href="#ansible" class="header-anchor">#</a> Ansible</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>It is used for automation of configuration processes. You inform Ansible what is
the DESIRED state and Ansible will try to achieve it, no matter what the CURRENT
state is. Example: you want to have a file in a spcified location with a
specified content. There ar ea few possible starting points:</p> <ul><li>the file does not exist - Ansible will create it</li> <li>the file exist, but has a different content - Ansible will update the file</li> <li>the file exists and has the right contnet - Ansible will do nothing</li></ul> <h2 id="manual-automation"><a href="#manual-automation" class="header-anchor">#</a> Manual -&gt; Automation</h2> <p>Evolution of automation:</p> <ol><li>Manual setup</li> <li>Writing scripts (.sh, .ps, etc.)</li> <li>Using Ansible ad-hoc</li> <li>Writing Ansible playbooks</li></ol> <p>Difference between scripting and Ansible is that in a script we need to say
exactly what to do and cover various cases. Ansible takes care of these
difficulties. We just say what we want to have in the end and not how to do
that.</p> <h2 id="modules"><a href="#modules" class="header-anchor">#</a> Modules</h2> <p>Ansible relies on modules. There are many of them for various operations (like
for file operations, macOS setup, specific device setup, etc.).</p> <p>Most modules are idempotent, some are not.</p> <p>Every module can have some return values (i.e. a <code>file</code> module returns SHA
checksum of the file afer modifications, owner of the file and other things).</p> <h2 id="documentation"><a href="#documentation" class="header-anchor">#</a> Documentation</h2> <p><code>ansible-doc</code> command is useful, i.e. <code>ansible-doc copy</code> gives information about
<code>copy</code> module.</p> <h2 id="ad-hoc-commands"><a href="#ad-hoc-commands" class="header-anchor">#</a> Ad-hoc commands</h2> <p><code>ansible</code> command allows to run one chosen module with specified inputs.</p> <p><code>--dry-run</code> allows to see what the result would be without doing any actual
changes.</p> <h2 id="playbooks"><a href="#playbooks" class="header-anchor">#</a> Playbooks</h2> <p>Playbooks are defined in YAML files and contain tasks that should be done.</p> <p>Example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure ~/.gitconfig copied from master.gitconfig
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=&quot;../master.gitconfig&quot; dest=&quot;~/.gitconfig&quot;
</code></pre></div><p>We can have many &quot;plays&quot; in the same file:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure ~/.gitconfig copied from master.gitconfig
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=&quot;../master.gitconfig&quot; dest=&quot;~/.gitconfig&quot;
  
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Ensure homebrw packages are installed
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">homebrew</span><span class="token punctuation">:</span> name=bat state=latest
  <span class="token punctuation">-</span> <span class="token key atrule">homebrew</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> jq
      <span class="token key atrule">state</span><span class="token punctuation">:</span> latest
</code></pre></div><h3 id="tasks"><a href="#tasks" class="header-anchor">#</a> Tasks</h3> <p>The task's parameters can be defined in multiple ways, like the two homebrew
tasks above.</p> <p>Plays can have tags, which allow to limit the plays that we want to execute from
a given file (<code>tags</code>).</p> <p>A task can have a condition (<code>when</code>), i.e.: <code>when: ansible_os_family == 'RedHat'</code> will run the task only if the host's OS is in the Red Hat family.</p> <p>Task can have a <code>name</code>.</p> <p>Task can <code>ignore_errors: yes</code> to not stop the play if it fails.</p> <p>Tasks can store their outputs in variables with <code>register: my-variable</code> There is
a task that prints these variabes, it's called <code>debug</code>. i.e.: <code>debug: var=my-variable</code>. Outputs are in JOSN format and we are able to <code>debug</code> a
specific subset of it (<code>my-variable.some-parameter</code> ).</p> <h3 id="command-to-run-a-playbook"><a href="#command-to-run-a-playbook" class="header-anchor">#</a> Command to run a playbook</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>ansible-playbook my-playbook.yml
</code></pre></div><p><code>-v</code> flag shows more info. It can be added multiple times to increase verbosity
level.</p> <h2 id="multiple-hosts"><a href="#multiple-hosts" class="header-anchor">#</a> Multiple hosts</h2> <p>Although Ansible can work just with localhost, it is also suitable to configure
multiple hosts. They are referred to as <strong>INVENTORY</strong>.</p> <p>Inventory can be defined as a set of files in a chosen directory. They can be
grouped under various labels. This helps us to target subsets of our inventory.
&quot;all&quot; group is the top level group, contains all of the hosts.</p> <p>We can use both ad-hoc commnands and playbooks agains inventory. Example of an
ad-hoc command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ansible -m <span class="token builtin class-name">command</span> -a <span class="token string">&quot;git config --global --list&quot;</span> docker-containers
</code></pre></div><p>In the case above, I'd run the command agains hosts that are in the
&quot;docker-containers&quot; group (docker containers can be hosts!).</p> <p><code>ansible-inventory</code> command manages inventory.</p> <p><code>--list</code> shows all hosts in our inventory.</p> <h3 id="connections"><a href="#connections" class="header-anchor">#</a> Connections</h3> <p>We can use various connection types to reach hosts. For example, we could use
the <code>local</code> connection to create some docker containers on our localhost (with
the <code>docker_container</code> module) and then, use the <code>docker</code> connection to do
something on these containers.</p> <h3 id="ansible-pull"><a href="#ansible-pull" class="header-anchor">#</a> ansible-pull</h3> <p>Noramlly, there is a central Manager Node that runs the playbooks on the hosts
(push model). Ansible can also work in a different fashion. Each host can use
<code>ansible-pull</code> which connects to some VCS, pulls playbooks and runs them on the
host.</p> <h2 id="ansible-galaxy"><a href="#ansible-galaxy" class="header-anchor">#</a> Ansible Galaxy</h2> <p>Galaxy enables community to share <strong>ROLES</strong> and <strong>COLLECTIONS</strong> (kind of Roles
V2). These are constructs that sit between a module and a playbook.</p> <p>Galaxy is like a package source for Ansible (same as .NET and NuGet or Node.JS
and npm)</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/marcinjahn/knowledge-website/edit/main/src/docs/dev-tools/ansible/ansible.md" target="_blank" rel="noopener noreferrer">Feel free to contribute to this article!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/21/2021, 11:33:37 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev-tools/git/overview.html" class="prev">
        Git
      </a></span> <span class="next"><a href="/dev-tools/azure/azure-table-storage.html">
        Table Storage
      </a>
      →
    </span></p></div></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.679df8d8.js" defer></script><script src="/assets/js/2.cf47c10a.js" defer></script><script src="/assets/js/18.24c6013a.js" defer></script>
  </body>
</html>
