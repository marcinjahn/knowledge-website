<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux From Scratch | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Summary of Linux From Scratch (LFS) progress">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1d240715.css" as="style"><link rel="preload" href="/assets/js/app.731c80cd.js" as="script"><link rel="preload" href="/assets/js/2.2d09b89c.js" as="script"><link rel="preload" href="/assets/js/38.4345517b.js" as="script"><link rel="prefetch" href="/assets/js/10.7a29846c.js"><link rel="prefetch" href="/assets/js/11.606560b4.js"><link rel="prefetch" href="/assets/js/12.68a2c9a9.js"><link rel="prefetch" href="/assets/js/13.829bdf70.js"><link rel="prefetch" href="/assets/js/14.ae435171.js"><link rel="prefetch" href="/assets/js/15.e19c0473.js"><link rel="prefetch" href="/assets/js/16.ecf1ec64.js"><link rel="prefetch" href="/assets/js/17.73d658e6.js"><link rel="prefetch" href="/assets/js/18.6195f613.js"><link rel="prefetch" href="/assets/js/19.68b1bd09.js"><link rel="prefetch" href="/assets/js/20.1d21d8be.js"><link rel="prefetch" href="/assets/js/21.bd9ebf8d.js"><link rel="prefetch" href="/assets/js/22.b513595d.js"><link rel="prefetch" href="/assets/js/23.c4eacda9.js"><link rel="prefetch" href="/assets/js/24.40c1de51.js"><link rel="prefetch" href="/assets/js/25.d415056e.js"><link rel="prefetch" href="/assets/js/26.80f677c0.js"><link rel="prefetch" href="/assets/js/27.f90c04e9.js"><link rel="prefetch" href="/assets/js/28.f7745a4e.js"><link rel="prefetch" href="/assets/js/29.df8ea79a.js"><link rel="prefetch" href="/assets/js/3.70766294.js"><link rel="prefetch" href="/assets/js/30.6e588136.js"><link rel="prefetch" href="/assets/js/31.50130292.js"><link rel="prefetch" href="/assets/js/32.c52138ef.js"><link rel="prefetch" href="/assets/js/33.1c75a129.js"><link rel="prefetch" href="/assets/js/34.69aedd00.js"><link rel="prefetch" href="/assets/js/35.3979e7f9.js"><link rel="prefetch" href="/assets/js/36.21b2c4a6.js"><link rel="prefetch" href="/assets/js/37.4c84d24c.js"><link rel="prefetch" href="/assets/js/39.f881ff77.js"><link rel="prefetch" href="/assets/js/4.e97a937c.js"><link rel="prefetch" href="/assets/js/40.2881c2ec.js"><link rel="prefetch" href="/assets/js/41.cca929a1.js"><link rel="prefetch" href="/assets/js/42.43f5c523.js"><link rel="prefetch" href="/assets/js/43.cfec6037.js"><link rel="prefetch" href="/assets/js/44.4fc1c5f0.js"><link rel="prefetch" href="/assets/js/45.ca2a8a27.js"><link rel="prefetch" href="/assets/js/46.9edf4a23.js"><link rel="prefetch" href="/assets/js/47.0a2c69eb.js"><link rel="prefetch" href="/assets/js/48.d46698b6.js"><link rel="prefetch" href="/assets/js/49.a17a2e58.js"><link rel="prefetch" href="/assets/js/5.3e2e763d.js"><link rel="prefetch" href="/assets/js/50.529ad03b.js"><link rel="prefetch" href="/assets/js/51.2d17e38c.js"><link rel="prefetch" href="/assets/js/52.7d992df4.js"><link rel="prefetch" href="/assets/js/53.0791a38e.js"><link rel="prefetch" href="/assets/js/54.80275340.js"><link rel="prefetch" href="/assets/js/55.444f2b18.js"><link rel="prefetch" href="/assets/js/56.947e95e2.js"><link rel="prefetch" href="/assets/js/57.4ed1832a.js"><link rel="prefetch" href="/assets/js/58.cb7b4d46.js"><link rel="prefetch" href="/assets/js/59.d9b9c2fb.js"><link rel="prefetch" href="/assets/js/6.25c5ab12.js"><link rel="prefetch" href="/assets/js/60.43a769c5.js"><link rel="prefetch" href="/assets/js/61.33007dda.js"><link rel="prefetch" href="/assets/js/62.30124753.js"><link rel="prefetch" href="/assets/js/63.323703d1.js"><link rel="prefetch" href="/assets/js/64.a1b1e7f8.js"><link rel="prefetch" href="/assets/js/65.e17f981c.js"><link rel="prefetch" href="/assets/js/66.59c13a07.js"><link rel="prefetch" href="/assets/js/67.1bc676db.js"><link rel="prefetch" href="/assets/js/68.8a3e80a8.js"><link rel="prefetch" href="/assets/js/69.55345998.js"><link rel="prefetch" href="/assets/js/7.7634121c.js"><link rel="prefetch" href="/assets/js/70.70dd0983.js"><link rel="prefetch" href="/assets/js/71.d3029cdd.js"><link rel="prefetch" href="/assets/js/72.60b56ddd.js"><link rel="prefetch" href="/assets/js/73.47cfd64d.js"><link rel="prefetch" href="/assets/js/74.1c6a6f9a.js"><link rel="prefetch" href="/assets/js/75.599871ec.js"><link rel="prefetch" href="/assets/js/76.64f180f6.js"><link rel="prefetch" href="/assets/js/77.f4bbce9f.js"><link rel="prefetch" href="/assets/js/78.ef1de45b.js"><link rel="prefetch" href="/assets/js/79.12fd7a27.js"><link rel="prefetch" href="/assets/js/8.a560e3ec.js"><link rel="prefetch" href="/assets/js/80.217bd0b8.js"><link rel="prefetch" href="/assets/js/81.9eac747d.js"><link rel="prefetch" href="/assets/js/82.66efb0fb.js"><link rel="prefetch" href="/assets/js/83.78bfae85.js"><link rel="prefetch" href="/assets/js/84.50d37c6e.js"><link rel="prefetch" href="/assets/js/85.0b8c15fe.js"><link rel="prefetch" href="/assets/js/9.fb31b6db.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1d240715.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/dev-tools/" aria-current="page" class="sidebar-link">/dev-tools/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev-tools/linux/linux.html" class="sidebar-link">Gist of Linux Tooling</a></li><li><a href="/dev-tools/linux/containers.html" class="sidebar-link">Containerization</a></li><li><a href="/dev-tools/linux/bash-scripting.html" class="sidebar-link">Bash Scripting</a></li><li><a href="/dev-tools/linux/lfs.html" aria-current="page" class="active sidebar-link">Linux From Scratch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev-tools/linux/lfs.html#notes" class="sidebar-link">Notes</a></li><li class="sidebar-sub-header"><a href="/dev-tools/linux/lfs.html#issues" class="sidebar-link">Issues</a></li><li class="sidebar-sub-header"><a href="/dev-tools/linux/lfs.html#steps" class="sidebar-link">Steps</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azure</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="linux-from-scratch"><a href="#linux-from-scratch" class="header-anchor">#</a> Linux From Scratch</h1> <p>This is a breakdown of the LFS book.</p> <h2 id="notes"><a href="#notes" class="header-anchor">#</a> Notes</h2> <ul><li>sticky bit - file can be removed only by its owner even if directory is
accessible to multiple users. <code>/tmp</code> uses 777 with sticky-bit. Thanks to it
anyone is able to create/read/execute in <code>/tmp</code>, but only owner of a given
file can remove it.</li> <li>login and non-login shell - login shell loads <code>bash_profile</code> (which loads
other things like <code>.bashrc</code>). Non-login shell may be started only when login
shell session exists, and it loads <code>.bashrc</code> directly.</li></ul> <h3 id="cross-compilers"><a href="#cross-compilers" class="header-anchor">#</a> Cross-compilers</h3> <p>Cross-compiler is a compiler that builds programs on machine A, but the programs
are supposed to run on machine B.</p> <h3 id="toolchain"><a href="#toolchain" class="header-anchor">#</a> Toolchain</h3> <p>Some of the most important packages on linux:</p> <ul><li><em>binutils</em> - contains <code>ld</code> (linker) and <code>as</code> (assembler), and lots of other
tools</li> <li><em>glibc</em> - GNU standard C library (provides basic things like <code>open</code>, <code>read</code>,
<code>write</code>, <code>printf</code>, etc.).</li> <li><em>gcc</em> - GNU Compiler Collection (C and C++ among others)</li> <li><em>libgcc</em> - internal library used by GCC</li></ul> <p>The installation order:</p> <ol><li><em>binutils</em> - linker and assembler are required by gcc's and glibc's
<code>configure</code> scripts.</li> <li><em>gcc</em></li> <li>sanitized Linux API headers - allows glibc to interface with kernel's
features</li> <li><em>glibc</em></li> <li><em>libstdc++</em></li></ol> <h3 id="package-managers"><a href="#package-managers" class="header-anchor">#</a> Package Managers</h3> <p>Package manager tracks the files installed by applications making it easy to
update and remove software.</p> <p>Approaches:</p> <ul><li>installing each package in separate directory, and creating a symlink to
executable in some shared directory (e.g. <code>/usr</code>).</li> <li>timestamp-based - package manager records the time of package installation.
Later it can find package's files by looking at timestamp of the files on the
system. This will not work if multiple packages are being installed at the
same time.</li> <li>package archives - RPMs and DEBs use that. The package's structure is made in
an archive and recreated on the target system.</li></ul> <h2 id="issues"><a href="#issues" class="header-anchor">#</a> Issues</h2> <ul><li>Kernel 3.2 - I have 5.x...</li> <li>After downloading all packages from FTP, and checking their md5 I got the
following: <code>md5sum: man-pages-5.12.tar.xz: No such file or directory</code>. It
turns out that FTP had version 5.13 of that package only. Is it a problem?</li></ul> <h2 id="steps"><a href="#steps" class="header-anchor">#</a> Steps</h2> <h3 id="chapter-2-prerequisites"><a href="#chapter-2-prerequisites" class="header-anchor">#</a> Chapter 2 - prerequisites</h3> <ol><li>Install Ubuntu 20.04 in a VM (I used Gnome Boxes)</li> <li>Install all the missing packages (accoridng to version-check.sh)</li> <li>Create a new partition for LFS (~20GB) and mount it.</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> -pv <span class="token variable">$LFS</span>
<span class="token function">sudo</span> <span class="token function">mount</span> -v -t ext4 /dev/vda2 <span class="token variable">$LFS</span>
</code></pre></div><ol start="4"><li>Create <code>/sources</code> directory on the LFS partition.</li></ol> <h3 id="chapter-3-downloading-sources"><a href="#chapter-3-downloading-sources" class="header-anchor">#</a> Chapter 3 - downloading sources</h3> <ol><li>Download all software packages and patches from the FTP mirror of LFS, and
check md5 checksums.</li></ol> <h3 id="chapter-4-bootstrap-lfs-partition"><a href="#chapter-4-bootstrap-lfs-partition" class="header-anchor">#</a> Chapter 4 - bootstrap LFS partition</h3> <ol><li>Create some dirs in LFS partition (<code>/etc</code>, <code>/var</code>, <code>/lib64</code>, <code>/usr/bin</code>,
<code>/usr/sbin</code>, <code>/usr/lib</code>).</li> <li>Create <code>/tools</code> directory for cross-compiler to be installed in.</li> <li>Add <code>lfs</code> user and group to the host system.</li> <li><code>chown</code> directories in the LFS partition by the <code>lfs</code> user.</li> <li>Log in as <code>lfs</code> in a terminal session.</li> <li>Create <code>.bash_profile</code> and <code>.bashrc</code> files for <code>lfs</code> user.</li></ol> <h3 id="chapter-5-building-cross-compiler-and-its-associated-tools"><a href="#chapter-5-building-cross-compiler-and-its-associated-tools" class="header-anchor">#</a> Chapter 5 - building cross-compiler and its associated tools</h3> <ol><li>Build Binutils (pass 1)</li> <li>Build GCC (pass 1)</li> <li>Build sanitized Linux API headers</li> <li>Build glibc</li> <li>Build libstdc++ (pass 1)</li></ol> <h3 id="chapter-6-cross-compiling-temporary-tools"><a href="#chapter-6-cross-compiling-temporary-tools" class="header-anchor">#</a> Chapter 6 - cross-compiling temporary tools</h3> <ol><li>Build M4</li> <li>Build Ncurses</li> <li>Build Bash</li> <li>Build Coreutils</li> <li>Build Diffutils - by mistake I did make install before make. Later I rerun
make install. Is it OK?</li> <li>Build File - File on host needs to be in version 5.40? I have 5.38</li> <li>Build Findutils</li> <li>Build Gawk</li> <li>Build Grep</li> <li>Build Gzip</li> <li>Build Make</li> <li>Build Patch</li> <li>Build sed</li> <li>Build tar</li> <li>Build Xz</li> <li>Build Binutils (pass 2)</li> <li>Build GCC (pass 2)</li></ol> <h3 id="chapter-7-chroot"><a href="#chapter-7-chroot" class="header-anchor">#</a> Chapter 7 - chroot</h3> <ol><li>Change ownership of dirs in $LFS to root.</li> <li>Create console and null devices in $LFS/dev.</li> <li>Mount Virtual Kernel File Systems on $LFS (<code>dev</code>, <code>proc</code>, <code>sys</code>, <code>run</code>).</li> <li>Chroot on <code>$LFS</code> - <code>$LFS/etc/passwd</code> doesn't exist so &quot;I have no name!&quot; will
appear instead of user name in bash.</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">chroot</span> <span class="token string">&quot;<span class="token variable">$LFS</span>&quot;</span> /usr/bin/env -i <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span><span class="token string">&quot;<span class="token environment constant">$TERM</span>&quot;</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">'(lfs chroot) \u:\w\$ '</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/bin:/usr/sbin /bin/bash --login +h
</code></pre></div><ol start="6"><li>Create Linux directories according to FHS (Filesystem Hierarchy Standard).</li> <li>Link <code>/etc/mtab</code> to <code>/proc/self/mounts</code></li> <li>Create <code>/etc/hosts</code>.</li> <li>Create <code>/etc/passwd</code>.</li> <li>Create <code>/etc/group</code>.</li> <li>Create &quot;tester&quot; user (needed for some tests later on).</li> <li>Start a new shell to make use of the <code>/etc/passwd</code> and <code>/etc/group</code>. Shell
now properly shows &quot;root&quot; as a user.</li> <li>Create files for logs for various programs (login, agetty, init)</li> <li>Build Libstdc++ (pass 2).</li> <li>Build Gettext.</li> <li>Build Bison.</li> <li>Build Perl.</li> <li>Build Python.</li> <li>Build Texinfp.</li> <li>Build Util-linux</li> <li>Cleanup doc files and .la files</li> <li>Delete the <code>$LFS/tools</code> directory, we no longer need it.</li> <li>Backup current work (<code>$LFS</code>)</li></ol> <h3 id="chapter-8"><a href="#chapter-8" class="header-anchor">#</a> Chapter 8</h3> <ol><li>Build man-pages</li> <li>Copy Iana-Etc <code>services</code> and <code>protocols</code> to <code>/etc</code>.</li> <li>Build and test Glibc - hard to say if <code>make check</code> was successful or not (44
fails, 67 unsupported, 16 xfail)</li> <li>Install locales, timezones</li> <li>Build Zlib</li> <li>Build Bzip2</li> <li>Build Xz</li> <li>Build File</li> <li>Build Readline</li></ol> <p>page 116 (M4 is next)</p></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev-tools/linux/bash-scripting.html" class="prev">
        Bash Scripting
      </a></span> <span class="next"><a href="/dev-tools/kubernetes/meaning.html">
        Meaning and Purpose
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/marcinjahn/knowledge-website/edit/main/src/docs/dev-tools/linux/lfs.md" target="_blank" rel="noopener noreferrer">Feel free to contribute to this article!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/3/2022, 8:04:41 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.731c80cd.js" defer></script><script src="/assets/js/2.2d09b89c.js" defer></script><script src="/assets/js/38.4345517b.js" defer></script>
  </body>
</html>
