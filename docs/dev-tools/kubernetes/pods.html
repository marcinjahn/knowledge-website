<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pods | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Details about pods in Kubernetes">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.55a61b91.css" as="style"><link rel="preload" href="/assets/js/app.ee3c9f10.js" as="script"><link rel="preload" href="/assets/js/2.b60e0d97.js" as="script"><link rel="preload" href="/assets/js/33.4d163baa.js" as="script"><link rel="prefetch" href="/assets/js/10.91f6af3f.js"><link rel="prefetch" href="/assets/js/11.6e394153.js"><link rel="prefetch" href="/assets/js/12.2ee25d6e.js"><link rel="prefetch" href="/assets/js/13.1f0552e2.js"><link rel="prefetch" href="/assets/js/14.6b10c751.js"><link rel="prefetch" href="/assets/js/15.0d33d935.js"><link rel="prefetch" href="/assets/js/16.857f8d75.js"><link rel="prefetch" href="/assets/js/17.205ca6ae.js"><link rel="prefetch" href="/assets/js/18.d2cf5622.js"><link rel="prefetch" href="/assets/js/19.02f59b5a.js"><link rel="prefetch" href="/assets/js/20.1fc5f629.js"><link rel="prefetch" href="/assets/js/21.022c4f7f.js"><link rel="prefetch" href="/assets/js/22.fea67456.js"><link rel="prefetch" href="/assets/js/23.6194db4b.js"><link rel="prefetch" href="/assets/js/24.f1afe235.js"><link rel="prefetch" href="/assets/js/25.3dd960dc.js"><link rel="prefetch" href="/assets/js/26.b95da65f.js"><link rel="prefetch" href="/assets/js/27.bdc1cdfa.js"><link rel="prefetch" href="/assets/js/28.9eb5a270.js"><link rel="prefetch" href="/assets/js/29.7d084424.js"><link rel="prefetch" href="/assets/js/3.6883528a.js"><link rel="prefetch" href="/assets/js/30.62247752.js"><link rel="prefetch" href="/assets/js/31.a1342c47.js"><link rel="prefetch" href="/assets/js/32.4bc876f9.js"><link rel="prefetch" href="/assets/js/34.c74f9cd9.js"><link rel="prefetch" href="/assets/js/35.6e1b2055.js"><link rel="prefetch" href="/assets/js/36.911c9772.js"><link rel="prefetch" href="/assets/js/37.12b3d011.js"><link rel="prefetch" href="/assets/js/38.e37c8ee1.js"><link rel="prefetch" href="/assets/js/39.c097809e.js"><link rel="prefetch" href="/assets/js/4.bc343342.js"><link rel="prefetch" href="/assets/js/40.f45160df.js"><link rel="prefetch" href="/assets/js/41.3de8f9d2.js"><link rel="prefetch" href="/assets/js/42.c8f275ad.js"><link rel="prefetch" href="/assets/js/43.2078d71b.js"><link rel="prefetch" href="/assets/js/44.8cba5a54.js"><link rel="prefetch" href="/assets/js/45.3e7fc04d.js"><link rel="prefetch" href="/assets/js/46.f15690a3.js"><link rel="prefetch" href="/assets/js/47.ad1cfc5b.js"><link rel="prefetch" href="/assets/js/48.0b594905.js"><link rel="prefetch" href="/assets/js/49.05ad0860.js"><link rel="prefetch" href="/assets/js/5.1bc7e9e5.js"><link rel="prefetch" href="/assets/js/50.b6d40ca1.js"><link rel="prefetch" href="/assets/js/51.67d40ab4.js"><link rel="prefetch" href="/assets/js/52.be18f130.js"><link rel="prefetch" href="/assets/js/53.79bca8a8.js"><link rel="prefetch" href="/assets/js/54.eab52215.js"><link rel="prefetch" href="/assets/js/55.f0f7fa8f.js"><link rel="prefetch" href="/assets/js/56.230df938.js"><link rel="prefetch" href="/assets/js/57.472e361c.js"><link rel="prefetch" href="/assets/js/58.bb4b071b.js"><link rel="prefetch" href="/assets/js/59.c2957087.js"><link rel="prefetch" href="/assets/js/6.f1c20ec5.js"><link rel="prefetch" href="/assets/js/60.2f6a7fc0.js"><link rel="prefetch" href="/assets/js/61.e2fb0ad8.js"><link rel="prefetch" href="/assets/js/62.22b58fff.js"><link rel="prefetch" href="/assets/js/63.8d93ae64.js"><link rel="prefetch" href="/assets/js/64.7bd2d131.js"><link rel="prefetch" href="/assets/js/65.10153b84.js"><link rel="prefetch" href="/assets/js/66.e7256d45.js"><link rel="prefetch" href="/assets/js/67.54c0a875.js"><link rel="prefetch" href="/assets/js/68.054df3ed.js"><link rel="prefetch" href="/assets/js/69.d6de234a.js"><link rel="prefetch" href="/assets/js/7.872b32be.js"><link rel="prefetch" href="/assets/js/70.7f9a6f2c.js"><link rel="prefetch" href="/assets/js/71.e76db277.js"><link rel="prefetch" href="/assets/js/72.82537f8c.js"><link rel="prefetch" href="/assets/js/73.b11abd1c.js"><link rel="prefetch" href="/assets/js/74.1f21e43b.js"><link rel="prefetch" href="/assets/js/75.f232b150.js"><link rel="prefetch" href="/assets/js/76.8afc0fb4.js"><link rel="prefetch" href="/assets/js/77.ed720168.js"><link rel="prefetch" href="/assets/js/8.043f4088.js"><link rel="prefetch" href="/assets/js/9.3e83dab9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55a61b91.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link router-link-active">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/dev-tools/" aria-current="page" class="sidebar-link">/dev-tools/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dev-tools/kubernetes/meaning.html" class="sidebar-link">Meaning and Purpose</a></li><li><a href="/dev-tools/kubernetes/cluster.html" class="sidebar-link">Cluster</a></li><li><a href="/dev-tools/kubernetes/dev-env.html" class="sidebar-link">Dev Environment</a></li><li><a href="/dev-tools/kubernetes/api.html" class="sidebar-link">Kubernetes API</a></li><li><a href="/dev-tools/kubernetes/objects.html" class="sidebar-link">Objects</a></li><li><a href="/dev-tools/kubernetes/pods.html" aria-current="page" class="active sidebar-link">Pods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#networking" class="sidebar-link">Networking</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#logs" class="sidebar-link">Logs</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#accessing-pods" class="sidebar-link">Accessing Pods</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#init-containers" class="sidebar-link">Init Containers</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#lifecycle" class="sidebar-link">Lifecycle</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#probes" class="sidebar-link">Probes</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#hooks" class="sidebar-link">Hooks</a></li><li class="sidebar-sub-header"><a href="/dev-tools/kubernetes/pods.html#termination" class="sidebar-link">Termination</a></li></ul></li><li><a href="/dev-tools/kubernetes/deployments.html" class="sidebar-link">Deployments</a></li><li><a href="/dev-tools/kubernetes/services.html" class="sidebar-link">Services</a></li><li><a href="/dev-tools/kubernetes/events.html" class="sidebar-link">Events</a></li><li><a href="/dev-tools/kubernetes/storage.html" class="sidebar-link">Storage</a></li><li><a href="/dev-tools/kubernetes/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/dev-tools/kubernetes/organization.html" class="sidebar-link">Organizing Objects</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azure</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="pods"><a href="#pods" class="header-anchor">#</a> Pods</h1> <p>Each pod has its own IP, hostname, processes, network interfaces and other
resources.</p> <p>A pod contains one or more containers. These containers share a node and some
Linux namespaces (it's configurable, e.g. pod's containers by default do not
share PID namespace).</p> <p><img src="https://i.imgur.com/GmKGhhn.png" alt=""></p> <p>Sharing network namespaces by pod's containers:</p> <p><img src="https://i.imgur.com/uEDYRs9.png" alt=""></p> <p>It makes sense to have multiple containers in a pod if these containers need to
work together closely. The example below shows some web app and a sidecar
container providing TLS support:</p> <p><img src="https://i.imgur.com/j38h4ZB.png" alt=""></p> <p>Another example:</p> <p><img src="https://i.imgur.com/7475N9l.png" alt=""></p> <p>Containers in a single pod are scaled together.</p> <h2 id="networking"><a href="#networking" class="header-anchor">#</a> Networking</h2> <p>All pods can talk to each other, and they are reachable from any node. Pods may
define the ports they use in YAML, but they do not have to. It's only
informative (and it gives possibility to name the ports, which is useful when
creating Services for them).</p> <p>Checking if pod accepts requests:</p> <ul><li>SSH into any node, and try to curl the IP address of a pod</li> <li>create another Pod, get into it, and curl the other pod from it</li> <li><code>k port-forward &lt;pod-name&gt; &lt;pod-port&gt;</code> - it's the easiest thing to do, but the
most complex under the hood. It can also be used with Services.</li></ul> <p><img src="https://i.imgur.com/R8QArw1.png" alt=""></p> <h2 id="logs"><a href="#logs" class="header-anchor">#</a> Logs</h2> <p><code>k logs &lt;pod&gt;</code> - displays pod logs</p> <p>Options:</p> <ul><li><code>-f</code> for follow</li> <li><code>--timestamps</code> for timestamps</li> <li><code>-p</code> - logs from the previous instance of the pod (if died)</li></ul> <p>Deleting a pod deletes the logs as well. Logs are kept in <code>/var/log/containers</code>
on the nodes.</p> <h2 id="accessing-pods"><a href="#accessing-pods" class="header-anchor">#</a> Accessing Pods</h2> <ul><li><code>k cp kiada:html/index.html /tmp/index.html</code> - copying friles to/from
containers</li> <li><code>k exec &lt;pod&gt; -- ps aux</code> - execute a command in a pod (<code>-it</code> for interactive)</li> <li><code>k attach</code> - attaches to stdin, stderr, stdin (useful if pod's container
expects input). If stdin is not needed, it is not different than <code>k logs -f</code></li> <li>ephemeral containers - currently in Alpha</li></ul> <h2 id="init-containers"><a href="#init-containers" class="header-anchor">#</a> Init Containers</h2> <p>Pod can have <strong>init container(s)</strong> specified. They can start before the &quot;main&quot;
container(s), finish successfully, and only then the &quot;main&quot; container(s) start.</p> <p><img src="https://i.imgur.com/hViRCNQ.png" alt=""></p> <p>&quot;Main&quot; containers run in parallel. Init containers run consecutively (1 at a
time).</p> <p>Some usecases:</p> <ul><li>prepare some files on a volume for main container</li> <li>configure some networking</li> <li>delay container start until some condition is met</li> <li>notify some external service that the pod is starting</li></ul> <p>Init containers should work in an idempotent way.</p> <h2 id="lifecycle"><a href="#lifecycle" class="header-anchor">#</a> Lifecycle</h2> <p><img src="https://i.imgur.com/qF126K8.png" alt=""></p> <p>Pod's conditions (a part of &quot;status&quot;):</p> <p><img src="https://i.imgur.com/Yq0SLM6.png" alt=""></p> <p>Restart policies of pods:</p> <p><img src="https://i.imgur.com/lqVAMNq.png" alt=""></p> <p>These policies can be defined only on the pod level, not on the container level.</p> <p>When container dies and gets restarted, there is a varying delay before the
container starts:</p> <p><img src="https://i.imgur.com/VKxVqXl.png" alt=""></p> <p>First time is immediate, then it grows exponentially up to 5 minutes. This
behaviour is reset if the container has run successfully for at least 10
minutes.</p> <h2 id="probes"><a href="#probes" class="header-anchor">#</a> Probes</h2> <h3 id="liveness-probe"><a href="#liveness-probe" class="header-anchor">#</a> Liveness Probe</h3> <p>K8s automatically restarts container that crashes. However, there are situtions
when the app does not terminate, but is unhealthy (i.e., in a deadlock).</p> <p><strong>Liveness probe</strong> may be defined for every cotnainer in a pod. It is checked
periodically. If container does not respond, it is considered unhealthy and is
terminated (and restarted). They cannot be used with <em>init containers</em>.</p> <p>Types:</p> <ul><li>HTTP GET - response code between 200-399 is considered successful</li> <li>TCP socket - just a TCP connection is attempted</li> <li>Exec - executes a command inside of the container and checks exit code</li></ul> <p>Additional configurable parameters:</p> <p><img src="https://i.imgur.com/eJjyMxt.png" alt=""></p> <p>K8s does not mention anywhere that probe is successful. It could be logged by a
tested container by an app running on it.</p> <p>When probe fails, K8s tries to <strong>terminate</strong> the app gracefully (with TERM). If that
fails, it kills is forcefully (<code>kill -9</code>).</p> <h3 id="readiness-probe"><a href="#readiness-probe" class="header-anchor">#</a> Readiness Probe</h3> <p>It is used to check if the pod is ready to accept requests. Like Liveness Probe
supports three types.</p> <p>Containers without Readiness probe are considered Ready as soon as they are
started.</p> <p>If Readiness Probe fails, a pod is removed from
<a href="/dev-tools/kubernetes/services.html#endpoints">Endpoints</a> object of a service. It is not restarted,
like with the Liveness Probe.</p> <h3 id="startup-probe"><a href="#startup-probe" class="header-anchor">#</a> Startup Probe</h3> <p>Additional proble - <strong>Startup Probe</strong> may be added if the app is known to start
long. Then, separate configuration is used to check app health during startup.
We might define how long it should take for the app to start responding for
health checks. It's perfectly normal for the Startup probe to fail a couple
times initially. Successful Startup probe indicates that K8s should switch to
the <em>Liveness probe</em>. It is usually executed at shorted intervals making sure
the app is alive.</p> <p>Only after Complete Startup the container may become Ready (via the Readiness
Probe).</p> <p>Usually both probes use the same endpoint, but they can be different (or even
use different type).</p> <h2 id="hooks"><a href="#hooks" class="header-anchor">#</a> Hooks</h2> <p>There are two hooks:</p> <ul><li>post-start - run immediately after the container is started parallelly to it</li> <li>pre-stop</li></ul> <p><img src="https://i.imgur.com/0HjOp57.png" alt=""></p> <p>They are specified per container.</p> <blockquote><p>Init containes are similar to post-start hooks, but they're defined per pod.</p></blockquote> <p>They can be defined as HTTP GET, or as &quot;exec&quot; (just like probes). &quot;tcpSocket&quot; is
not supported.</p> <p>Container is in the &quot;Pending&quot; state until post-start is completed. Logs also
cannot be seen even though container is already running. If the hook fails, the
container is restarted.</p> <p>The post-start HTTP hook should not be used if we want to target the same
container with it (or the same pod in general). It could happen that the hook
will be executed before the webserver is started in the container. It will cause
a restart since HTTP request will fail. We end up in a restart loop. HTTP hook
is good for notifying some other apps about the container starting.</p> <p>The pre-stop hook is not invoked if the app terminates by itself.</p> <h2 id="termination"><a href="#termination" class="header-anchor">#</a> Termination</h2> <p>If the pod is to be killed, a <code>TERM</code> signal is sent to it. By default, 30s is
given for the container to shut down gracefully. It can be changed with the
<code>terminationGracePeriodSeconds</code> setting in <code>spec</code>. If the time passes and
container still lives, <code>KILL</code> is sent to it.</p> <p><img src="https://i.imgur.com/IAZMN8c.png" alt=""></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/marcinjahn/knowledge-website/edit/main/src/docs/dev-tools/kubernetes/pods.md" target="_blank" rel="noopener noreferrer">Feel free to contribute to this article!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/27/2021, 4:02:38 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/dev-tools/kubernetes/objects.html" class="prev">
        Objects
      </a></span> <span class="next"><a href="/dev-tools/kubernetes/deployments.html">
        Deployments
      </a>
      →
    </span></p></div></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ee3c9f10.js" defer></script><script src="/assets/js/2.b60e0d97.js" defer></script><script src="/assets/js/33.4d163baa.js" defer></script>
  </body>
</html>
