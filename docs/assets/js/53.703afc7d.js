(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{490:function(e,t,o){"use strict";o.r(t);var a=o(31),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"routing"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#routing"}},[e._v("#")]),e._v(" Routing")]),e._v(" "),o("p",[e._v("Routing is the process of mapping an incoming request to a handler (Razor Page,\nor an action on some MVC controller).")]),e._v(" "),o("p",[e._v("Routing uses URL's path to decide on the handler. It doesn't use query\nparameters. These are bound in the handler to parameters/properties.")]),e._v(" "),o("p",[o("code",[e._v("RoutingMiddleware")]),e._v(" is added to the app with:")]),e._v(" "),o("div",{staticClass:"language-cs extra-class"},[o("pre",{pre:!0,attrs:{class:"language-cs"}},[o("code",[e._v("app"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("UseRouing")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),o("p",[e._v("Routing is not case-sensitive")])]),e._v(" "),o("p",[e._v("This middleware is responsible for selecting the endpoint for a requests.\nEndpoints can be either MVC or Razor Pages (or some middleware). All of them\nneed to be registered with the "),o("code",[e._v("EndpointMiddleware")]),e._v(". That middleware has a\ndictionary of all registered endpoints, and it is shared with the\n"),o("code",[e._v("RoutingMiddleware")]),e._v('. Routing middleware looks through the dictionary for every\nrequests and makes a "note" about the selection in the '),o("code",[e._v("HttpContext")]),e._v(" object.\n"),o("code",[e._v("EndpointMiddleware")]),e._v(' looks at that "note" and executes the selected endpoint\nhandler.')]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("Separation of routing and execution")]),e._v(" "),o("p",[e._v("The process of selecting an endpoint and executing it are separated into\ndifferent middleware components. Thanks to it, we can add some other middleware\nbetween those. That middleware has access to the information which endpoint\nhandler was selected by the routing middleware. Example of that is the\n"),o("code",[e._v("AuthorizationMiddleware")]),e._v(", which can do some authorization based on the selected\nendpoint.")])]),e._v(" "),o("h2",{attrs:{id:"route-templates"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#route-templates"}},[e._v("#")]),e._v(" Route Templates")]),e._v(" "),o("p",[e._v("When defining routes, the template syntax is used making it possible to have\nsome parts of the URLs dynamic.")]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("Binding")]),e._v(" "),o("p",[e._v("Placeholder values from a URL can be used during model binding.")])]),e._v(" "),o("p",[e._v("Here are the options:")]),e._v(" "),o("ul",[o("li",[e._v("static URL, e.g. "),o("code",[e._v("/users")])]),e._v(" "),o("li",[e._v("placeholders, e.g. "),o("code",[e._v("/products/{productId}")])]),e._v(" "),o("li",[e._v("placeholder with defualt value, e.g. "),o("code",[e._v("/products/{productId=123}")]),e._v(' - when\nnavigating to "/products", a "/products/123" route will be taken')]),e._v(" "),o("li",[e._v("optional placegolder, e.g. "),o("code",[e._v("/products/{productId}/{color?}")]),e._v(" - optional\nparameters only make sense at the end of the route template.")])]),e._v(" "),o("h3",{attrs:{id:"constraints"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#constraints"}},[e._v("#")]),e._v(" Constraints")]),e._v(" "),o("p",[e._v("To avoid weird binding issues we can constraint dynamic parts of the template:")]),e._v(" "),o("ul",[o("li",[o("code",[e._v("/products/{id:int}")]),e._v(" - "),o("code",[e._v("id")]),e._v(" has to be convertible to an integer")]),e._v(" "),o("li",[o("code",[e._v("/products/{id:min(5)}")]),e._v(" - "),o("code",[e._v("id")]),e._v(" has to be integer and min 5.")]),e._v(" "),o("li",[o("code",[e._v("/products/{id:length(3)}")]),e._v(" - "),o("code",[e._v("id")]),e._v(" has to have 3 characters.")]),e._v(" "),o("li",[o("code",[e._v("/products/{id:int?}")]),e._v(" - "),o("code",[e._v("id")]),e._v(" is optional, but if provided it has to be\nconvertible to an integer")]),e._v(" "),o("li",[o("code",[e._v("/products/int:max(10)?")])])]),e._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",{staticClass:"custom-block-title"},[e._v("Binding Exceptions")]),e._v(" "),o("p",[e._v("If we have an unconstrained template "),o("code",[e._v("/products/{id}")]),e._v(" and our handler is\n"),o("code",[e._v("OnGet(int id)")]),e._v(', an exception would be thrown if we called "/products/test". The\nframework would try to bind "test" string to the '),o("code",[e._v("id")]),e._v(" parameter that is an\ninteger.")]),e._v(" "),o("p",[e._v("With proper constraints, that endpoint would be just skipped and not matched.")])]),e._v(" "),o("h2",{attrs:{id:"convention-vs-attributes"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#convention-vs-attributes"}},[e._v("#")]),e._v(" Convention vs Attributes")]),e._v(" "),o("p",[e._v("Routes can be defined either in a signle place making all endpoints follow some\nconvention, or we can use attributes on every action to define a route for that\nendpoint specifically. The latter apporach gives more freedom and makes it much\neasier to introduce changes for a specific endpoint.")]),e._v(" "),o("h3",{attrs:{id:"razor-pages"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#razor-pages"}},[e._v("#")]),e._v(" Razor Pages")]),e._v(" "),o("p",[e._v("Razor Pages uses a combination of convention and attribute-based routing. The\nroutes are created by the "),o("code",[e._v("MapRazorPages()")]),e._v(" extension method. All files in the\n"),o("code",[e._v("Pages")]),e._v(" direcotry are analyzed and routes are created for them based on their\nplacement.")]),e._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",{staticClass:"custom-block-title"},[e._v("Index")]),e._v(" "),o("p",[e._v("The "),o("code",[e._v("Index.cshtml")]),e._v(" files are an exception from that rule. They are mapped to\nboth "),o("code",[e._v("xyz/")]),e._v(" and "),o("code",[e._v("xyz/Index")]),e._v(" (we could have multiple "),o("code",[e._v("Index.cshtml")]),e._v(" files in\ndifferent directories).")])]),e._v(" "),o("p",[e._v("To customize the route of a given Razor Page, we need to modify the "),o("code",[e._v("@page")]),e._v("\ndirective of a given page. Some examples for a page at "),o("code",[e._v("Pages/Items.cshtml")]),e._v(":")]),e._v(" "),o("ul",[o("li",[o("code",[e._v('@page "Something"')]),e._v(' - the URL will be "/items/something" ('),o("strong",[e._v("appending")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v('@page "{category}/{productId}"')]),e._v(' - the URL will be "items/'),o("code",[e._v("{category}")]),e._v("/"),o("code",[e._v("{productId}")]),e._v('" ('),o("strong",[e._v("appending")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v('@page "/Something"')]),e._v(' - the URL will be "/something" ('),o("strong",[e._v("replacing")]),e._v(")")]),e._v(" "),o("li",[o("code",[e._v('@page "/{category}/{productId}"')]),e._v(' - the URL will be "/'),o("code",[e._v("{category}")]),e._v("/"),o("code",[e._v("{productId}")]),e._v('" ('),o("strong",[e._v("replacing")]),e._v(")")])]),e._v(" "),o("p",[e._v("With such modifications, the default file location-based route is no longer\nvalid.")])])}),[],!1,null,null,null);t.default=n.exports}}]);