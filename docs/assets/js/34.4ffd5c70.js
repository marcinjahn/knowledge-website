(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{467:function(e,t,s){"use strict";s.r(t);var n=s(31),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"pods"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pods"}},[e._v("#")]),e._v(" Pods")]),e._v(" "),s("p",[e._v("Each pod has its own IP, hostname, processes, network interfaces and other\nresources.")]),e._v(" "),s("p",[e._v("A pod contains one or more containers. These containers share a node and some\nLinux namespaces (it's configurable, e.g. pod's containers by default do not\nshare PID namespace).")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/GmKGhhn.png",alt:""}})]),e._v(" "),s("p",[e._v("Sharing network namespaces by pod's containers:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/uEDYRs9.png",alt:""}})]),e._v(" "),s("p",[e._v("It makes sense to have multiple containers in a pod if these containers need to\nwork together closely. The example below shows some web app and a sidecar\ncontainer providing TLS support:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/j38h4ZB.png",alt:""}})]),e._v(" "),s("p",[e._v("Another example:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/7475N9l.png",alt:""}})]),e._v(" "),s("p",[e._v("Containers in a single pod are scaled together.")]),e._v(" "),s("h2",{attrs:{id:"networking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#networking"}},[e._v("#")]),e._v(" Networking")]),e._v(" "),s("p",[e._v("All pods can talk to each other, and they are reachable from any node. Pods may\ndefine the ports they use in YAML, but they do not have to. It's only\ninformative (and it gives possibility to name the ports, which is useful when\ncreating Services for them).")]),e._v(" "),s("p",[e._v("Checking if pod accepts requests:")]),e._v(" "),s("ul",[s("li",[e._v("SSH into any node, and try to curl the IP address of a pod")]),e._v(" "),s("li",[e._v("create another Pod, get into it, and curl the other pod from it")]),e._v(" "),s("li",[s("code",[e._v("k port-forward <pod-name> <pod-port>")]),e._v(" - it's the easiest thing to do, but the\nmost complex under the hood. It can also be used with Services.")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/R8QArw1.png",alt:""}})]),e._v(" "),s("h2",{attrs:{id:"logs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logs"}},[e._v("#")]),e._v(" Logs")]),e._v(" "),s("p",[s("code",[e._v("k logs <pod>")]),e._v(" - displays pod logs")]),e._v(" "),s("p",[e._v("Options:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("-f")]),e._v(" for follow")]),e._v(" "),s("li",[s("code",[e._v("--timestamps")]),e._v(" for timestamps")]),e._v(" "),s("li",[s("code",[e._v("-p")]),e._v(" - logs from the previous instance of the pod (if died)")])]),e._v(" "),s("p",[e._v("Deleting a pod deletes the logs as well. Logs are kept in "),s("code",[e._v("/var/log/containers")]),e._v("\non the nodes.")]),e._v(" "),s("h2",{attrs:{id:"accessing-pods"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#accessing-pods"}},[e._v("#")]),e._v(" Accessing Pods")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("k cp kiada:html/index.html /tmp/index.html")]),e._v(" - copying friles to/from\ncontainers")]),e._v(" "),s("li",[s("code",[e._v("k exec <pod> -- ps aux")]),e._v(" - execute a command in a pod ("),s("code",[e._v("-it")]),e._v(" for interactive)")]),e._v(" "),s("li",[s("code",[e._v("k attach")]),e._v(" - attaches to stdin, stderr, stdin (useful if pod's container\nexpects input). If stdin is not needed, it is not different than "),s("code",[e._v("k logs -f")])]),e._v(" "),s("li",[e._v("ephemeral containers - currently in Alpha")])]),e._v(" "),s("h2",{attrs:{id:"init-containers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#init-containers"}},[e._v("#")]),e._v(" Init Containers")]),e._v(" "),s("p",[e._v("Pod can have "),s("strong",[e._v("init container(s)")]),e._v(' specified. They can start before the "main"\ncontainer(s), finish successfully, and only then the "main" container(s) start.')]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/hViRCNQ.png",alt:""}})]),e._v(" "),s("p",[e._v('"Main" containers run in parallel. Init containers run consecutively (1 at a\ntime).')]),e._v(" "),s("p",[e._v("Some usecases:")]),e._v(" "),s("ul",[s("li",[e._v("prepare some files on a volume for main container")]),e._v(" "),s("li",[e._v("configure some networking")]),e._v(" "),s("li",[e._v("delay container start until some condition is met")]),e._v(" "),s("li",[e._v("notify some external service that the pod is starting")])]),e._v(" "),s("p",[e._v("Init containers should work in an idempotent way.")]),e._v(" "),s("h2",{attrs:{id:"lifecycle"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lifecycle"}},[e._v("#")]),e._v(" Lifecycle")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/qF126K8.png",alt:""}})]),e._v(" "),s("p",[e._v('Pod\'s conditions (a part of "status"):')]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/Yq0SLM6.png",alt:""}})]),e._v(" "),s("p",[e._v("Restart policies of pods:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/lqVAMNq.png",alt:""}})]),e._v(" "),s("p",[e._v("These policies can be defined only on the pod level, not on the container level.")]),e._v(" "),s("p",[e._v("When container dies and gets restarted, there is a varying delay before the\ncontainer starts:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/VKxVqXl.png",alt:""}})]),e._v(" "),s("p",[e._v("First time is immediate, then it grows exponentially up to 5 minutes. This\nbehaviour is reset if the container has run successfully for at least 10\nminutes.")]),e._v(" "),s("h2",{attrs:{id:"probes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#probes"}},[e._v("#")]),e._v(" Probes")]),e._v(" "),s("h3",{attrs:{id:"liveness-probe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#liveness-probe"}},[e._v("#")]),e._v(" Liveness Probe")]),e._v(" "),s("p",[e._v("K8s automatically restarts container that crashes. However, there are situtions\nwhen the app does not terminate, but is unhealthy (i.e., in a deadlock).")]),e._v(" "),s("p",[s("strong",[e._v("Liveness probe")]),e._v(" may be defined for every cotnainer in a pod. It is checked\nperiodically. If container does not respond, it is considered unhealthy and is\nterminated (and restarted). They cannot be used with "),s("em",[e._v("init containers")]),e._v(".")]),e._v(" "),s("p",[e._v("Types:")]),e._v(" "),s("ul",[s("li",[e._v("HTTP GET - response code between 200-399 is considered successful")]),e._v(" "),s("li",[e._v("TCP socket - just a TCP connection is attempted")]),e._v(" "),s("li",[e._v("Exec - executes a command inside of the container and checks exit code")])]),e._v(" "),s("p",[e._v("Additional configurable parameters:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/eJjyMxt.png",alt:""}})]),e._v(" "),s("p",[e._v("K8s does not mention anywhere that probe is successful. It could be logged by a\ntested container by an app running on it.")]),e._v(" "),s("p",[e._v("When probe fails, K8s tries to "),s("strong",[e._v("terminate")]),e._v(" the app gracefully (with TERM). If that\nfails, it kills is forcefully ("),s("code",[e._v("kill -9")]),e._v(").")]),e._v(" "),s("h3",{attrs:{id:"readiness-probe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#readiness-probe"}},[e._v("#")]),e._v(" Readiness Probe")]),e._v(" "),s("p",[e._v("It is used to check if the pod is ready to accept requests. Like Liveness Probe\nsupports three types.")]),e._v(" "),s("p",[e._v("Containers without Readiness probe are considered Ready as soon as they are\nstarted.")]),e._v(" "),s("p",[e._v("If Readiness Probe fails, a pod is removed from\n"),s("RouterLink",{attrs:{to:"/dev-tools/kubernetes/services.html#endpoints"}},[e._v("Endpoints")]),e._v(" object of a service. It is not restarted,\nlike with the Liveness Probe.")],1),e._v(" "),s("h3",{attrs:{id:"startup-probe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#startup-probe"}},[e._v("#")]),e._v(" Startup Probe")]),e._v(" "),s("p",[e._v("Additional proble - "),s("strong",[e._v("Startup Probe")]),e._v(" may be added if the app is known to start\nlong. Then, separate configuration is used to check app health during startup.\nWe might define how long it should take for the app to start responding for\nhealth checks. It's perfectly normal for the Startup probe to fail a couple\ntimes initially. Successful Startup probe indicates that K8s should switch to\nthe "),s("em",[e._v("Liveness probe")]),e._v(". It is usually executed at shorted intervals making sure\nthe app is alive.")]),e._v(" "),s("p",[e._v("Only after Complete Startup the container may become Ready (via the Readiness\nProbe).")]),e._v(" "),s("p",[e._v("Usually both probes use the same endpoint, but they can be different (or even\nuse different type).")]),e._v(" "),s("h2",{attrs:{id:"hooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[e._v("#")]),e._v(" Hooks")]),e._v(" "),s("p",[e._v("There are two hooks:")]),e._v(" "),s("ul",[s("li",[e._v("post-start - run immediately after the container is started parallelly to it")]),e._v(" "),s("li",[e._v("pre-stop")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/0HjOp57.png",alt:""}})]),e._v(" "),s("p",[e._v("They are specified per container.")]),e._v(" "),s("blockquote",[s("p",[e._v("Init containes are similar to post-start hooks, but they're defined per pod.")])]),e._v(" "),s("p",[e._v('They can be defined as HTTP GET, or as "exec" (just like probes). "tcpSocket" is\nnot supported.')]),e._v(" "),s("p",[e._v('Container is in the "Pending" state until post-start is completed. Logs also\ncannot be seen even though container is already running. If the hook fails, the\ncontainer is restarted.')]),e._v(" "),s("p",[e._v("The post-start HTTP hook should not be used if we want to target the same\ncontainer with it (or the same pod in general). It could happen that the hook\nwill be executed before the webserver is started in the container. It will cause\na restart since HTTP request will fail. We end up in a restart loop. HTTP hook\nis good for notifying some other apps about the container starting.")]),e._v(" "),s("p",[e._v("The pre-stop hook is not invoked if the app terminates by itself.")]),e._v(" "),s("h2",{attrs:{id:"termination"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#termination"}},[e._v("#")]),e._v(" Termination")]),e._v(" "),s("p",[e._v("If the pod is to be killed, a "),s("code",[e._v("TERM")]),e._v(" signal is sent to it. By default, 30s is\ngiven for the container to shut down gracefully. It can be changed with the\n"),s("code",[e._v("terminationGracePeriodSeconds")]),e._v(" setting in "),s("code",[e._v("spec")]),e._v(". If the time passes and\ncontainer still lives, "),s("code",[e._v("KILL")]),e._v(" is sent to it.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/IAZMN8c.png",alt:""}})])])}),[],!1,null,null,null);t.default=a.exports}}]);