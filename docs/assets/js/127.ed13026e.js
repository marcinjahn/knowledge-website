(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{595:function(e,t,s){"use strict";s.r(t);var o=s(22),r=Object(o.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"http-protocol"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-protocol"}},[e._v("#")]),e._v(" HTTP Protocol")]),e._v(" "),s("h2",{attrs:{id:"typical-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#typical-request"}},[e._v("#")]),e._v(" Typical Request")]),e._v(" "),s("p",[e._v("Here's how a typical HTTP request looks like (up to some level of abstraction).\nThe assumptions are:")]),e._v(" "),s("ul",[s("li",[e._v('the PC and the web browser are "fresh", DNS caches are empty')]),e._v(" "),s("li",[e._v("max HTTP/2 is used (no QUIC)")]),e._v(" "),s("li",[e._v('we\'re making a request to "example.com"')]),e._v(" "),s("li",[e._v('"example.com" record exists in HSTS')])]),e._v(" "),s("ol",[s("li",[e._v('"example.com" is a domain name. The networking stack needs IP address, so\nwe\'re going to reach out to DNS for the IP address\n'),s("ol",[s("li",[e._v("On Linux, "),s("code",[e._v("nsswitch.conf")]),e._v(" file is checked to find out about the sources\nof DNS entries. It could be the "),s("code",[e._v("/etc/hosts")]),e._v(" file, and some DNS service")]),e._v(" "),s("li",[e._v("Most likely, we'll reach out to some external DNS service, which is either\nconfigured by us or by DHCP.")]),e._v(" "),s("li",[e._v("We send a request to DNS (let's skip the process of resolving MAC addresses\nwith ARP). DNS uses UDP on port 53.")]),e._v(" "),s("li",[e._v("DNS respons to us with the IP address. The IP address could be found either\nin our DNS service or the service could reach out to some other DNS service\nfor the IP.")])])]),e._v(" "),s("li",[e._v("With the IP address, we can start to establish a "),s("a",{attrs:{href:"./tcp"}},[e._v("TCP connection")]),e._v(' with\nthe "example.com" server.\n'),s("ol",[s("li",[e._v("3-way handshake occurs and sockets are created on the client and the server\n(IP-port pairs).")])])]),e._v(" "),s("li",[s("a",{attrs:{href:"./hsts"}},[e._v("HSTS")]),e._v(" can jump in forcing us to use HTTPS (let's assume that it\nhappened). We need to establish TLS session.")]),e._v(" "),s("li",[e._v("The client will start the TLS session with the server. Depending on the TLS\nversion used, a proper handshake procedure will occur.\n"),s("ul",[s("li",[e._v("if TLS 1.3 is used:\n"),s("ol",[s("li",[e._v('There is a 2-way handshake. The client sends "Client Hello" including:\nD-H parameters, SNI (encrypted), ALPN.')]),e._v(" "),s("li",[e._v('The server responds with "Server Hello" including: D-H parameters,\n'),s("RouterLink",{attrs:{to:"/technologies/security/cryptography/basic-terms.html#x-509"}},[e._v("X.509\ncertificate")]),e._v("\n(based on SNI).")],1)])]),e._v(" "),s("li",[e._v("if TLS 1.2 is used:\n"),s("ol",[s("li",[e._v('There is a 4-way handshake. The client sends "Client Hello" including:\nprotocols info, SNI.')]),e._v(" "),s("li",[e._v('The server responds with "Server Hello" including: '),s("RouterLink",{attrs:{to:"/technologies/security/cryptography/basic-terms.html#x-509"}},[e._v("X.509\ncertificate")]),e._v(",\nprotocol choices.")],1),e._v(" "),s("li",[e._v("Client sends the symmetric key (which is why TLS 1.3 is preferred)")]),e._v(" "),s("li",[e._v("Server FIN")])])])])]),e._v(" "),s("li",[e._v("With the TCP and TLS established, the client can send the actual HTTP request\ncontaining all the necessary content.")]),e._v(" "),s("li",[e._v("The server responds with a proper HTTP response.")])]),e._v(" "),s("h2",{attrs:{id:"simple-implementation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#simple-implementation"}},[e._v("#")]),e._v(" Simple Implementation")]),e._v(" "),s("p",[e._v("HTTP is all about sending appropriately formatted messages over TCP (unless\nHTTP/3 is used). A simple HTTP server implementation shows it quite well:\n"),s("a",{attrs:{href:"https://medium.com/from-the-scratch/http-server-what-do-you-need-to-know-to-build-a-simple-http-server-from-scratch-d1ef8945e4fa",target:"_blank",rel:"noopener noreferrer"}},[e._v("Medium"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"versions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#versions"}},[e._v("#")]),e._v(" Versions")]),e._v(" "),s("p",[s("strong",[e._v("HTTP/1.0")]),e._v(" was establishing a separate TCP connection per each request -\nexpensive - every CSS, image, etc. of a website had to be fetched through a\nseparate TCP connection.")]),e._v(" "),s("p",[s("strong",[e._v("HTTP/1.1")]),e._v(" introduced:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("Host")]),e._v(" header containing the target domain. Without this, proxies could not\nwork (they wouldn't know where to send the request)")]),e._v(" "),s("li",[s("code",[e._v("keep-alive")]),e._v(" header, which reused a connection when loading content\n("),s("em",[e._v("persisted TCP connection")]),e._v("). The server understands it and keeps the TCP\nconnection open")]),e._v(" "),s("li",[s("code",[e._v("ETag")]),e._v(" caching.")]),e._v(" "),s("li",[s("em",[e._v("Streaming")]),e._v(" of content.")])]),e._v(" "),s("p",[s("strong",[e._v("HTTP/2")]),e._v(" introduced:")]),e._v(" "),s("ul",[s("li",[e._v("compression")]),e._v(" "),s("li",[e._v("multiplexing - client joins his requests into one request")]),e._v(" "),s("li",[e._v("always HTTPS (TLS)")]),e._v(" "),s("li",[e._v("ALPN - negotiates protocol during the TLS handshake")])]),e._v(" "),s("p",[s("strong",[e._v("HTTP/3")]),e._v(" introduced:")]),e._v(" "),s("ul",[s("li",[e._v("uses QUIC (UDP with Congestion control) instead of TCP, making the amount of\ncommunication much smaller, resulting in reduced latencies.")])]),e._v(" "),s("h2",{attrs:{id:"browser-storage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#browser-storage"}},[e._v("#")]),e._v(" Browser Storage")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/UXLpHD2.png",alt:""}})]),e._v(" "),s("p",[e._v("The main diference is that cookies are sent to servers, while localStorage and\nsessionStorage stay on the client only. Also, localStorage stays in forever.")]),e._v(" "),s("h2",{attrs:{id:"proxying"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#proxying"}},[e._v("#")]),e._v(" Proxying")]),e._v(" "),s("h3",{attrs:{id:"http-proxy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-proxy"}},[e._v("#")]),e._v(" HTTP Proxy")]),e._v(" "),s("p",[e._v("It needs to be configured on the client. When I send any HTTP request, it's\ngoing to be modified in a layer 3. The IP address will be set to the IP address\nof the proxy. The proxy will receive my request (on TCP connection 1), and by\ninspecting the layer 7 data it will see what request I wanted to make. It will\ncreate another TCP connection (with the target server), get the data, and send\nit back to me (on TCP connection 1). The target server does not know that the\nclient was behind a proxy.")]),e._v(" "),s("p",[e._v("Reference: https://www.youtube.com/watch?v=x4E4mbobGEc")]),e._v(" "),s("h3",{attrs:{id:"https-proxy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#https-proxy"}},[e._v("#")]),e._v(" HTTPS Proxy")]),e._v(" "),s("p",[e._v("The proxy needs to see what domain we want to access. This information is\ndecrypted though. To go around that, the proxy needs to offer TLS termination\nand provide a certificate that the client needs to trust.")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/vdj2Ebz.png",alt:""}})]),e._v(" "),s("p",[e._v("Reference: https://www.youtube.com/watch?v=PAJ5kK50qp8")]),e._v(" "),s("h3",{attrs:{id:"http-connect-proxy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-connect-proxy"}},[e._v("#")]),e._v(" HTTP CONNECT proxy")]),e._v(" "),s("ol",[s("li",[e._v("First, a client sends HTTP CONNECT to the proxy with domain of the target\nserver.")]),e._v(" "),s("li",[e._v("The proxy establishes a TCP connection with the target server and returns\nsuccess to the client")]),e._v(" "),s("li",[e._v("For any packet sent from the client to the proxy, proxy hanges the source IP\nto itself and sends this packet via the previouslu established TCP connection\nto the target server.")]),e._v(" "),s("li",[e._v("Any response from the target server gets its source IP modified to the\nproxy's IP and sent back to the client.")])]),e._v(" "),s("p",[e._v("The communication is end-to-end, the proxy does not see the encrypted content.\nTe proxy knows only the domain we're communicating with.")]),e._v(" "),s("p",[e._v("Proxies may be chained, so that a proxy has its own proxy:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.imgur.com/J7mOhkO.png",alt:""}})]),e._v(" "),s("h2",{attrs:{id:"enforcing-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enforcing-https"}},[e._v("#")]),e._v(" Enforcing HTTPS")]),e._v(" "),s("p",[e._v("There are at least two ways to enforce HTTPS:")]),e._v(" "),s("ul",[s("li",[e._v("Redirect from HTTP to HTTPS on your server")]),e._v(" "),s("li",[e._v("Use "),s("a",{attrs:{href:"./hsts"}},[e._v("HSTS")]),e._v(" - it's a header that informs the browser to ALWAYS use HTTPS when\nreaching the app.")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("ASP.NET Core")]),e._v(" "),s("p",[e._v("ASP.NET Core has built-in middleware for both of the points above.")])]),e._v(" "),s("p",[e._v("HSTS should be used only if we do not plan to make use of HTTP in the app.\nOtherwise we can make it impossible for the users to reach the HTTP endpoints.")]),e._v(" "),s("p",[e._v("HSTS should not be used in development.")])])}),[],!1,null,null,null);t.default=r.exports}}]);