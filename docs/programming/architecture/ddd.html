<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Domain-Driven Design | Marcin Jahn | Tech Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Architecture for building applications - Domain-Driven Design (DDD)">
    <meta property="og:url" content="/programming/architecture/ddd.html">
    <meta property="og:site_name" content="Marcin Jahn | Tech Notebook">
    <meta property="og:title" content="Domain-Driven Design">
    <meta property="og:description" content="Architecture for building applications - Domain-Driven Design (DDD)">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Tech Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="#7D84B2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.c2e909f7.css" as="style"><link rel="preload" href="/assets/js/app.966978df.js" as="script"><link rel="preload" href="/assets/js/2.e154a615.js" as="script"><link rel="preload" href="/assets/js/21.10c03aef.js" as="script"><link rel="prefetch" href="/assets/js/10.4010014d.js"><link rel="prefetch" href="/assets/js/100.76bfe42a.js"><link rel="prefetch" href="/assets/js/101.d10adfef.js"><link rel="prefetch" href="/assets/js/102.78f0a2d7.js"><link rel="prefetch" href="/assets/js/103.b604e5e9.js"><link rel="prefetch" href="/assets/js/104.6cfb4c86.js"><link rel="prefetch" href="/assets/js/105.3eeb7693.js"><link rel="prefetch" href="/assets/js/106.bb73f310.js"><link rel="prefetch" href="/assets/js/107.ca023b7f.js"><link rel="prefetch" href="/assets/js/108.e43abb40.js"><link rel="prefetch" href="/assets/js/109.d28c3b67.js"><link rel="prefetch" href="/assets/js/11.e413dcd0.js"><link rel="prefetch" href="/assets/js/110.7dc34c54.js"><link rel="prefetch" href="/assets/js/111.b5c851a3.js"><link rel="prefetch" href="/assets/js/112.1016d70a.js"><link rel="prefetch" href="/assets/js/113.40cdf430.js"><link rel="prefetch" href="/assets/js/114.d949130e.js"><link rel="prefetch" href="/assets/js/115.135bf191.js"><link rel="prefetch" href="/assets/js/116.a472e97a.js"><link rel="prefetch" href="/assets/js/117.1d2380f5.js"><link rel="prefetch" href="/assets/js/118.0801babc.js"><link rel="prefetch" href="/assets/js/119.d4a4a492.js"><link rel="prefetch" href="/assets/js/12.5cebba1e.js"><link rel="prefetch" href="/assets/js/120.cc665372.js"><link rel="prefetch" href="/assets/js/121.3e06b23d.js"><link rel="prefetch" href="/assets/js/122.b54e5978.js"><link rel="prefetch" href="/assets/js/123.ce65d4ea.js"><link rel="prefetch" href="/assets/js/124.aef6e218.js"><link rel="prefetch" href="/assets/js/125.d3f7d356.js"><link rel="prefetch" href="/assets/js/126.0013aee3.js"><link rel="prefetch" href="/assets/js/127.16d73edc.js"><link rel="prefetch" href="/assets/js/128.5203b2f9.js"><link rel="prefetch" href="/assets/js/129.871ad5ed.js"><link rel="prefetch" href="/assets/js/13.89422965.js"><link rel="prefetch" href="/assets/js/130.26bfd0c1.js"><link rel="prefetch" href="/assets/js/131.268f723c.js"><link rel="prefetch" href="/assets/js/132.701b7a13.js"><link rel="prefetch" href="/assets/js/133.6717605f.js"><link rel="prefetch" href="/assets/js/134.365fd7a1.js"><link rel="prefetch" href="/assets/js/135.aff5e003.js"><link rel="prefetch" href="/assets/js/136.d1d6d462.js"><link rel="prefetch" href="/assets/js/137.0ea83666.js"><link rel="prefetch" href="/assets/js/138.809f766b.js"><link rel="prefetch" href="/assets/js/139.4991cda6.js"><link rel="prefetch" href="/assets/js/14.ab8e1dcc.js"><link rel="prefetch" href="/assets/js/140.cf9ed1cb.js"><link rel="prefetch" href="/assets/js/141.fe5dd808.js"><link rel="prefetch" href="/assets/js/142.70dd6b5b.js"><link rel="prefetch" href="/assets/js/143.9f8c82fd.js"><link rel="prefetch" href="/assets/js/144.63193f45.js"><link rel="prefetch" href="/assets/js/145.a21651d3.js"><link rel="prefetch" href="/assets/js/146.00e66169.js"><link rel="prefetch" href="/assets/js/147.7c626aa3.js"><link rel="prefetch" href="/assets/js/148.e294b5b3.js"><link rel="prefetch" href="/assets/js/149.8ecdf49d.js"><link rel="prefetch" href="/assets/js/15.89e1dd21.js"><link rel="prefetch" href="/assets/js/150.a5bee3ae.js"><link rel="prefetch" href="/assets/js/151.1560cc2c.js"><link rel="prefetch" href="/assets/js/152.02ea421d.js"><link rel="prefetch" href="/assets/js/16.2a55624c.js"><link rel="prefetch" href="/assets/js/17.8878d520.js"><link rel="prefetch" href="/assets/js/18.350917e6.js"><link rel="prefetch" href="/assets/js/19.cf1af818.js"><link rel="prefetch" href="/assets/js/20.1c8e8717.js"><link rel="prefetch" href="/assets/js/22.a404cd1c.js"><link rel="prefetch" href="/assets/js/23.f4b4bfb2.js"><link rel="prefetch" href="/assets/js/24.cc7b45ce.js"><link rel="prefetch" href="/assets/js/25.87db353c.js"><link rel="prefetch" href="/assets/js/26.3794764b.js"><link rel="prefetch" href="/assets/js/27.ebed9134.js"><link rel="prefetch" href="/assets/js/28.4909b1ae.js"><link rel="prefetch" href="/assets/js/29.36176dd8.js"><link rel="prefetch" href="/assets/js/3.54e9968c.js"><link rel="prefetch" href="/assets/js/30.73aa628c.js"><link rel="prefetch" href="/assets/js/31.40f1b1d2.js"><link rel="prefetch" href="/assets/js/32.3b90ff2a.js"><link rel="prefetch" href="/assets/js/33.e414a879.js"><link rel="prefetch" href="/assets/js/34.1bec9902.js"><link rel="prefetch" href="/assets/js/35.a682d85c.js"><link rel="prefetch" href="/assets/js/36.fae3b557.js"><link rel="prefetch" href="/assets/js/37.b6e12fff.js"><link rel="prefetch" href="/assets/js/38.18cb3d3d.js"><link rel="prefetch" href="/assets/js/39.48e1c6c4.js"><link rel="prefetch" href="/assets/js/4.c31a517b.js"><link rel="prefetch" href="/assets/js/40.85b85b8c.js"><link rel="prefetch" href="/assets/js/41.94d3e608.js"><link rel="prefetch" href="/assets/js/42.4216a2f8.js"><link rel="prefetch" href="/assets/js/43.d1023d2d.js"><link rel="prefetch" href="/assets/js/44.8dad369c.js"><link rel="prefetch" href="/assets/js/45.1f6047dd.js"><link rel="prefetch" href="/assets/js/46.62047ba2.js"><link rel="prefetch" href="/assets/js/47.475f40f9.js"><link rel="prefetch" href="/assets/js/48.12680be5.js"><link rel="prefetch" href="/assets/js/49.23d1ca70.js"><link rel="prefetch" href="/assets/js/5.820c1859.js"><link rel="prefetch" href="/assets/js/50.3cccea92.js"><link rel="prefetch" href="/assets/js/51.60977eb9.js"><link rel="prefetch" href="/assets/js/52.6cd304b8.js"><link rel="prefetch" href="/assets/js/53.f02218d6.js"><link rel="prefetch" href="/assets/js/54.b2f388df.js"><link rel="prefetch" href="/assets/js/55.b12636eb.js"><link rel="prefetch" href="/assets/js/56.ce8934a6.js"><link rel="prefetch" href="/assets/js/57.71d8183b.js"><link rel="prefetch" href="/assets/js/58.18f8652b.js"><link rel="prefetch" href="/assets/js/59.8f4a26ad.js"><link rel="prefetch" href="/assets/js/6.1bc79fed.js"><link rel="prefetch" href="/assets/js/60.48c63c98.js"><link rel="prefetch" href="/assets/js/61.26d5b3f2.js"><link rel="prefetch" href="/assets/js/62.5445b2cc.js"><link rel="prefetch" href="/assets/js/63.c4edc6a0.js"><link rel="prefetch" href="/assets/js/64.b37e720b.js"><link rel="prefetch" href="/assets/js/65.01eed1a3.js"><link rel="prefetch" href="/assets/js/66.2ca45e53.js"><link rel="prefetch" href="/assets/js/67.7e610830.js"><link rel="prefetch" href="/assets/js/68.1cebe456.js"><link rel="prefetch" href="/assets/js/69.871f1f57.js"><link rel="prefetch" href="/assets/js/7.cf85c2c3.js"><link rel="prefetch" href="/assets/js/70.d7102926.js"><link rel="prefetch" href="/assets/js/71.da3ab009.js"><link rel="prefetch" href="/assets/js/72.6dd24e71.js"><link rel="prefetch" href="/assets/js/73.589976fe.js"><link rel="prefetch" href="/assets/js/74.0dc3dd59.js"><link rel="prefetch" href="/assets/js/75.311d5864.js"><link rel="prefetch" href="/assets/js/76.be1ff81a.js"><link rel="prefetch" href="/assets/js/77.2210347b.js"><link rel="prefetch" href="/assets/js/78.8eebbfe4.js"><link rel="prefetch" href="/assets/js/79.e281fb0e.js"><link rel="prefetch" href="/assets/js/8.5f339f67.js"><link rel="prefetch" href="/assets/js/80.999b443f.js"><link rel="prefetch" href="/assets/js/81.7c6e6bab.js"><link rel="prefetch" href="/assets/js/82.46f093ff.js"><link rel="prefetch" href="/assets/js/83.4afa1f09.js"><link rel="prefetch" href="/assets/js/84.b78affef.js"><link rel="prefetch" href="/assets/js/85.0ed2f5dd.js"><link rel="prefetch" href="/assets/js/86.b3df3a78.js"><link rel="prefetch" href="/assets/js/87.c5031086.js"><link rel="prefetch" href="/assets/js/88.71816ea5.js"><link rel="prefetch" href="/assets/js/89.d9f2b0bb.js"><link rel="prefetch" href="/assets/js/9.035932be.js"><link rel="prefetch" href="/assets/js/90.3b509da4.js"><link rel="prefetch" href="/assets/js/91.0667edf3.js"><link rel="prefetch" href="/assets/js/92.46f19ce9.js"><link rel="prefetch" href="/assets/js/93.5d2db654.js"><link rel="prefetch" href="/assets/js/94.bc1375bc.js"><link rel="prefetch" href="/assets/js/95.3cf181a5.js"><link rel="prefetch" href="/assets/js/96.9a16ae05.js"><link rel="prefetch" href="/assets/js/97.02cbff32.js"><link rel="prefetch" href="/assets/js/98.6208716e.js"><link rel="prefetch" href="/assets/js/99.870559fe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c2e909f7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Tech Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/programming/" aria-current="page" class="sidebar-link">/programming/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/dotnet.webp"></span> <span>.NET</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/javascript.webp"></span> <span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/rust.webp"></span> <span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/c.webp"></span> <span>C/C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/css.webp"></span> <span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/unity.webp"></span> <span>Unity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/algorithms.webp"></span> <span>Algorithms</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span class="img-container"><img src="/sidebar-imgs/architecture.webp"></span> <span>Architecture</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/programming/architecture/asp-net-core.html" class="sidebar-link">ASP.NET Core Projects</a></li><li><a href="/programming/architecture/ddd.html" aria-current="page" class="active sidebar-link">Domain-Driven Design</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#bounded-context" class="sidebar-link">Bounded Context</a></li><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#domain-model" class="sidebar-link">Domain Model</a></li><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#shared-kernel" class="sidebar-link">Shared Kernel</a></li><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#repositories" class="sidebar-link">Repositories</a></li><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#events" class="sidebar-link">Events</a></li><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#anti-corruption-layer" class="sidebar-link">Anti-Corruption Layer</a></li><li class="sidebar-sub-header"><a href="/programming/architecture/ddd.html#sources" class="sidebar-link">Sources</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="frontmatter-title"><a href="#frontmatter-title" class="header-anchor">#</a> Domain-Driven Design</h1> <p>The Domain-Driven Design (DDD) is an architecture style for building
microservices-based software systems. Some argue that microservices architecture
is true only with DDD.</p> <p>The main goal of DDD is to make software more maintainable, to make it less
complex to deal with.</p> <h2 id="bounded-context"><a href="#bounded-context" class="header-anchor">#</a> Bounded Context</h2> <p>As part of DDD, we identify <strong>Subdomains</strong> that take part in our system.
Subdomain is a subset of some larger <strong>Domain</strong>. The terms are rather fuzzy.
Every subdomain is some domain itself after all. Domains and subdomains are a
hierarchical concept.</p> <p>When we design DDD-compliant system, the domain is the general problem we're
trying to solve, let's say &quot;Monitoring of IoT Platform Instances&quot;. This great
domain may be splitted into smaller concerns - subdomains:</p> <ul><li>users management</li> <li>platforms management</li> <li>notifications</li> <li>etc.</li></ul> <p>A <strong>Bounded Context</strong> represents a linguistic boundary within or across
subdomains. Often, a Bounded Context is aligned with a Subdomain. The difference
between these two concepts is as follows:</p> <ul><li>a <strong>Subdomain</strong> is in the <em>Problem Space</em>.</li> <li>a <strong>Bounded Context</strong> is in the <em>Solution Space</em>.</li></ul> <p>So, a given bounded context is a proposed solution to a problem within some
subdomain.</p> <p>In a typical project, there will be many bounded contexts. Ideally, each of them
should be developed by a different team. Each would also use a separate data
store.</p> <h3 id="bounded-context-vs-microservice"><a href="#bounded-context-vs-microservice" class="header-anchor">#</a> Bounded Context vs Microservice</h3> <p>There isn't a 1:1 relation between a bounded context and a microservice. A
single bounded context could be served by multiple microservices. For example,
one microservice could be in a form of an HTTP API, serving requests. Another
microservice could be a listener on some bus. Both could work on the same
database, but they'd work on a different parts of the overall responsibility of
the bounded context.</p> <h3 id="ubiquitous-language"><a href="#ubiquitous-language" class="header-anchor">#</a> Ubiquitous Language</h3> <p>One of the pillars of DDD is the establishment of the <strong>Ubiquitous Language</strong> -
an agreed vocabulary that will be used to describe various entities in the
Bounded Contexts. It should be used everywhere in the project: code, diagrams,
discussions, etc.</p> <p>Every context will have its own ubiquitous language.</p> <h4 id="context-maps"><a href="#context-maps" class="header-anchor">#</a> Context Maps</h4> <p>The namings in different Bounded Contexts and their relations is what defines
<strong>Context Maps</strong>. It could be that different Bounded Contexts use the same name
for different entities. It could also happen that different bounded context
would model the same entity differently (like a Customer in Appointment
Scheduler context and Customer in the Billing context).</p> <p>A Context Map clearly shows what a given entity is represented by in another
context.</p> <h3 id="synchronization"><a href="#synchronization" class="header-anchor">#</a> Synchronization</h3> <p>Different bounded context may model data for the same physical entity. For
example, Patient Management context and scheduling context may contain the
Patient entity. Probably, the one in the Patient Management context will be more
detailed. Also, probably that one will allow for various modifications. E.g., we
could change the patient's name. The other contexts that model the Patient
should be notified about this change. E.g., it could be done via some message
bus. The Patient Management service would publish a message about the change,
and all other interested services would be listeners.</p> <h2 id="domain-model"><a href="#domain-model" class="header-anchor">#</a> Domain Model</h2> <p>Designing our domain model is crucial. According to Eric Evans:</p> <blockquote><p>The domain is the heart of business software.</p></blockquote> <p>Another point is that models evolve over time. Our initial assumptions can be
often invalidated as we progress in understanding the domain.</p> <p>In our modeling, we should focus on the behaviours of the models. To find such
behaviours, we need to look at all the possible events that may occur in the
system - those events are basically the use-cases that the solution is expected
to fulfill. Some examples of these events could be (in medical clinic system):</p> <ul><li>add a new patient</li> <li>schedule a visit</li> <li>move a visit to another date</li></ul> <h3 id="rich-domain-models"><a href="#rich-domain-models" class="header-anchor">#</a> Rich Domain Models</h3> <p>DDD encourages the use of <strong>Rich Domain Models</strong>, opposed to the <strong>Anemic Domain
Models</strong>. Anemic models are simply classes that are DTOs, or classes with very
little logic inside of them.</p> <p>Often in our programs we have DTO classes and other service classes that act on
these DTOs, potentially modifying them. This is an anti-pattern in the DDD
world. Martin Fowler argues that this is even an anti-pattern in the OOP sense,
since OOP is supposed to merge data and behaviour together.</p> <h3 id="entities"><a href="#entities" class="header-anchor">#</a> Entities</h3> <p>These are objects defined by their identity. That means that every instance of
an Entity is unique, it has its own key. identifier. Examples of entities:</p> <ul><li>Patient</li> <li>Doctor</li> <li>Room</li> <li>Appointment</li></ul> <p>An entity should always be in the valid state. Hence any modification of an
entity (or its creation) should contain various guard clauses that make sure the
operation can be done. For example, before I rename a Patient, I should make
sure that the new name is not empty.</p> <p>Entities also contain <em>Events</em>. These may be used to inform other parts of the
system of changes.</p> <h3 id="value-objects"><a href="#value-objects" class="header-anchor">#</a> Value Objects</h3> <p>Identity of <strong>Value Objects</strong> is based on composition of its values. They're
immutable. Value objects may contain methods (without side-effects).</p> <p>Value Objects are basically non-identified types that are specific to our
sub-domain. They group together some related data. Examples include:</p> <ul><li>money</li> <li>date range</li></ul> <p>An instance of a value object does not represent any unique entity, it's just a
set of information representing something in our domain.</p> <p>It's recommended to first consider Value Object when deciding whether to use
<a href="#entities">Entity</a> or Value Object for a given thing.</p> <div class="custom-block tip"><p class="custom-block-title">Identifiers</p> <p>In some projects identifiers of Entities are value objects. These are custom
types that contain just an identifier (for example as a <code>Guid</code>). So, we could
have a type called <code>CustomerIdValueObject</code>. Some argue that it makes the
solution more explicit, but I don't really agree with that. I think it
complicates things more than necessary.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token comment">// Supposedly, these types help to not pass arguments in the wrong order</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CreateAppointment</span><span class="token punctuation">(</span><span class="token class-name">ClientId</span> clientId<span class="token punctuation">,</span> <span class="token class-name">DoctorId</span> doctorId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <p>Date types are a great example of value objects.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It is OK for Value Objects to reference Entities!</p> <p>A quote from Eric Evans:</p> <blockquote><p>VALUE OBJECTS can even reference ENTITIES. For example, if I ask an online map
service for a scenic driving route from San Francisco to Los Angeles, it might
derive a Route object linking L.A. and San Francisco via the Pacific Coast
Highway. That Route object would be a VALUE, even though the three objects it
references (two cities and a highway) are all ENTITIES.</p></blockquote></div> <h3 id="domain-services"><a href="#domain-services" class="header-anchor">#</a> Domain Services</h3> <p>Logic/behaviour that doesn't fit into Entities or Value Objects goes into
separate classes called <strong>Domain Services</strong>. Such services often deal with
different kinds of entities/value objects. For example, they could orchestrate
some workflow.</p> <p>Also infrastructure-level logic, like logging, sending notifications, etc. is
considered to be in the Doman Services area.</p> <p>Before creating a service, we should make sure that the logic we're adding
doesn't fit into any of the existing domain elements (entities/value objects).</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Overuse of domain services might lead to anemic models.</p></div> <h3 id="aggregates"><a href="#aggregates" class="header-anchor">#</a> Aggregates</h3> <p>When building our Entities we will often end up with <strong>Aggregate</strong> entities,
that is, entities that are linked with other entities or value objects.</p> <p>Citing <a href="https://martinfowler.com/bliki/DDD_Aggregate.html" target="_blank" rel="noopener noreferrer">Martin Fowler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <blockquote><p>A DDD aggregate is a cluster of domain objects that can be treated as a single
unit. An example may be an order and its line-items, these will be separate
objects, but it's useful to treat the order (together with its line items) as
a single aggregate.</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>One Entity should only belong to one Aggregate. One Value Object can belong to
many Aggregates.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Just the fact that one entity refers to another (via some property) does not
mean that they are a part of the same Aggregate! It could be that some entity
belonging to one Aggregate refers to some other entity that is an Aggregate Root
of another Aggregate.</p> <p>An example of that could be the Snack Machine scenario from <a href="https://app.pluralsight.com/library/courses/domain-driven-design-in-practice" target="_blank" rel="noopener noreferrer">Domain-Driven
Design in Practice
(Pluralsight)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
We had there: <em>Snack Machine</em> -&gt; <em>Slots</em> -&gt; <em>Snacks</em>.</p> <p><em>Snack Machine</em> and <em>Slot</em> belonged to one Aggregate (since a <em>Slot</em> cannot exist
without a <em>Snack Machine</em>). A <em>Snack</em> was a separate Aggregate.</p></div> <h4 id="aggregate-root"><a href="#aggregate-root" class="header-anchor">#</a> Aggregate Root</h4> <p>There will also be an <strong>Aggreagate Root</strong> - an entry point of an aggregate that
&quot;defines&quot; the aggregate as a whole. To find out what is an aggregate root, we
need to look at individual components and think if the removal of a given
component would result in removal of its contained components (cascading
delete). If it would, that's probably an Aggregate Root.</p> <p>Aggregate Root is like a central entity that defines it completely. It should
allow us to keep the whole object in a valid state (enforcing invariants). We
should access/modify the aggregate only throught the Aggregate Root. The root
will make sure that the invariants are satisfied.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>There will also be entities that do not include other entities or value objects.
The convention is to call these Aggregates as well.</p></div> <p>A single bounded context or domain may contain a few Aggregate Roots.</p> <h3 id="associations"><a href="#associations" class="header-anchor">#</a> Associations</h3> <p>DDD encourages one-way relations between entities. It's popular in Entity
Framework to define navigation properties in both ways. It turns out it's not
always needed. It makes entities more complex. By default, we should start our
modeling with uni-directional relationships and switch to bi-directional ones
only when necessary.</p> <p>It still is OK to keep an identifier of the other entity (like a foreign key) in
the &quot;child&quot; entity.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>One aggregate should only reference external entities that are aggregate roots.
For example, if a <em>Customer</em> has some <em>Address</em>, other aggregates (e.g.,
<em>Order</em>) should not reference the <em>Address</em> directly. Instead, they should get
that address through a <em>Customer</em>.</p> <p>Aggregate Roots define the complete entity. We should not link some other
aggregate to a part of an aggregate.</p> <p>However, it's OK to link to some other non-root entity by the FK.</p></div> <p>When thinking to associate two aggregates, it's worth to remember what defines
an Aggregate Root:</p> <blockquote><p>We need to look at individual components and think if the removal of a given
component would result in removal of its contained components. If it would,
that's probably an Aggregate Root.</p></blockquote> <p>If removal of our root should not result in the removal of linked aggregates,
possibly we don't need to include these children as &quot;Navigation Properties&quot;.
Instead, maybe just an ID of that other entitiy is enough.</p> <p>An example is an aggregate called <em>Appointment</em>. It would contain references to:</p> <ul><li>Patient</li> <li>Doctor</li></ul> <p>However, since removing an Appointment should not remove Patient and Doctor, it
makes sense to reference these just by ID, not by Navigation Properites.</p> <h2 id="shared-kernel"><a href="#shared-kernel" class="header-anchor">#</a> Shared Kernel</h2> <p>In DDD, a <strong>Shared Kernel</strong> is code that is used between different bounded
context. It's basically a kind of project that .NET developers often call
<em>Common</em>. The shared part should be as stable as possible. Changes in that code
will affect a lot of places.</p> <h2 id="repositories"><a href="#repositories" class="header-anchor">#</a> Repositories</h2> <p>Repository pattern is a well-known approach and it is also used outside of DDD.
DDD-specific fact is that only the Aggregate Roots should have their
repositories. Other aggregates should be accessed via their aggregate roots.</p> <p>A few tips:</p> <ul><li>there should be some common <code>IRepository&lt;T&gt;</code> interface implementated by all
the repositories</li> <li>if some kind of repository (like <code>PatientsRepository</code>) has special needs, it's
OK to add some special methods to just that repository (or rather its
interface <code>IPatientsRepository</code>). An example of such a method could be
<code>GetPatientsOfDoctorWithId(Guid doctorId)</code>.</li> <li>we could have separate repositories for querying and commanding, following CQRS.</li></ul> <h3 id="specifications"><a href="#specifications" class="header-anchor">#</a> Specifications</h3> <p>The second point from the list above might turn some repositories into huge
classes. The solution for that is to turn these specific use-cases into
so-called <strong>Specifications</strong>. These are classes that provide predicates for
different use-cases. Then, our repositories would have a way to provide a
specification to it.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRepository<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token function">GetBySpec</span><span class="token punctuation">(</span><span class="token class-name">Specification</span> spec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It is similar to the Strategy pattern. It also provides separation of concerns
since the repository code can stay relatively clean and simple, while specific
use-cases will be handled by their own classes.</p> <p>It will work well with Entity Framework or ORMs in general. Other data access
methods would requie Specifications that are aware of the persistance layer
query language, I believe.</p> <h2 id="events"><a href="#events" class="header-anchor">#</a> Events</h2> <p>There are two kinds of events:</p> <ul><li>in-domain - Domain Events (in-process)</li> <li>across domains/bounded contexts - Integration Events</li></ul> <h3 id="domain-events"><a href="#domain-events" class="header-anchor">#</a> Domain Events</h3> <p>Domain Events are raised when something happens in the domain that could be of
interest to the other pieces of our application (but in the same process!).
They should be describable in the Ubiquitous Language and their names should
correspond to that. The naming should be in the past tense, since the events
will always inform about something that has already happened. Some examples:</p> <ul><li>Client Registered</li> <li>Appointment Scheduled</li></ul> <div class="custom-block tip"><p class="custom-block-title">YAGNI</p> <p>Create events only when there is some use case for it. Don't create them &quot;just
in case&quot;.</p></div> <p>In code, each event is a separate class. It should iunclude the set of
information that might be interesting for a given event. The information should
be initailized via constructor and be immutable.</p> <h4 id="creting-events"><a href="#creting-events" class="header-anchor">#</a> Creting Events</h4> <p>Each entity that is capable of emitting events would have <code>Events</code> property.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Appointment</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Entity</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">IList<span class="token punctuation">&lt;</span>IDomainEvent<span class="token punctuation">&gt;</span></span> Events <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>INotification<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="dispatching-events"><a href="#dispatching-events" class="header-anchor">#</a> Dispatching Events</h4> <p>The events could be dispatched in the <strong>Repository</strong>, right after the entities
emitting the events are saved. The generic repository base class is a good place
to handle that.</p> <div class="custom-block tip"><p class="custom-block-title">MediatR</p> <p>MediatR could be used to dispatch and handle events.</p></div> <p>Events may have multiple handlers. Normally, the order of their execution should
not matter.</p> <h3 id="integration-events"><a href="#integration-events" class="header-anchor">#</a> Integration Events</h3> <p>These events are the way to share information that something happens across
domains or applications. They often include more information than the Domain
Events since the receiver of the event might not be able to get these
information on its own. For example, instead of just sharing the ID of some
changed entity, we would also share some more defining properties, like a Name.
It could also happen that the event handler would have to get back to the source
service to ask for more details. We don't really want that, especially if
there'll be a lot of events, or a lot of handlers.</p> <div class="custom-block tip"><p class="custom-block-title">Domain and Integration Events</p> <p>We could have cases where some event has both Domain and Integration Events
defined. The entity would publish a Domain Event and one of the handlers would
publish an Integration Event, knowing that there might be some handlers
interested in this event outside of the domain or app.</p></div> <p>Integration Events often use some kind of message bus, like Azure Service Bus.</p> <h2 id="anti-corruption-layer"><a href="#anti-corruption-layer" class="header-anchor">#</a> Anti-Corruption Layer</h2> <p>It often happens that we have to integrate with systems that are outside of our
control. Such systems will most likely use a different modeling than ours. In
such cases, <strong>Anti-Corruption Layers</strong> help us to create a kind of mapper
between our domains and the other systems. Such layers are basically like
Adapters.</p> <p>It could also work the other way round. We could have a &quot;legacy&quot; system that we
want to update to integrate with a &quot;well-designed&quot; DDD project. In order not to
introduce the new concepts into legacy codebase, we could create an ACL layer
(like some set of services) that will communicate with our DDD system properly
and return the data as the legacy system expects.</p> <p><img src="/assets/img/acl-legacy-to-ddd.c747f794.png" alt=""></p> <h2 id="sources"><a href="#sources" class="header-anchor">#</a> Sources</h2> <ul><li><a href="https://app.pluralsight.com/paths/skill/domain-driven-design" target="_blank" rel="noopener noreferrer">DDD on Pluralsight<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li><a href="https://app.pluralsight.com/library/courses/fundamentals-domain-driven-design" target="_blank" rel="noopener noreferrer">Domain-Driven Design Fundamentals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://app.pluralsight.com/library/courses/domain-driven-design-in-practice" target="_blank" rel="noopener noreferrer">Domain-Driven Design in
Practice<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://app.pluralsight.com/library/courses/refactoring-anemic-domain-model" target="_blank" rel="noopener noreferrer">Refactoring from Anemic Domain Model Towards a Rich
One<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://app.pluralsight.com/library/courses/domain-driven-design-legacy-projects/table-of-contents" target="_blank" rel="noopener noreferrer">Domain-Driven Design: Working with Legacy
Projects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li><a href="https://www.codeproject.com/Articles/1020932/Domain-Driven-Design-Reflecting-Business-in-the-Do" target="_blank" rel="noopener noreferrer">Code
Project<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/programming/architecture/asp-net-core.html" class="prev">
        ASP.NET Core Projects
      </a></span> <!----></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/17/2022, 7:07:09 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.966978df.js" defer></script><script src="/assets/js/2.e154a615.js" defer></script><script src="/assets/js/21.10c03aef.js" defer></script>
  </body>
</html>
