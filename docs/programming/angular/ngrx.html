<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NgRx | Marcin Jahn | Tech Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Application state management in Angular with NgRx">
    <meta property="og:url" content="/programming/angular/ngrx.html">
    <meta property="og:site_name" content="Marcin Jahn | Tech Notebook">
    <meta property="og:title" content="NgRx">
    <meta property="og:description" content="Application state management in Angular with NgRx">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Tech Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="#7D84B2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="google-site-verification" content="uRhO2txNLDLyS2hZuK4JD4n-rPcdGJ0KMRSwvhSGzog">
    
    <link rel="preload" href="/assets/css/0.styles.d40b778b.css" as="style"><link rel="preload" href="/assets/js/app.a63cdd32.js" as="script"><link rel="preload" href="/assets/js/4.1cfa6f61.js" as="script"><link rel="preload" href="/assets/js/1.edb2ab2a.js" as="script"><link rel="preload" href="/assets/js/59.cb2bd608.js" as="script"><link rel="prefetch" href="/assets/js/10.f8429685.js"><link rel="prefetch" href="/assets/js/100.b614f95d.js"><link rel="prefetch" href="/assets/js/101.05ad5c11.js"><link rel="prefetch" href="/assets/js/102.661ebf57.js"><link rel="prefetch" href="/assets/js/103.f15e281a.js"><link rel="prefetch" href="/assets/js/104.7c97a852.js"><link rel="prefetch" href="/assets/js/105.07a182ac.js"><link rel="prefetch" href="/assets/js/106.5206b197.js"><link rel="prefetch" href="/assets/js/107.93c504a8.js"><link rel="prefetch" href="/assets/js/108.084f3ee9.js"><link rel="prefetch" href="/assets/js/109.defcf4dc.js"><link rel="prefetch" href="/assets/js/11.ab228136.js"><link rel="prefetch" href="/assets/js/110.bdab5b85.js"><link rel="prefetch" href="/assets/js/111.0c66504a.js"><link rel="prefetch" href="/assets/js/112.a8687c80.js"><link rel="prefetch" href="/assets/js/113.212ee23d.js"><link rel="prefetch" href="/assets/js/114.9d5899dd.js"><link rel="prefetch" href="/assets/js/115.55b02f18.js"><link rel="prefetch" href="/assets/js/116.ee26ba98.js"><link rel="prefetch" href="/assets/js/117.822a038e.js"><link rel="prefetch" href="/assets/js/118.9020f802.js"><link rel="prefetch" href="/assets/js/119.fafd4ad2.js"><link rel="prefetch" href="/assets/js/12.641a04df.js"><link rel="prefetch" href="/assets/js/120.3c7bc15c.js"><link rel="prefetch" href="/assets/js/121.a985747a.js"><link rel="prefetch" href="/assets/js/122.a264ea9a.js"><link rel="prefetch" href="/assets/js/123.294d2a56.js"><link rel="prefetch" href="/assets/js/124.ba9b17dc.js"><link rel="prefetch" href="/assets/js/125.f658e4b8.js"><link rel="prefetch" href="/assets/js/126.dbd95a0f.js"><link rel="prefetch" href="/assets/js/127.6b5f169d.js"><link rel="prefetch" href="/assets/js/128.3208154c.js"><link rel="prefetch" href="/assets/js/129.9395c903.js"><link rel="prefetch" href="/assets/js/13.db8faa28.js"><link rel="prefetch" href="/assets/js/130.c30363b1.js"><link rel="prefetch" href="/assets/js/131.0ac97651.js"><link rel="prefetch" href="/assets/js/132.219a579b.js"><link rel="prefetch" href="/assets/js/133.6f0f76bc.js"><link rel="prefetch" href="/assets/js/134.2e4d205f.js"><link rel="prefetch" href="/assets/js/135.32b88610.js"><link rel="prefetch" href="/assets/js/136.84c40362.js"><link rel="prefetch" href="/assets/js/137.30ebfd60.js"><link rel="prefetch" href="/assets/js/138.8d62761f.js"><link rel="prefetch" href="/assets/js/139.0484efbe.js"><link rel="prefetch" href="/assets/js/14.dd40fe72.js"><link rel="prefetch" href="/assets/js/140.a0a96007.js"><link rel="prefetch" href="/assets/js/141.f786d450.js"><link rel="prefetch" href="/assets/js/142.132e09c2.js"><link rel="prefetch" href="/assets/js/143.6fb0c257.js"><link rel="prefetch" href="/assets/js/144.5502af18.js"><link rel="prefetch" href="/assets/js/145.9ab1fa80.js"><link rel="prefetch" href="/assets/js/146.40dd1a1b.js"><link rel="prefetch" href="/assets/js/147.89f685da.js"><link rel="prefetch" href="/assets/js/148.9784bc69.js"><link rel="prefetch" href="/assets/js/149.358d3989.js"><link rel="prefetch" href="/assets/js/15.418e5643.js"><link rel="prefetch" href="/assets/js/150.85d56963.js"><link rel="prefetch" href="/assets/js/151.75b06976.js"><link rel="prefetch" href="/assets/js/152.badff595.js"><link rel="prefetch" href="/assets/js/153.753e4ab3.js"><link rel="prefetch" href="/assets/js/154.447787bc.js"><link rel="prefetch" href="/assets/js/155.7c69ee37.js"><link rel="prefetch" href="/assets/js/156.cefd7c76.js"><link rel="prefetch" href="/assets/js/157.47fbf046.js"><link rel="prefetch" href="/assets/js/158.5a148160.js"><link rel="prefetch" href="/assets/js/159.b5cc64fa.js"><link rel="prefetch" href="/assets/js/16.adca55aa.js"><link rel="prefetch" href="/assets/js/160.2b54d2f2.js"><link rel="prefetch" href="/assets/js/161.7d643982.js"><link rel="prefetch" href="/assets/js/162.793cb5f2.js"><link rel="prefetch" href="/assets/js/163.d0f31629.js"><link rel="prefetch" href="/assets/js/164.bf6b0830.js"><link rel="prefetch" href="/assets/js/165.ce66946a.js"><link rel="prefetch" href="/assets/js/166.6be36a69.js"><link rel="prefetch" href="/assets/js/167.566740bd.js"><link rel="prefetch" href="/assets/js/168.d6e3647c.js"><link rel="prefetch" href="/assets/js/169.4356690e.js"><link rel="prefetch" href="/assets/js/17.11d4552a.js"><link rel="prefetch" href="/assets/js/170.28c37418.js"><link rel="prefetch" href="/assets/js/171.462a248d.js"><link rel="prefetch" href="/assets/js/172.9a46b238.js"><link rel="prefetch" href="/assets/js/173.f8daa303.js"><link rel="prefetch" href="/assets/js/174.8ade7e99.js"><link rel="prefetch" href="/assets/js/175.3b5aa9b7.js"><link rel="prefetch" href="/assets/js/176.f7ee2479.js"><link rel="prefetch" href="/assets/js/177.f154db3b.js"><link rel="prefetch" href="/assets/js/178.8b106b4d.js"><link rel="prefetch" href="/assets/js/179.ecb20097.js"><link rel="prefetch" href="/assets/js/18.3e9f2232.js"><link rel="prefetch" href="/assets/js/19.7a54fd3d.js"><link rel="prefetch" href="/assets/js/2.7ef33a7b.js"><link rel="prefetch" href="/assets/js/20.8e9d8be9.js"><link rel="prefetch" href="/assets/js/21.8769002f.js"><link rel="prefetch" href="/assets/js/22.0e685557.js"><link rel="prefetch" href="/assets/js/23.bc1b272d.js"><link rel="prefetch" href="/assets/js/24.ad83b2bc.js"><link rel="prefetch" href="/assets/js/25.4cd54044.js"><link rel="prefetch" href="/assets/js/26.da62a656.js"><link rel="prefetch" href="/assets/js/27.892e2271.js"><link rel="prefetch" href="/assets/js/28.c46d3176.js"><link rel="prefetch" href="/assets/js/29.3d6e409a.js"><link rel="prefetch" href="/assets/js/30.c874dc78.js"><link rel="prefetch" href="/assets/js/31.508ff42f.js"><link rel="prefetch" href="/assets/js/32.c0cb2ae4.js"><link rel="prefetch" href="/assets/js/33.75bb17c9.js"><link rel="prefetch" href="/assets/js/34.dc0fbf63.js"><link rel="prefetch" href="/assets/js/35.b113f6c7.js"><link rel="prefetch" href="/assets/js/36.04109ccf.js"><link rel="prefetch" href="/assets/js/37.e6207d49.js"><link rel="prefetch" href="/assets/js/38.734aac40.js"><link rel="prefetch" href="/assets/js/39.7446bb4d.js"><link rel="prefetch" href="/assets/js/40.9a9d2cd3.js"><link rel="prefetch" href="/assets/js/41.92a2dbee.js"><link rel="prefetch" href="/assets/js/42.f6513ead.js"><link rel="prefetch" href="/assets/js/43.338112b6.js"><link rel="prefetch" href="/assets/js/44.b06416af.js"><link rel="prefetch" href="/assets/js/45.a2418a8c.js"><link rel="prefetch" href="/assets/js/46.3d42bbbb.js"><link rel="prefetch" href="/assets/js/47.0ca5be39.js"><link rel="prefetch" href="/assets/js/48.3de6dc6c.js"><link rel="prefetch" href="/assets/js/49.68b04c67.js"><link rel="prefetch" href="/assets/js/5.16bcf2c0.js"><link rel="prefetch" href="/assets/js/50.cd3523b6.js"><link rel="prefetch" href="/assets/js/51.cf0f9311.js"><link rel="prefetch" href="/assets/js/52.26057cfa.js"><link rel="prefetch" href="/assets/js/53.d44b4e79.js"><link rel="prefetch" href="/assets/js/54.d9ef2625.js"><link rel="prefetch" href="/assets/js/55.fa422450.js"><link rel="prefetch" href="/assets/js/56.5c3d322b.js"><link rel="prefetch" href="/assets/js/57.78e2193d.js"><link rel="prefetch" href="/assets/js/58.e4dce92a.js"><link rel="prefetch" href="/assets/js/6.ec5930f7.js"><link rel="prefetch" href="/assets/js/60.97715138.js"><link rel="prefetch" href="/assets/js/61.a5119894.js"><link rel="prefetch" href="/assets/js/62.0068c6b7.js"><link rel="prefetch" href="/assets/js/63.9612e4d8.js"><link rel="prefetch" href="/assets/js/64.17417bda.js"><link rel="prefetch" href="/assets/js/65.8a0bebda.js"><link rel="prefetch" href="/assets/js/66.00d59575.js"><link rel="prefetch" href="/assets/js/67.3f059c94.js"><link rel="prefetch" href="/assets/js/68.f4074b4d.js"><link rel="prefetch" href="/assets/js/69.105797a0.js"><link rel="prefetch" href="/assets/js/7.d7443d92.js"><link rel="prefetch" href="/assets/js/70.471d3fef.js"><link rel="prefetch" href="/assets/js/71.c973592f.js"><link rel="prefetch" href="/assets/js/72.6670ee4e.js"><link rel="prefetch" href="/assets/js/73.5574e51c.js"><link rel="prefetch" href="/assets/js/74.1e33859d.js"><link rel="prefetch" href="/assets/js/75.86222be2.js"><link rel="prefetch" href="/assets/js/76.cb845dd5.js"><link rel="prefetch" href="/assets/js/77.c4981ce7.js"><link rel="prefetch" href="/assets/js/78.7988972a.js"><link rel="prefetch" href="/assets/js/79.0d2f1666.js"><link rel="prefetch" href="/assets/js/8.38c2a278.js"><link rel="prefetch" href="/assets/js/80.56d66164.js"><link rel="prefetch" href="/assets/js/81.fd2f0354.js"><link rel="prefetch" href="/assets/js/82.00b5154c.js"><link rel="prefetch" href="/assets/js/83.5e2b7d34.js"><link rel="prefetch" href="/assets/js/84.de09646c.js"><link rel="prefetch" href="/assets/js/85.7a285974.js"><link rel="prefetch" href="/assets/js/86.8a887163.js"><link rel="prefetch" href="/assets/js/87.5f605acf.js"><link rel="prefetch" href="/assets/js/88.05ebfd53.js"><link rel="prefetch" href="/assets/js/89.5eeceabf.js"><link rel="prefetch" href="/assets/js/9.9a40a415.js"><link rel="prefetch" href="/assets/js/90.a95468ec.js"><link rel="prefetch" href="/assets/js/91.da9df6a3.js"><link rel="prefetch" href="/assets/js/92.90123533.js"><link rel="prefetch" href="/assets/js/93.28790e64.js"><link rel="prefetch" href="/assets/js/94.68c713c5.js"><link rel="prefetch" href="/assets/js/95.2a35e4db.js"><link rel="prefetch" href="/assets/js/96.b4f2bc29.js"><link rel="prefetch" href="/assets/js/97.fb46aaee.js"><link rel="prefetch" href="/assets/js/98.7e991e10.js"><link rel="prefetch" href="/assets/js/99.1cc7e689.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d40b778b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Tech Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/programming/" aria-current="page" class="sidebar-link">/programming/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/dotnet.webp"></span> <span>.NET</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span class="img-container"><img src="/sidebar-imgs/angular.webp"></span> <span>Angular</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/programming/angular/overview.html" class="sidebar-link">Overview</a></li><li><a href="/programming/angular/components.html" class="sidebar-link">Components</a></li><li><a href="/programming/angular/directives.html" class="sidebar-link">Directives</a></li><li><a href="/programming/angular/services.html" class="sidebar-link">Services and DI</a></li><li><a href="/programming/angular/routing.html" class="sidebar-link">Routing</a></li><li><a href="/programming/angular/observables.html" class="sidebar-link">Observables</a></li><li><a href="/programming/angular/forms.html" class="sidebar-link">Forms</a></li><li><a href="/programming/angular/pipes.html" class="sidebar-link">Pipes</a></li><li><a href="/programming/angular/http.html" class="sidebar-link">HTTP</a></li><li><a href="/programming/angular/modules.html" class="sidebar-link">Modules</a></li><li><a href="/programming/angular/ngrx.html" aria-current="page" class="active sidebar-link">NgRx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/programming/angular/ngrx.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/programming/angular/ngrx.html#some-building-blocks" class="sidebar-link">(Some) Building Blocks</a></li><li class="sidebar-sub-header"><a href="/programming/angular/ngrx.html#using-the-store" class="sidebar-link">Using the Store</a></li><li class="sidebar-sub-header"><a href="/programming/angular/ngrx.html#side-effects" class="sidebar-link">Side Effects</a></li><li class="sidebar-sub-header"><a href="/programming/angular/ngrx.html#extra-packages" class="sidebar-link">Extra Packages</a></li><li class="sidebar-sub-header"><a href="/programming/angular/ngrx.html#the-old-api" class="sidebar-link">The Old API</a></li></ul></li><li><a href="/programming/angular/angular-universal.html" class="sidebar-link">Angular Universal</a></li><li><a href="/programming/angular/tips.html" class="sidebar-link">Tips</a></li><li><a href="/programming/angular/standalone-components.html" class="sidebar-link">Standalone Components</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/javascript.webp"></span> <span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/rust.webp"></span> <span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/c.webp"></span> <span>C/C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/gtk.webp"></span> <span>GTK</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/css.webp"></span> <span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/unity.webp"></span> <span>Unity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/lambda.webp"></span> <span>Functional Programming</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/algorithms.webp"></span> <span>Algorithms</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/architecture.webp"></span> <span>Architecture</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="ngrx"><a href="#ngrx" class="header-anchor">#</a> NgRx</h1> <p>NgRx is a framework for managing application state. Without it, our apps would
typically:</p> <ul><li>manage app state via (stateful) services;</li> <li>services would be accessed from various components;</li> <li>there would be no control over state mutations.</li></ul> <p>NgRx is an Angular version of Redux - React's state management framework. It
makes use of RxJS making the state observable. It makes our components less
dependent on services, and it makes services simpler and stateless.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>NgRx is an overkill for smaller applications.</p></div> <h2 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> i @ngrx/store <span class="token comment"># Core</span>
<span class="token function">npm</span> i @ngrx/effects <span class="token comment"># Side-effects</span>
</code></pre></div><h2 id="some-building-blocks"><a href="#some-building-blocks" class="header-anchor">#</a> (Some) Building Blocks</h2> <p>NgRx exposes three main types of entities:</p> <ul><li>store</li> <li>reducers</li> <li>actions</li></ul> <p>There are also <a href="#side-effects">effects</a>, but they come as part of separate
package.</p> <p>There is one store, but there are many actions and reducers:</p> <ul><li>each entity type will have its own reducer (e.g. Products or Users will have
their own reducers)</li> <li>each entity type will have 1 or more actions (e.g. Product will have
AddProduct, UpdateProduct, while Users will have AddUser, RemoveUser, etc.)</li> <li>each feature section of our app will have its own <code>store</code> directory where the
reducer and actions files will be kept</li></ul> <h3 id="actions"><a href="#actions" class="header-anchor">#</a> Actions</h3> <p>Actions are the atomic operations that we want to apply on our state. They
represent the interactions of our users with the data ket in the store. Things
such as adding, modifying, deleting data from our state is exposed via actions.
An action can (optionally) carry some data. Additionally, each action has its
own <code>type</code>. That type is used to inform a reducer about the kind of action that
we want to execute. Action can be viewed as a kind of event.</p> <p>Since actions are typically small, it's OK to keep them all in one file (per
feature). Here's an example:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> props <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ngrx/store&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createAction <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token comment">// no params</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> logout <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'[Auth] Logout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// with params</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loginStart <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">'[Auth] Login Start'</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>Alternatively, we can use this syntax:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> AuthActions <span class="token operator">=</span> <span class="token function">createActionGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span> <span class="token string">'Auth'</span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Logout'</span><span class="token operator">:</span> <span class="token function">emptyProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'Login Start'</span><span class="token operator">:</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The <a href="#legacy-api">Legacy Syntax</a> works as well.</p> <p>Actions are <strong>dispatched</strong>, as we will see a bit later. Actions are a bit
similar to DTO objects. Some actor wants to do something with the store, so it
creates a new <code>Action</code> instance and dispatches it to the store (to be handled by
a reducer).</p> <h3 id="reducers"><a href="#reducers" class="header-anchor">#</a> Reducers</h3> <p>Reducers handle actions in the context of the store. A single reducer will
handle all the actions of a specific entity kind (like a Product). The store in
our app is built with the help of reducers!</p> <p>Reducer is a pure function that is invoked anytime some action is dispatched
(and at the bootstrap of our app!). It receives two parameters:</p> <ul><li>the current state (or an initial state if we set it up this way)</li> <li>the action (with its optional payload)</li></ul> <p>And, it returns the new state.</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
 user<span class="token operator">:</span> User<span class="token punctuation">;</span>
 authError<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
 loading<span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState <span class="token operator">:</span> State <span class="token operator">=</span> <span class="token punctuation">{</span>
  user<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  authError<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  loading<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">const</span> authReducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>

  <span class="token function">on</span><span class="token punctuation">(</span>logout<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>state<span class="token punctuation">,</span>
    user<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token function">on</span><span class="token punctuation">(</span>authenticateSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> email<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> token<span class="token punctuation">,</span> expirationDate <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>
      email<span class="token punctuation">,</span>
      userId<span class="token punctuation">,</span>
      token<span class="token punctuation">,</span>
      expirationDate<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      authError<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      user<span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Multiple actions</p> <p>A single reducer may be &quot;assigned&quot; to multiple actions:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">on</span><span class="token punctuation">(</span>actionOne<span class="token punctuation">,</span> actionTwo<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="custom-block tip"><p class="custom-block-title">Invocation</p> <p>Reducers are not invoked by our app components directly. Instead, it is handled by
NgRx when we <a href="#dispatch">dispatch some action</a> or on init (with action type set
to <em>@ngrx/store/init</em>).</p></div> <div class="custom-block warning"><p class="custom-block-title">State Modifications</p> <p>Reducer should always return new object(s). Modifications of existing state are
forbidden! That's why we use the spread operator. If our state is more complex,
we need to deal with that properly, since the spread operator only does a
shallow copy.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>When any action is dispatched in our app, ALL the reducers will get invoked.
Whether they handle the action though is determined by the <code>on</code> functions within
it.</p></div> <p>It's important to mention that reducers are very limited in what they actually
do. They should first of all take care of the store. They should not interact
with the ourside world. Things such as network requests, accessing storage, etc.</p> <ul><li>these should be left to <a href="#side-effects">effects</a>.</li></ul> <h3 id="store-type"><a href="#store-type" class="header-anchor">#</a> Store Type</h3> <p>We probably are going to have a few kinds of data and a few reducers. It makes
sense to define a global type that defines all kinds of data being stored:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// naming convention for imports</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromproductsCatalog <span class="token keyword">from</span> <span class="token string">&quot;../products/store/products-catalog.reducer&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromAuth <span class="token keyword">from</span> <span class="token string">&quot;../auth/store/auth.reducer&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AppState</span> <span class="token punctuation">{</span>
  productsCatalog<span class="token operator">:</span> fromProductsCatalog<span class="token punctuation">.</span>State<span class="token punctuation">,</span> <span class="token comment">// stores stuff related to products catalog</span>
  auth<span class="token operator">:</span> fromAuth<span class="token punctuation">.</span>State <span class="token comment">// stores auth data (like currently logged-in user)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With such a type, it's easier to inject the store into classes. Since the
<code>AppState</code> type is global within our app, it makes sense to put it in its own
file called <code>app.reducer.ts</code>, in the <code>/app/store/</code> directory.</p> <p>In the same file, we can also put the listing of all the reducers within our app:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> appReducer<span class="token operator">:</span> ActionReducerMap<span class="token operator">&lt;</span>AppState<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  shoppingList<span class="token operator">:</span> fromShoppingList<span class="token punctuation">.</span>shoppingListReducer<span class="token punctuation">,</span>
  auth<span class="token operator">:</span> fromAuth<span class="token punctuation">.</span>authReducer
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>It will come useful very quickly.</p> <h2 id="using-the-store"><a href="#using-the-store" class="header-anchor">#</a> Using the Store</h2> <h3 id="register"><a href="#register" class="header-anchor">#</a> Register</h3> <p>First of all, our store needs to be imported in some module:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromApp <span class="token keyword">from</span> <span class="token string">&quot;./store/app.reducer&quot;</span><span class="token punctuation">;</span> <span class="token comment">// again, import convention</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">NgModule</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span>
    AppComponent
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    BrowserModule<span class="token punctuation">,</span>
    StoreModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span>fromApp<span class="token punctuation">.</span>appReducer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// appReducer is our reducers map</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  bootstrap<span class="token operator">:</span> <span class="token punctuation">[</span>AppComponent<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>This is the place where we inform the framework of any reducers that we have
defined. In the end, the reducers build up the store in the app.</p> <div class="custom-block tip"><p class="custom-block-title">Features</p> <p>We can also register different parts of our state in feature modules.</p> <div class="language-ts extra-class"><pre class="language-ts"><code>StoreModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span>myFeatureKey<span class="token punctuation">,</span> myFeatureReducer<span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="inject"><a href="#inject" class="header-anchor">#</a> Inject</h3> <p>Our components or services may inject the <code>Store</code> in order to access
its data:</p> <div class="language-ts extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromApp <span class="token keyword">from</span> <span class="token string">&quot;../store/app.reducer&quot;</span><span class="token punctuation">;</span>

<span class="token function">constructor</span><span class="token punctuation">(</span>
  <span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>fromApp<span class="token punctuation">.</span>AppState<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p>The <code>Store&lt;&gt;</code> is a generic type. Thanks to <a href="#store-type">Store Type</a> being
defined as an interface, we can quickly specify our store.</p> <h3 id="use"><a href="#use" class="header-anchor">#</a> Use</h3> <h4 id="dispatch"><a href="#dispatch" class="header-anchor">#</a> Dispatch</h4> <p>We can dispatch actions like this:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProductsCatalogActions</span><span class="token punctuation">.</span><span class="token function">AddProduct</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>That dispatch will go through NgRx's internals, which will invoke our reducer.
Based on the action (<code>AddProduct</code>) it will update the store with the new
<code>product</code>.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Whenever we dispatch some action, it's not just the corresponding reducer that
gets invoked. All the reducers get invoked! Only one of them will have proper
handler for the supplied action type, other reducers will just execute their
&quot;default&quot; case.</p></div> <h4 id="subscribe"><a href="#subscribe" class="header-anchor">#</a> Subscribe</h4> <p>Store's data is exposed via <code>Observable</code>s:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>products$<span class="token operator">:</span> Observable<span class="token operator">&lt;</span><span class="token punctuation">{</span> products<span class="token operator">:</span> products<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>products$ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'productsCatalog'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Any <code>dispatch</code> that &quot;modifies&quot; the store, would bring data via the subscription.</p> <div class="custom-block warning"><p class="custom-block-title">Unsibscribe</p> <p>Like with any subscription, we need to rememebr to <code>unsubscribe</code> on destroy.</p></div> <h2 id="side-effects"><a href="#side-effects" class="header-anchor">#</a> Side Effects</h2> <p>(<a href="https://www.npmjs.com/package/@ngrx/effects" target="_blank" rel="noopener noreferrer">@ngrx/effects<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) is an additional
package for NgRx that adds <strong>Side Effects</strong>. Until now we had some actions
defined, and reducers that acted on them. Reducers focused on state
&quot;modifications&quot;. They should not contain any logic other than that.</p> <p>Our state actions are often associated with some additional logic that we need
to execute - sending some network request, storing some data in local storage,
etc. Reducers shouldn't execute these, because they are pure functions.
However, <em>effects</em> can do all those things.</p> <p>Each feature in our app can have its own <code>store/*.effects.ts</code> file. Here's an
example:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthEffects</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> actions$<span class="token operator">:</span> Actions<span class="token punctuation">,</span>
    <span class="token keyword">private</span> httpClient<span class="token operator">:</span> HttpClient<span class="token punctuation">,</span>
    <span class="token keyword">private</span> router<span class="token operator">:</span> Router<span class="token punctuation">,</span>
    <span class="token keyword">private</span> authService<span class="token operator">:</span> AuthService<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

 <span class="token comment">// dispatches another action</span>
  authSignUp$ <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span>signUpStart<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>AuthResponseData<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
        <span class="token string">&quot;https://identity-provider.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          email<span class="token punctuation">,</span>
          password
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">,</span>
        <span class="token function">map</span><span class="token punctuation">(</span>handleAuthentication<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">catchError</span><span class="token punctuation">(</span>handleError<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// does not dispatch any actions</span>
  authLogout$ <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span>AuthActions<span class="token punctuation">.</span>logout<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">clearLogoutTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">'userData'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/auth'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> dispatch<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Effects for a given domain is a class with properties representing different
effects.</p> <p>Effects typically return observable of NgRx actions. Example of that could be an
effect that:</p> <ol><li>Listens for the <em>[Auth] Login Start</em> actions.</li> <li>Wehever such action comes in, it sends a login request to some authentication
server.</li> <li>When the response comes back, it either issues <em>[Auth] Logic Success</em> or
<em>[Auth] Login Fail</em> action.</li> <li>The reducer sets up the state properly for all 3 kinds of actions mentioned
above (it handles them before their effects are executed!).</li> <li>Some UI component subscribes to state changes and reacts properly to each
state change.</li></ol> <p>In some cases though, effects do not emit any actions. Instead, an effect could
use a <a href="/programming/angular/routing.html">Router</a> to redirect the user somewhere else. To do that,
the <code>createEffect</code> function needs to be provided with a second argument:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">{</span> dispatch<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Reducer for a given action is ALWAYS executed before effect(s).</p></div> <p>With effects, our components can be decoupled from the logic of how to do some
external activity (like, how to get some data). All component does is it invokes
some action like <code>FetchBooks</code>. It also subscribes to the <code>books</code> slice of the
store to receive the books as soon as they arrive.</p> <h3 id="accessing-state"><a href="#accessing-state" class="header-anchor">#</a> Accessing State</h3> <p>Accessing state within an action is possible with the <code>withLatestFrom</code> <a href="/programming/angular/observables.html">RxJs</a> operator. It joins the original observable with data
from some another observable (like some state selector).</p> <p>The <code>storeRecipes</code> effect from up above made use of that operator.</p> <h2 id="extra-packages"><a href="#extra-packages" class="header-anchor">#</a> Extra Packages</h2> <h3 id="redux-dev-tools"><a href="#redux-dev-tools" class="header-anchor">#</a> Redux Dev Tools</h3> <p><a href="https://github.com/reduxjs/redux-devtools" target="_blank" rel="noopener noreferrer">Redux Dev Tools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a browser
extension (or standalone app) that is similar to browser DevTools. It requires
the app to be extended with DevTools module, which is not ideal, but allows us
to see in detail what happens with the store:</p> <ul><li>actions being emited</li> <li>shape of the store after each action</li> <li>and more...</li></ul> <h3 id="router-store"><a href="#router-store" class="header-anchor">#</a> Router Store</h3> <p>An offical package from NgRx
<a href="https://www.npmjs.com/package/@ngrx/router-store" target="_blank" rel="noopener noreferrer">@ngrx/router-store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is an
addition that emits <a href="#actions">actions</a> based on <a href="/programming/angular/routing.html">Router</a>'s
activity. Whenever some navigation happens, etc., a specific action type is
emitted with some payload, allowing us to react to it in our actions or
reducers.</p> <h2 id="the-old-api"><a href="#the-old-api" class="header-anchor">#</a> The Old API</h2> <p>Many projects still use the older API exposed by NgRx. Some of the below code
would generate warnings, because the classes/methods are obsolete.</p> <h3 id="actions-2"><a href="#actions-2" class="header-anchor">#</a> Actions</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// action types - there's a convention of prefixing string with the name of feature</span>
<span class="token comment">// in square brackets to avoid potential conflicts with other features</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_PRODUCT</span> <span class="token operator">=</span> <span class="token string">'[Products Catalog] Add Product'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ADD_PRODUCTS</span> <span class="token operator">=</span> <span class="token string">'[Products Catalog] Add Products'</span><span class="token punctuation">;</span>

<span class="token comment">// actions</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AddProduct</span> <span class="token keyword">implements</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> type <span class="token operator">=</span> <span class="token constant">ADD_INGREDIENT</span><span class="token punctuation">;</span> <span class="token comment">// comes with the Action interface</span>

  <span class="token comment">// optional data</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> payload<span class="token operator">:</span> Product<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AddProducts</span> <span class="token keyword">implements</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span>
  <span class="token keyword">readonly</span> type <span class="token operator">=</span> <span class="token constant">ADD_INGREDIENTS</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> payload<span class="token operator">:</span> Product<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// such a union type makes the reducer's code more succinct</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ProductsActions</span> <span class="token operator">=</span> AddIngredient <span class="token operator">|</span> AddIngredients<span class="token punctuation">;</span>
</code></pre></div><h3 id="reducer"><a href="#reducer" class="header-anchor">#</a> Reducer</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// a typical import grouping all actions under one object</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ProductsCatalogActions <span class="token keyword">from</span> <span class="token string">&quot;./products.actions&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// a type of ProductsCatalog state.</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> Product<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  selectedProduct<span class="token operator">?</span><span class="token operator">:</span> Product
<span class="token punctuation">}</span>

<span class="token comment">// optional initial state</span>
<span class="token keyword">const</span> initialState<span class="token operator">:</span> State <span class="token operator">=</span> <span class="token punctuation">{</span>
  products<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Book'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Ingredient</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Steam Deck'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  selectedProduct<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

<span class="token comment">// the actual reducer is a function</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">productsCatalogReducer</span><span class="token punctuation">(</span>
  state<span class="token operator">:</span> State <span class="token operator">=</span> initialState<span class="token punctuation">,</span> <span class="token comment">// reducer will be called by Angular on init with null state, so initialStae will jump in</span>
  action<span class="token operator">:</span> ProductsCatalogActions<span class="token punctuation">.</span>ProductsActions <span class="token comment">// our action union type</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handles each action</span>
  <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> ProductsActions<span class="token punctuation">.</span><span class="token constant">ADD_PRODUCT</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token comment">// a typicl pattern of copying the rest of the previous state</span>
        products<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>products<span class="token punctuation">,</span> action<span class="token punctuation">.</span>payload <span class="token punctuation">]</span> <span class="token comment">// products field of the state gets replaced</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">case</span> ProductsActions<span class="token punctuation">.</span><span class="token constant">ADD_PRODUCTS</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        products<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>state<span class="token punctuation">.</span>products<span class="token punctuation">,</span> <span class="token operator">...</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">// the initial call (invoked by Angular) will not have any action.type, we return the initialState here</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="effects"><a href="#effects" class="header-anchor">#</a> Effects</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RecipesEffects</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> actions$<span class="token operator">:</span> Actions<span class="token punctuation">,</span> 
    <span class="token keyword">private</span> httpClient<span class="token operator">:</span> HttpClient<span class="token punctuation">,</span> 
    <span class="token keyword">private</span> store<span class="token operator">:</span> Store<span class="token operator">&lt;</span>fromApp<span class="token punctuation">.</span>AppState<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Effect</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  fetchRecipes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span>RecipesActions<span class="token punctuation">.</span><span class="token constant">FETCH_RECIPES</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>Recipe<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;https://my-api.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>recipes <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> recipes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>recipe <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>recipe<span class="token punctuation">,</span>
          ingredients<span class="token operator">:</span> recipe<span class="token punctuation">.</span>ingredients <span class="token operator">?</span> recipe<span class="token punctuation">.</span>ingredients <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">map</span><span class="token punctuation">(</span>recipes <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SetRecipes</span><span class="token punctuation">(</span>recipes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Effect</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  storeRecipes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>actions$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ofType</span><span class="token punctuation">(</span>RecipesActions<span class="token punctuation">.</span><span class="token constant">STORE_RECIPES</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">withLatestFrom</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'recipes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> recipes <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;https://recipes.api.com&quot;</span><span class="token punctuation">,</span>
        recipes<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/programming/angular/modules.html" class="prev">
        Modules
      </a></span> <span class="next"><a href="/programming/angular/angular-universal.html">
        Angular Universal
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/12/2023, 5:06:29 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a63cdd32.js" defer></script><script src="/assets/js/4.1cfa6f61.js" defer></script><script src="/assets/js/1.edb2ab2a.js" defer></script><script src="/assets/js/59.cb2bd608.js" defer></script>
  </body>
</html>
