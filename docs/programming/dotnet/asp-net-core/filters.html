<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Filters | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Filters in ASP.NET Core">
    <meta property="og:url" content="/programming/dotnet/asp-net-core/filters.html">
    <meta property="og:site_name" content="Marcin Jahn | Technology Notebook">
    <meta property="og:title" content="Filters">
    <meta property="og:description" content="Filters in ASP.NET Core">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Technology Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.8f8d1251.css" as="style"><link rel="preload" href="/assets/js/app.7b03465d.js" as="script"><link rel="preload" href="/assets/js/2.36a2c6d0.js" as="script"><link rel="preload" href="/assets/js/21.62d9c10b.js" as="script"><link rel="prefetch" href="/assets/js/10.271ec805.js"><link rel="prefetch" href="/assets/js/100.11545a76.js"><link rel="prefetch" href="/assets/js/101.a3e35fa5.js"><link rel="prefetch" href="/assets/js/102.3043b705.js"><link rel="prefetch" href="/assets/js/103.4cd17f51.js"><link rel="prefetch" href="/assets/js/104.efb156b9.js"><link rel="prefetch" href="/assets/js/105.cd8ec472.js"><link rel="prefetch" href="/assets/js/106.0429ba77.js"><link rel="prefetch" href="/assets/js/107.0feef589.js"><link rel="prefetch" href="/assets/js/108.63ca75d0.js"><link rel="prefetch" href="/assets/js/109.c704fe50.js"><link rel="prefetch" href="/assets/js/11.c8949bba.js"><link rel="prefetch" href="/assets/js/110.8d787563.js"><link rel="prefetch" href="/assets/js/111.02592af9.js"><link rel="prefetch" href="/assets/js/112.c75f45a1.js"><link rel="prefetch" href="/assets/js/113.b8926304.js"><link rel="prefetch" href="/assets/js/114.c2da58ad.js"><link rel="prefetch" href="/assets/js/115.85ce4d7e.js"><link rel="prefetch" href="/assets/js/116.fc80e726.js"><link rel="prefetch" href="/assets/js/117.bff48cff.js"><link rel="prefetch" href="/assets/js/118.ea0ebb41.js"><link rel="prefetch" href="/assets/js/119.81458c75.js"><link rel="prefetch" href="/assets/js/12.45ae2e1a.js"><link rel="prefetch" href="/assets/js/120.db62f06f.js"><link rel="prefetch" href="/assets/js/121.bf61cd70.js"><link rel="prefetch" href="/assets/js/122.4d67800c.js"><link rel="prefetch" href="/assets/js/123.32c8d274.js"><link rel="prefetch" href="/assets/js/124.f5a22512.js"><link rel="prefetch" href="/assets/js/125.f813ca0b.js"><link rel="prefetch" href="/assets/js/126.0dd68138.js"><link rel="prefetch" href="/assets/js/127.efdf023e.js"><link rel="prefetch" href="/assets/js/128.e175039f.js"><link rel="prefetch" href="/assets/js/129.4c038db5.js"><link rel="prefetch" href="/assets/js/13.e190eea0.js"><link rel="prefetch" href="/assets/js/130.bd0159b9.js"><link rel="prefetch" href="/assets/js/131.cf8944ea.js"><link rel="prefetch" href="/assets/js/132.9a088074.js"><link rel="prefetch" href="/assets/js/133.364e8a04.js"><link rel="prefetch" href="/assets/js/134.94dbeb82.js"><link rel="prefetch" href="/assets/js/135.497bdd31.js"><link rel="prefetch" href="/assets/js/136.811224f5.js"><link rel="prefetch" href="/assets/js/137.e85a314c.js"><link rel="prefetch" href="/assets/js/138.10da8ebf.js"><link rel="prefetch" href="/assets/js/139.f27a12d3.js"><link rel="prefetch" href="/assets/js/14.097b720c.js"><link rel="prefetch" href="/assets/js/15.098d835a.js"><link rel="prefetch" href="/assets/js/16.d602d9cd.js"><link rel="prefetch" href="/assets/js/17.0eea71d6.js"><link rel="prefetch" href="/assets/js/18.8ee72991.js"><link rel="prefetch" href="/assets/js/19.071a3642.js"><link rel="prefetch" href="/assets/js/20.a6abb0e6.js"><link rel="prefetch" href="/assets/js/22.4a097822.js"><link rel="prefetch" href="/assets/js/23.044add3a.js"><link rel="prefetch" href="/assets/js/24.286bebc9.js"><link rel="prefetch" href="/assets/js/25.f5ca6f1e.js"><link rel="prefetch" href="/assets/js/26.50f751f3.js"><link rel="prefetch" href="/assets/js/27.62e987ed.js"><link rel="prefetch" href="/assets/js/28.ee1355b0.js"><link rel="prefetch" href="/assets/js/29.7fa2b670.js"><link rel="prefetch" href="/assets/js/3.26d57cde.js"><link rel="prefetch" href="/assets/js/30.91a8e4c5.js"><link rel="prefetch" href="/assets/js/31.4d55d4ba.js"><link rel="prefetch" href="/assets/js/32.764694ea.js"><link rel="prefetch" href="/assets/js/33.af7d0528.js"><link rel="prefetch" href="/assets/js/34.7ca80cf3.js"><link rel="prefetch" href="/assets/js/35.6b53fb08.js"><link rel="prefetch" href="/assets/js/36.d33384df.js"><link rel="prefetch" href="/assets/js/37.787d1c8b.js"><link rel="prefetch" href="/assets/js/38.616448ed.js"><link rel="prefetch" href="/assets/js/39.9d066180.js"><link rel="prefetch" href="/assets/js/4.dfa29469.js"><link rel="prefetch" href="/assets/js/40.14ca74e5.js"><link rel="prefetch" href="/assets/js/41.ac5684e8.js"><link rel="prefetch" href="/assets/js/42.ca412ed2.js"><link rel="prefetch" href="/assets/js/43.8db5cdd5.js"><link rel="prefetch" href="/assets/js/44.67018cbd.js"><link rel="prefetch" href="/assets/js/45.1694db28.js"><link rel="prefetch" href="/assets/js/46.ca8f4d43.js"><link rel="prefetch" href="/assets/js/47.8d08aed3.js"><link rel="prefetch" href="/assets/js/48.bf89838f.js"><link rel="prefetch" href="/assets/js/49.6af3aa82.js"><link rel="prefetch" href="/assets/js/5.42fecfd8.js"><link rel="prefetch" href="/assets/js/50.e04a52be.js"><link rel="prefetch" href="/assets/js/51.f21e43c9.js"><link rel="prefetch" href="/assets/js/52.245e651f.js"><link rel="prefetch" href="/assets/js/53.e3537480.js"><link rel="prefetch" href="/assets/js/54.eca631d3.js"><link rel="prefetch" href="/assets/js/55.43a84e35.js"><link rel="prefetch" href="/assets/js/56.cf5a9d8b.js"><link rel="prefetch" href="/assets/js/57.e5ec317c.js"><link rel="prefetch" href="/assets/js/58.e12822c8.js"><link rel="prefetch" href="/assets/js/59.ffb27c91.js"><link rel="prefetch" href="/assets/js/6.606a3e1d.js"><link rel="prefetch" href="/assets/js/60.8b29fd47.js"><link rel="prefetch" href="/assets/js/61.174efb01.js"><link rel="prefetch" href="/assets/js/62.d4ec2744.js"><link rel="prefetch" href="/assets/js/63.607654a6.js"><link rel="prefetch" href="/assets/js/64.13c7091e.js"><link rel="prefetch" href="/assets/js/65.1f08d192.js"><link rel="prefetch" href="/assets/js/66.3863080e.js"><link rel="prefetch" href="/assets/js/67.83c4aa14.js"><link rel="prefetch" href="/assets/js/68.2c1f392e.js"><link rel="prefetch" href="/assets/js/69.7f48b160.js"><link rel="prefetch" href="/assets/js/7.bbb2dfe1.js"><link rel="prefetch" href="/assets/js/70.1f898769.js"><link rel="prefetch" href="/assets/js/71.f0b72368.js"><link rel="prefetch" href="/assets/js/72.6f3464df.js"><link rel="prefetch" href="/assets/js/73.6ce8b2f1.js"><link rel="prefetch" href="/assets/js/74.1c75ba80.js"><link rel="prefetch" href="/assets/js/75.8274a770.js"><link rel="prefetch" href="/assets/js/76.e030185d.js"><link rel="prefetch" href="/assets/js/77.6fc4c27c.js"><link rel="prefetch" href="/assets/js/78.f64999a5.js"><link rel="prefetch" href="/assets/js/79.8fe89075.js"><link rel="prefetch" href="/assets/js/8.86407f37.js"><link rel="prefetch" href="/assets/js/80.7dbf4be8.js"><link rel="prefetch" href="/assets/js/81.07b6158e.js"><link rel="prefetch" href="/assets/js/82.1bc222bf.js"><link rel="prefetch" href="/assets/js/83.6200cc4e.js"><link rel="prefetch" href="/assets/js/84.430c0054.js"><link rel="prefetch" href="/assets/js/85.3d6215c4.js"><link rel="prefetch" href="/assets/js/86.34770a2a.js"><link rel="prefetch" href="/assets/js/87.71d3bfa3.js"><link rel="prefetch" href="/assets/js/88.4eadf1a1.js"><link rel="prefetch" href="/assets/js/89.b31a47ab.js"><link rel="prefetch" href="/assets/js/9.adfb7c91.js"><link rel="prefetch" href="/assets/js/90.6601dd7a.js"><link rel="prefetch" href="/assets/js/91.ce16fe30.js"><link rel="prefetch" href="/assets/js/92.81b69a02.js"><link rel="prefetch" href="/assets/js/93.e65d18b6.js"><link rel="prefetch" href="/assets/js/94.52785345.js"><link rel="prefetch" href="/assets/js/95.a5f82b29.js"><link rel="prefetch" href="/assets/js/96.d5ab8da2.js"><link rel="prefetch" href="/assets/js/97.823e7667.js"><link rel="prefetch" href="/assets/js/98.ea63d3fc.js"><link rel="prefetch" href="/assets/js/99.a4f7c31e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f8d1251.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/programming/" aria-current="page" class="sidebar-link">/programming/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span class="img-container"><img src="/sidebar-imgs/dotnet.webp"></span> <span>.NET</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/programming/dotnet/http-client.html" class="sidebar-link">HTTPClient</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>Async</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/programming/dotnet/equality.html" class="sidebar-link">Equality</a></li><li><a href="/programming/dotnet/comparisons.html" class="sidebar-link">Comparisons</a></li><li><a href="/programming/dotnet/generic-host.html" class="sidebar-link">Generic Host</a></li><li><a href="/programming/dotnet/logging.html" class="sidebar-link">Logging</a></li><li><a href="/programming/dotnet/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/programming/dotnet/records.html" class="sidebar-link">Records</a></li><li><a href="/programming/dotnet/grpc.html" class="sidebar-link">gRPC</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><!----> <span>ASP.NET Core</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/programming/dotnet/asp-net-core/overview.html" class="sidebar-link">Overview</a></li><li><a href="/programming/dotnet/asp-net-core/middleware.html" class="sidebar-link">Middleware</a></li><li><a href="/programming/dotnet/asp-net-core/razor-pages.html" class="sidebar-link">Razor Pages</a></li><li><a href="/programming/dotnet/asp-net-core/razor-pages-routing.html" class="sidebar-link">Routing in Razor Pages</a></li><li><a href="/programming/dotnet/asp-net-core/web-apis.html" class="sidebar-link">Web APIs</a></li><li><a href="/programming/dotnet/asp-net-core/filters.html" aria-current="page" class="active sidebar-link">Filters</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/programming/dotnet/asp-net-core/filters.html#comparison-with-the-middleware" class="sidebar-link">Comparison with the Middleware</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/asp-net-core/filters.html#types" class="sidebar-link">Types</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/asp-net-core/filters.html#implementation" class="sidebar-link">Implementation</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/asp-net-core/filters.html#application" class="sidebar-link">Application</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/asp-net-core/filters.html#dependency-injection" class="sidebar-link">Dependency Injection</a></li></ul></li><li><a href="/programming/dotnet/asp-net-core/identity.html" class="sidebar-link">Identity</a></li><li><a href="/programming/dotnet/asp-net-core/validation.html" class="sidebar-link">Validation</a></li><li><a href="/programming/dotnet/asp-net-core/tips.html" class="sidebar-link">Tips</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>Entity Framework Core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>Functional Programming</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/javascript.webp"></span> <span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/rust.webp"></span> <span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/c.webp"></span> <span>C/C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/css.webp"></span> <span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/unity.webp"></span> <span>Unity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/algorithms.webp"></span> <span>Algorithms</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="filters-in-asp-net-core"><a href="#filters-in-asp-net-core" class="header-anchor">#</a> Filters in ASP.NET Core</h1> <p>Filters act as a pipeline, similarly to middleware. They can be used both with
MVC and Razor Pages. They can be applied to individual controllers, actions or
globally, to all of them. Filters run as part of Endpoint middleware.</p> <h2 id="comparison-with-the-middleware"><a href="#comparison-with-the-middleware" class="header-anchor">#</a> Comparison with the Middleware</h2> <p>Filters is like a small middleware. It hooks into the lifecycle of a
request-response procedure.</p> <p>Differences:</p> <ul><li>Middleware runs for ALL requests, filters run for selected requests (or
globally as well).</li> <li>Filters have access to <code>HttpContext</code> and MVC constructs such as <code>ModelState</code>
and <code>IActionResult</code>. Middleware has access only to <code>HttpContext</code>.</li></ul> <p>Middleware is more general and it's designed to solve concerns that are
cross-cutting throughout the app.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Use the middleware if the code we want to write is happy with the information
provided by the <code>HttpContext</code> and if the code should apply to all requests.</p></div> <h2 id="types"><a href="#types" class="header-anchor">#</a> Types</h2> <p>There are 5 types of filters, each one running at a different stage (MVC):</p> <ul><li><strong>Authorization</strong> (request only) - short-circuits the request if it's unauthorized</li> <li><strong>Resource</strong> (2-ways) - they can have many use-cases, depending on needs. It
runs before model binding.</li> <li><strong>Action</strong> (2-ways) - runs after model binding. We can manipulate action's
arguments; or they can modify action's response</li> <li><strong>Exception</strong> - catch exceptions allowing us to prepare a better response. It catches exceptions in:
<ul><li>model binding and validation</li> <li>actions execution</li> <li>action/page filter execution</li></ul></li> <li><strong>Result</strong> (2-way) - run before and after <code>IActionResult</code> is executed, we can
control that execution within a filter.</li></ul> <div class="custom-block tip"><p class="custom-block-title">Razor Pages</p> <p>The difference in Razor Pages is that the <strong>Action Filter</strong> is called
<strong>Page Filter</strong>. The Page Filters run 3 times:</p> <ul><li>after page handler selection - before binding and validation; we can't
short-circuit at this point</li> <li>after model binding - we can modify the model-bound data; we can short-circuit</li> <li>after page handler execution - we can modify the <code>IActionResult</code></li></ul></div> <p>Filters registered globally will be executed for both MVC and Razor Pages.</p> <div class="custom-block tip"><p class="custom-block-title">Result</p> <p>If we short-circuit the Action/Page filter, the Result filter will still be
executed!</p></div> <p><img src="/assets/img/filter-pipeline.683a79f4.png" alt=""></p> <h2 id="implementation"><a href="#implementation" class="header-anchor">#</a> Implementation</h2> <p>Non-global filters are implemented as attributes. The order of attributes
application dictates the order of filters execution.</p> <p>Filters can be sync or async. Each filter type has two interfaces for that reason.
For example, the Authorization filter has:</p> <ul><li><code>IAuthorizationFilter</code></li> <li><code>IAsyncAuthorizationFilter</code></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Only one of the interfaces should get implemented. If we implement both, the
<em>async</em> one will be executed anyway.</p></div> <p>The synchronous filters that execute multiple times (twice or 3 times) have
separate methods in their interface for each of the executions. The asynchronous
ones have one method and delegates that we need to execute between
request/response operations.</p> <p>Here's an example of a synchronous filter:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogResourceFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IResourceFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Request</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResourceExecuting</span><span class="token punctuation">(</span><span class="token class-name">ResourceExecutingContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;My sync Resource filter (executing)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Response</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnResourceExecuted</span><span class="token punctuation">(</span><span class="token class-name">ResourceExecutedContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;My sync Resource filter (executed)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Here's an example of an asynchronous filter:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncLogResourceFilter</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span><span class="token punctuation">,</span> <span class="token class-name">IAsyncResourceFilter</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">OnResourceExecutionAsync</span><span class="token punctuation">(</span>
        <span class="token class-name">ResourceExecutingContext</span> context<span class="token punctuation">,</span> <span class="token class-name">ResourceExecutionDelegate</span> next<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;My async Resource filter (executing)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> executedContext <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;My async Resource filter (executed)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Short-circuiting</p> <p>To short-circuit a request we need to set the <code>context.Result</code> property with
some <code>IActionResult</code>.</p></div> <div class="custom-block tip"><p class="custom-block-title">ControllerBase</p> <p>The <code>ControllerBase</code> class implements <code>IActionFilter</code> and <code>IAsyncActionFilter</code>.
If we need an Action filter for a single controller we can just override
controller's methods of that filter and they will be executed for every action.</p></div> <h2 id="application"><a href="#application" class="header-anchor">#</a> Application</h2> <p>Filters can be applied:</p> <ul><li>globally</li> <li>to MVC:
<ul><li>controllers</li> <li>actions</li></ul></li> <li>to Razor Pages
<ul><li><code>PageModel</code> (not individual methods)</li></ul></li></ul> <h3 id="global"><a href="#global" class="header-anchor">#</a> Global</h3> <p>Both MVC and Razor Pages:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddControllers</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LogResourceFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Just the Razor Pages:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddMvcOptions</span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        options<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LogResourceFilter<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mvc"><a href="#mvc" class="header-anchor">#</a> MVC</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">LogResourceFilter</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">LogResourceFilter2</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/other&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="page-model"><a href="#page-model" class="header-anchor">#</a> Page Model</h3> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">LogResourceFilter</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PrivacyModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PageModel</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="order"><a href="#order" class="header-anchor">#</a> Order</h3> <p>Filters are executed in the following order for a request:</p> <ol><li>global filters</li> <li>controller filters</li> <li>base controller filters</li> <li>action filters</li></ol> <div class="custom-block warning"><p class="custom-block-title">Request and Response</p> <p>The list above is reversed when the RESPONSE travels through the pipeline
(<code>*Executed</code> methods).</p></div> <div class="custom-block tip"><p class="custom-block-title">Atributes Order</p> <p>The order of attributes application on an entity is respected in execution.</p></div> <h4 id="iorderfilter"><a href="#iorderfilter" class="header-anchor">#</a> IOrderFilter</h4> <p>We can change the default order of execution by implementing the <code>IOrderFilter</code>
interface, which has just one property - <code>int Order</code>. Lower value of <code>Order</code>
moves filter up in the queue. Filters with the same <code>Order</code> execute using the
framework's ordering rules, presented before.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Filters that do not implement <code>IOrderFilter</code> are assumer to have <code>Order = 0</code>.</p></div> <h2 id="dependency-injection"><a href="#dependency-injection" class="header-anchor">#</a> Dependency Injection</h2> <p>Since filters are attributes (unless global), it's not easy to inject services
into them. Filters are singletons. One approach would be to use the <em>service
locator</em> pattern, but nobody likes that.</p> <p>Instead, a filter could be split into two classes:</p> <ul><li>one implementing the <code>I*Filter</code> - it would contain the DI and filter
functionality</li> <li>another one implementing either <code>TypeFilterAttribute</code> or
<code>SerivceFilterAttribute</code>.</li></ul> <p>The solution is based on <code>IFilterFactory</code> that ASP.NET Core &quot;understands&quot; and it
knows how to handle it.</p></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/programming/dotnet/asp-net-core/web-apis.html" class="prev">
        Web APIs
      </a></span> <span class="next"><a href="/programming/dotnet/asp-net-core/identity.html">
        Identity
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/2/2022, 2:58:06 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7b03465d.js" defer></script><script src="/assets/js/2.36a2c6d0.js" defer></script><script src="/assets/js/21.62d9c10b.js" defer></script>
  </body>
</html>
