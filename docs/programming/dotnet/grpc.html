<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>gRPC | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="gRPC in .NET">
    <meta property="og:url" content="/programming/dotnet/grpc.html">
    <meta property="og:site_name" content="Marcin Jahn | Technology Notebook">
    <meta property="og:title" content="gRPC">
    <meta property="og:description" content="gRPC in .NET">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Technology Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.8f8d1251.css" as="style"><link rel="preload" href="/assets/js/app.7d9d734a.js" as="script"><link rel="preload" href="/assets/js/2.58419cab.js" as="script"><link rel="preload" href="/assets/js/65.c52f6ba4.js" as="script"><link rel="prefetch" href="/assets/js/10.02052466.js"><link rel="prefetch" href="/assets/js/100.be8b0aec.js"><link rel="prefetch" href="/assets/js/101.cf31aa83.js"><link rel="prefetch" href="/assets/js/102.5137acb2.js"><link rel="prefetch" href="/assets/js/103.48484638.js"><link rel="prefetch" href="/assets/js/104.b9e49053.js"><link rel="prefetch" href="/assets/js/105.4f622dfd.js"><link rel="prefetch" href="/assets/js/106.229b995d.js"><link rel="prefetch" href="/assets/js/107.21d0367e.js"><link rel="prefetch" href="/assets/js/108.71e1ff1a.js"><link rel="prefetch" href="/assets/js/109.9756c3a9.js"><link rel="prefetch" href="/assets/js/11.cca7929d.js"><link rel="prefetch" href="/assets/js/110.638b11f5.js"><link rel="prefetch" href="/assets/js/111.faada459.js"><link rel="prefetch" href="/assets/js/112.4e425b8b.js"><link rel="prefetch" href="/assets/js/113.56b666ac.js"><link rel="prefetch" href="/assets/js/114.31887147.js"><link rel="prefetch" href="/assets/js/115.c361be42.js"><link rel="prefetch" href="/assets/js/116.85398592.js"><link rel="prefetch" href="/assets/js/117.6385d8ba.js"><link rel="prefetch" href="/assets/js/118.d8ca9c91.js"><link rel="prefetch" href="/assets/js/119.0dd63abc.js"><link rel="prefetch" href="/assets/js/12.c1e29ffc.js"><link rel="prefetch" href="/assets/js/120.770c853b.js"><link rel="prefetch" href="/assets/js/121.4ee7d2ed.js"><link rel="prefetch" href="/assets/js/122.5dea240d.js"><link rel="prefetch" href="/assets/js/123.0e2f5e7d.js"><link rel="prefetch" href="/assets/js/124.1726ede6.js"><link rel="prefetch" href="/assets/js/125.a9d42ac2.js"><link rel="prefetch" href="/assets/js/126.e383af42.js"><link rel="prefetch" href="/assets/js/127.3a13c9c8.js"><link rel="prefetch" href="/assets/js/128.87c69f71.js"><link rel="prefetch" href="/assets/js/129.4da7e4e4.js"><link rel="prefetch" href="/assets/js/13.5d21e67d.js"><link rel="prefetch" href="/assets/js/130.d1dfabec.js"><link rel="prefetch" href="/assets/js/131.e2be543d.js"><link rel="prefetch" href="/assets/js/132.72fa03e6.js"><link rel="prefetch" href="/assets/js/133.2d5e7f8f.js"><link rel="prefetch" href="/assets/js/134.33030c18.js"><link rel="prefetch" href="/assets/js/135.ddeda731.js"><link rel="prefetch" href="/assets/js/136.fc4e1a09.js"><link rel="prefetch" href="/assets/js/137.f2728cd6.js"><link rel="prefetch" href="/assets/js/138.ffe849be.js"><link rel="prefetch" href="/assets/js/139.c0c100b6.js"><link rel="prefetch" href="/assets/js/14.c215f6f8.js"><link rel="prefetch" href="/assets/js/15.dee323a8.js"><link rel="prefetch" href="/assets/js/16.b7d70a1f.js"><link rel="prefetch" href="/assets/js/17.40c7db19.js"><link rel="prefetch" href="/assets/js/18.a07c5c42.js"><link rel="prefetch" href="/assets/js/19.7d97aae5.js"><link rel="prefetch" href="/assets/js/20.bb9ac41b.js"><link rel="prefetch" href="/assets/js/21.ff9f747e.js"><link rel="prefetch" href="/assets/js/22.f1163cc9.js"><link rel="prefetch" href="/assets/js/23.32a8ebd8.js"><link rel="prefetch" href="/assets/js/24.97027893.js"><link rel="prefetch" href="/assets/js/25.a85115e8.js"><link rel="prefetch" href="/assets/js/26.bfee2da6.js"><link rel="prefetch" href="/assets/js/27.58731068.js"><link rel="prefetch" href="/assets/js/28.6bf3dbc1.js"><link rel="prefetch" href="/assets/js/29.fbe07ff7.js"><link rel="prefetch" href="/assets/js/3.7628d796.js"><link rel="prefetch" href="/assets/js/30.b6eb596a.js"><link rel="prefetch" href="/assets/js/31.1512a289.js"><link rel="prefetch" href="/assets/js/32.4f9520a1.js"><link rel="prefetch" href="/assets/js/33.0b84d8d3.js"><link rel="prefetch" href="/assets/js/34.75f5d682.js"><link rel="prefetch" href="/assets/js/35.f9caa470.js"><link rel="prefetch" href="/assets/js/36.069daf14.js"><link rel="prefetch" href="/assets/js/37.b99d2219.js"><link rel="prefetch" href="/assets/js/38.30740471.js"><link rel="prefetch" href="/assets/js/39.70de7e93.js"><link rel="prefetch" href="/assets/js/4.f74244d9.js"><link rel="prefetch" href="/assets/js/40.6e555003.js"><link rel="prefetch" href="/assets/js/41.cf9fc5da.js"><link rel="prefetch" href="/assets/js/42.970e89bc.js"><link rel="prefetch" href="/assets/js/43.5b1f7175.js"><link rel="prefetch" href="/assets/js/44.cb2e9b25.js"><link rel="prefetch" href="/assets/js/45.2ac8fc57.js"><link rel="prefetch" href="/assets/js/46.6ec72eb1.js"><link rel="prefetch" href="/assets/js/47.a39ee366.js"><link rel="prefetch" href="/assets/js/48.d8565f41.js"><link rel="prefetch" href="/assets/js/49.ede671f0.js"><link rel="prefetch" href="/assets/js/5.6e2fbb08.js"><link rel="prefetch" href="/assets/js/50.6decf9d9.js"><link rel="prefetch" href="/assets/js/51.e18b1ffd.js"><link rel="prefetch" href="/assets/js/52.e566b2eb.js"><link rel="prefetch" href="/assets/js/53.6323e5f2.js"><link rel="prefetch" href="/assets/js/54.97308c00.js"><link rel="prefetch" href="/assets/js/55.755ba9af.js"><link rel="prefetch" href="/assets/js/56.d6cf4e40.js"><link rel="prefetch" href="/assets/js/57.49015aad.js"><link rel="prefetch" href="/assets/js/58.55684b4a.js"><link rel="prefetch" href="/assets/js/59.2852baf9.js"><link rel="prefetch" href="/assets/js/6.2bc22cf6.js"><link rel="prefetch" href="/assets/js/60.edbdc6ad.js"><link rel="prefetch" href="/assets/js/61.86f6cace.js"><link rel="prefetch" href="/assets/js/62.7a1a6037.js"><link rel="prefetch" href="/assets/js/63.5b27f5cd.js"><link rel="prefetch" href="/assets/js/64.2f50a919.js"><link rel="prefetch" href="/assets/js/66.ce198961.js"><link rel="prefetch" href="/assets/js/67.52ba35a6.js"><link rel="prefetch" href="/assets/js/68.9cbc4ffe.js"><link rel="prefetch" href="/assets/js/69.414b5a9b.js"><link rel="prefetch" href="/assets/js/7.281fb036.js"><link rel="prefetch" href="/assets/js/70.bea0c1fd.js"><link rel="prefetch" href="/assets/js/71.f38b58d8.js"><link rel="prefetch" href="/assets/js/72.b4644027.js"><link rel="prefetch" href="/assets/js/73.af1db17c.js"><link rel="prefetch" href="/assets/js/74.c07904c1.js"><link rel="prefetch" href="/assets/js/75.516954e5.js"><link rel="prefetch" href="/assets/js/76.0454da69.js"><link rel="prefetch" href="/assets/js/77.deb2953e.js"><link rel="prefetch" href="/assets/js/78.1b898587.js"><link rel="prefetch" href="/assets/js/79.3aed68f6.js"><link rel="prefetch" href="/assets/js/8.1cb5f795.js"><link rel="prefetch" href="/assets/js/80.3d5c8059.js"><link rel="prefetch" href="/assets/js/81.b3f64d30.js"><link rel="prefetch" href="/assets/js/82.fab58b77.js"><link rel="prefetch" href="/assets/js/83.e4b3443d.js"><link rel="prefetch" href="/assets/js/84.8d8322e9.js"><link rel="prefetch" href="/assets/js/85.3b852535.js"><link rel="prefetch" href="/assets/js/86.57cad3ef.js"><link rel="prefetch" href="/assets/js/87.03571119.js"><link rel="prefetch" href="/assets/js/88.77f832cc.js"><link rel="prefetch" href="/assets/js/89.ceb4025d.js"><link rel="prefetch" href="/assets/js/9.d304f163.js"><link rel="prefetch" href="/assets/js/90.c3e3c850.js"><link rel="prefetch" href="/assets/js/91.66fb1205.js"><link rel="prefetch" href="/assets/js/92.0d13651f.js"><link rel="prefetch" href="/assets/js/93.35d9c73f.js"><link rel="prefetch" href="/assets/js/94.6e044144.js"><link rel="prefetch" href="/assets/js/95.70422ee7.js"><link rel="prefetch" href="/assets/js/96.deeb8f43.js"><link rel="prefetch" href="/assets/js/97.96cf56cc.js"><link rel="prefetch" href="/assets/js/98.ca56fc88.js"><link rel="prefetch" href="/assets/js/99.0f851023.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f8d1251.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/programming/" aria-current="page" class="sidebar-link">/programming/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span class="img-container"><img src="/sidebar-imgs/dotnet.webp"></span> <span>.NET</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/programming/dotnet/http-client.html" class="sidebar-link">HTTPClient</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>Async</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/programming/dotnet/equality.html" class="sidebar-link">Equality</a></li><li><a href="/programming/dotnet/comparisons.html" class="sidebar-link">Comparisons</a></li><li><a href="/programming/dotnet/generic-host.html" class="sidebar-link">Generic Host</a></li><li><a href="/programming/dotnet/logging.html" class="sidebar-link">Logging</a></li><li><a href="/programming/dotnet/configuration.html" class="sidebar-link">Configuration</a></li><li><a href="/programming/dotnet/records.html" class="sidebar-link">Records</a></li><li><a href="/programming/dotnet/grpc.html" aria-current="page" class="active sidebar-link">gRPC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/programming/dotnet/grpc.html#proto-files" class="sidebar-link">Proto Files</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/grpc.html#net" class="sidebar-link">.NET</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/grpc.html#authorization" class="sidebar-link">Authorization</a></li><li class="sidebar-sub-header"><a href="/programming/dotnet/grpc.html#references" class="sidebar-link">References</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>ASP.NET Core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>Entity Framework Core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><!----> <span>Functional Programming</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/javascript.webp"></span> <span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/rust.webp"></span> <span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/c.webp"></span> <span>C/C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/css.webp"></span> <span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/unity.webp"></span> <span>Unity</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/algorithms.webp"></span> <span>Algorithms</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="grpc-in-net"><a href="#grpc-in-net" class="header-anchor">#</a> gRPC in .NET</h1> <p>Go <a href="/technologies/networking/grpc.html">here</a> for a general overview of gRPC.</p> <p>We can create a new gRPC server project with <code>dotnet new grpc</code>.</p> <h2 id="proto-files"><a href="#proto-files" class="header-anchor">#</a> Proto Files</h2> <p>The <code>.proto</code> files are needed by both the server and the client(s). They define
the contract. These files contain:</p> <ul><li>some metadata (like version of protobuf)</li> <li>listing of endpoints under <code>service</code></li> <li>shape of the data (<code>message</code>)</li></ul> <div class="language-protobuf extra-class"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">option</span> csharp_namespace <span class="token operator">=</span> <span class="token string">&quot;MyNamespace.gRPC&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;google/protobuf/Timestamp&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">service</span> <span class="token class-name">MeterReadingService</span> <span class="token punctuation">{</span>
    <span class="token keyword">rpc</span> <span class="token function">AddReading</span> <span class="token punctuation">(</span><span class="token class-name">ReadingPacket</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token class-name">StatusMessage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">ReadingPacket</span> <span class="token punctuation">{</span>
    <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">ReadingMessage</span> Readings <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">ReadingStatus</span> Successful <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">ReadingMessage</span> <span class="token punctuation">{</span>
    <span class="token builtin">int32</span> CustomerId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">int32</span> ReadingValue <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> Notes <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Timestamp</span> ReadingTime <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">reserved</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">reserved</span> <span class="token string">'Successful'</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">StatusMessage</span> <span class="token punctuation">{</span>
    <span class="token positional-class-name class-name">ReadingStatus</span> Success <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> Message <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">enum</span> <span class="token class-name">ReadingStatus</span> <span class="token punctuation">{</span>
    Unknown <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    Success <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    Failure <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Empty Response</p> <p>There's a type that represents empty content - <code>google.protobuf.Empty</code>. We could
use that if our rpc(s) did not return any data.</p></div> <h3 id="service"><a href="#service" class="header-anchor">#</a> Service</h3> <p>Under <code>service</code>, the endpoints are listed that the server will be offering, and
the client will be able to hit. The endpoints can make use of <code>message</code> types.</p> <h3 id="message"><a href="#message" class="header-anchor">#</a> Message</h3> <p>The <code>message</code> is used to define our structs. The numbers are used for ordering
of the fields.</p> <p>The types that we can use are either built-in ones, defined by us, or defined by
3rd party. Above, we're using <code>google.protobuf.Timestamp</code> that comes from an
import.</p> <p>If some component of a message is a collection we should add the <code>repeated</code>
keyword.</p> <h3 id="enum"><a href="#enum" class="header-anchor">#</a> Enum</h3> <p>The <code>enum</code> component works like enumerations in programming languages. The
numbers are no longer about ordering. They are the actual values that will be
used to represent the enums (like in C#).</p> <h2 id="net"><a href="#net" class="header-anchor">#</a> .NET</h2> <h3 id="auto-generated-files"><a href="#auto-generated-files" class="header-anchor">#</a> Auto-generated Files</h3> <h4 id="visual-studio"><a href="#visual-studio" class="header-anchor">#</a> Visual Studio</h4> <p>In Visual Studio, we can add gRPC Connected Service. There, we point at out
<code>.proto</code> file and VS generates various files for us and pulls the needed NuGet
packages. We have an option to generate Client or Server stuff.</p> <h4 id="dotnet-grpc"><a href="#dotnet-grpc" class="header-anchor">#</a> dotnet-grpc</h4> <p>There's also a tool that does pretty much the same things as Visual Studio does.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>dotnet tool <span class="token function">install</span> dotnet-grpc -g
</code></pre></div><p>Then, we can add <code>.proto</code> files to our project with <code>dotnet grpc add-file</code>. It
will also install necessary NuGet dependencies, and generate classes. More info
is on <a href="https://docs.microsoft.com/en-us/aspnet/core/grpc/dotnet-grpc" target="_blank" rel="noopener noreferrer">MSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h4 id="server"><a href="#server" class="header-anchor">#</a> Server</h4> <p>If we selected the <strong>Server</strong> option, one of the generated file types is the
classes for the <code>services</code> that we defined in our protobuf file. The files are
called the same as the service was called in the <code>.proto</code> file with the <code>Base</code>
suffix. These are base classes that we can inherit from when building our actual
classes that are going to handle gRPC communication. The base classes contain
methods for the rpc procedures that we've defined in the <code>.proto</code> file.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MeterReadingService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MeterReadingServiceBase</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>StatusMessage<span class="token punctuation">&gt;</span></span> <span class="token function">AddReading</span><span class="token punctuation">(</span>
        <span class="token class-name">ReadingPacket</span> request<span class="token punctuation">,</span> <span class="token class-name">ServelCallContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Do something...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Another generated type of files are the classes for the <code>messages</code> we've defined
in protobuf.</p> <h4 id="client"><a href="#client" class="header-anchor">#</a> Client</h4> <p>For the <strong>Client</strong> choice, what gets generated is a class representing gRPC
client for the gRPC service from the protobuf file. The name is based on the
<code>service</code> name from the protobuf file with the <code>Client</code> suffix.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> channel <span class="token operator">=</span> GrpcChannel<span class="token punctuation">.</span><span class="token function">ForAddress</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// the client requires a channel</span>
<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MeterReaderServiceClient</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">AddReading</span><span class="token punctuation">(</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="startup"><a href="#startup" class="header-anchor">#</a> Startup</h3> <p>When our gRPC service is ready, we need to register it in ASP.Net Core.</p> <p>We shoulda add the gRPC services:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddGrpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Useful for debugging:</span>
<span class="token comment">// builder.Services.AddGrpc(options =&gt; options.EnableDetailedErrors = true);</span>
</code></pre></div><p>We also need to map our own service as an endpoint:</p> <div class="language-cs extra-class"><pre class="language-cs"><code>app<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">MapGrpcService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MeterReadingService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With that setup, gRPC requests will be handled by our class.</p> <h3 id="streaming"><a href="#streaming" class="header-anchor">#</a> Streaming</h3> <p>If our protobuf supports streaming, we can implement it in .NET as well.
We can have uni- or bi-directional streaming.</p> <p>Here's an example of protobuf with streaming:</p> <div class="language-protobuf extra-class"><pre class="language-protobuf"><code><span class="token keyword">service</span> <span class="token class-name">MeterReadingService</span> <span class="token punctuation">{</span>
    <span class="token keyword">rpc</span> <span class="token function">AddReadingStreaming</span> <span class="token punctuation">(</span><span class="token keyword">stream</span> <span class="token class-name">ReadingPacket</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token keyword">stream</span> <span class="token class-name">ErrorMessage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The rpc above represents a bi-directional stream. If we wanted to have
uni-drectional stream:</p> <ul><li>from the client - just the input should have a <code>stream</code></li> <li>from the server - just the output should have a <code>stream</code></li></ul> <h4 id="server-class"><a href="#server-class" class="header-anchor">#</a> Server class</h4> <p>The auto-generated base class will have a method that we'll need to override:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">AddReadingStream</span><span class="token punctuation">(</span>
    <span class="token class-name">IAsyncStreamReader<span class="token punctuation">&lt;</span>ReadingMessage<span class="token punctuation">&gt;</span></span> requestStream<span class="token punctuation">,</span>
    <span class="token class-name">IServerStreamWriter<span class="token punctuation">&lt;</span>ErrorMessage<span class="token punctuation">&gt;</span></span> responseStream<span class="token punctuation">,</span>
    <span class="token class-name">ServerCallContext</span> context<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">await</span> requestStream<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// INPUT STREAM</span>
        <span class="token class-name"><span class="token keyword">var</span></span> msg <span class="token operator">=</span> requestStream<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>

        <span class="token comment">// Do something...</span>
        <span class="token comment">// For example:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>ReadingValue <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// OUTPUT STREAM</span>
            <span class="token keyword">await</span> responseStream<span class="token punctuation">.</span><span class="token function">WriteAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ErrorMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Value less than 100&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The client-side code is very similar.</p> <h2 id="authorization"><a href="#authorization" class="header-anchor">#</a> Authorization</h2> <p>The &quot;standard&quot; auth flow of ASP.NET Core works in gRPC as well. The service
classes on the server side may be decorated with the <code>[Authorize]</code> annotation,
similarly to the HTTP Controllers (what about individual rpc methods?).</p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <p><a href="https://app.pluralsight.com/library/courses/aspdotnet-core-6-using-grpc/" target="_blank" rel="noopener noreferrer">Pluralsight<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/programming/dotnet/records.html" class="prev">
        Records
      </a></span> <span class="next"><a href="/programming/dotnet/asp-net-core/overview.html">
        Overview
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/30/2022, 8:16:30 AM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7d9d734a.js" defer></script><script src="/assets/js/2.58419cab.js" defer></script><script src="/assets/js/65.c52f6ba4.js" defer></script>
  </body>
</html>
