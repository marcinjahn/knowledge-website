<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lifetimes | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Lifetimes in Rust">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.92f25611.css" as="style"><link rel="preload" href="/assets/js/app.5d8103b3.js" as="script"><link rel="preload" href="/assets/js/2.3c69ec5e.js" as="script"><link rel="preload" href="/assets/js/84.ff013a66.js" as="script"><link rel="prefetch" href="/assets/js/10.a800d266.js"><link rel="prefetch" href="/assets/js/11.09e56f29.js"><link rel="prefetch" href="/assets/js/12.2d1e6a40.js"><link rel="prefetch" href="/assets/js/13.ab102e18.js"><link rel="prefetch" href="/assets/js/14.f5ac7c36.js"><link rel="prefetch" href="/assets/js/15.22a57c26.js"><link rel="prefetch" href="/assets/js/16.83770f8c.js"><link rel="prefetch" href="/assets/js/17.8c7b2def.js"><link rel="prefetch" href="/assets/js/18.a594cab7.js"><link rel="prefetch" href="/assets/js/19.a3397615.js"><link rel="prefetch" href="/assets/js/20.8b3d897c.js"><link rel="prefetch" href="/assets/js/21.cbc61ced.js"><link rel="prefetch" href="/assets/js/22.c51ff6ae.js"><link rel="prefetch" href="/assets/js/23.30bc59b3.js"><link rel="prefetch" href="/assets/js/24.3a95d909.js"><link rel="prefetch" href="/assets/js/25.fd76940b.js"><link rel="prefetch" href="/assets/js/26.b1828195.js"><link rel="prefetch" href="/assets/js/27.148ff54b.js"><link rel="prefetch" href="/assets/js/28.1a1c80e0.js"><link rel="prefetch" href="/assets/js/29.d26d1e2e.js"><link rel="prefetch" href="/assets/js/3.bb1a1646.js"><link rel="prefetch" href="/assets/js/30.d48f41e9.js"><link rel="prefetch" href="/assets/js/31.1d5a0de1.js"><link rel="prefetch" href="/assets/js/32.9d0a8149.js"><link rel="prefetch" href="/assets/js/33.67d3e8be.js"><link rel="prefetch" href="/assets/js/34.4909e2ff.js"><link rel="prefetch" href="/assets/js/35.4e4eecc4.js"><link rel="prefetch" href="/assets/js/36.cc5a0bd9.js"><link rel="prefetch" href="/assets/js/37.2934c3f8.js"><link rel="prefetch" href="/assets/js/38.d6658ddc.js"><link rel="prefetch" href="/assets/js/39.36673a67.js"><link rel="prefetch" href="/assets/js/4.9f145679.js"><link rel="prefetch" href="/assets/js/40.bf8cc533.js"><link rel="prefetch" href="/assets/js/41.d17d0b20.js"><link rel="prefetch" href="/assets/js/42.c4f4fd5d.js"><link rel="prefetch" href="/assets/js/43.b954ff81.js"><link rel="prefetch" href="/assets/js/44.44c26a21.js"><link rel="prefetch" href="/assets/js/45.810f6ee0.js"><link rel="prefetch" href="/assets/js/46.baae0e2e.js"><link rel="prefetch" href="/assets/js/47.46577a1a.js"><link rel="prefetch" href="/assets/js/48.599ebff8.js"><link rel="prefetch" href="/assets/js/49.9eed5c3c.js"><link rel="prefetch" href="/assets/js/5.ee6907a4.js"><link rel="prefetch" href="/assets/js/50.15947edd.js"><link rel="prefetch" href="/assets/js/51.40470b07.js"><link rel="prefetch" href="/assets/js/52.13e1d243.js"><link rel="prefetch" href="/assets/js/53.df4b8202.js"><link rel="prefetch" href="/assets/js/54.f6be0309.js"><link rel="prefetch" href="/assets/js/55.00404bbb.js"><link rel="prefetch" href="/assets/js/56.f72b6ccd.js"><link rel="prefetch" href="/assets/js/57.5f14177d.js"><link rel="prefetch" href="/assets/js/58.9e981a5e.js"><link rel="prefetch" href="/assets/js/59.47be87a2.js"><link rel="prefetch" href="/assets/js/6.f4f76c65.js"><link rel="prefetch" href="/assets/js/60.cf86d3b9.js"><link rel="prefetch" href="/assets/js/61.1034ecbf.js"><link rel="prefetch" href="/assets/js/62.ba279114.js"><link rel="prefetch" href="/assets/js/63.aa0a3037.js"><link rel="prefetch" href="/assets/js/64.ba8a8573.js"><link rel="prefetch" href="/assets/js/65.a72e4bf8.js"><link rel="prefetch" href="/assets/js/66.99389e41.js"><link rel="prefetch" href="/assets/js/67.948f6872.js"><link rel="prefetch" href="/assets/js/68.bca1286f.js"><link rel="prefetch" href="/assets/js/69.cf6d76f0.js"><link rel="prefetch" href="/assets/js/7.ef576734.js"><link rel="prefetch" href="/assets/js/70.29e9529f.js"><link rel="prefetch" href="/assets/js/71.86b1f063.js"><link rel="prefetch" href="/assets/js/72.2bdcef5e.js"><link rel="prefetch" href="/assets/js/73.a4ab365c.js"><link rel="prefetch" href="/assets/js/74.e820b193.js"><link rel="prefetch" href="/assets/js/75.ba899c86.js"><link rel="prefetch" href="/assets/js/76.9b2622a7.js"><link rel="prefetch" href="/assets/js/77.28d362db.js"><link rel="prefetch" href="/assets/js/78.92358054.js"><link rel="prefetch" href="/assets/js/79.764f1947.js"><link rel="prefetch" href="/assets/js/8.4599b857.js"><link rel="prefetch" href="/assets/js/80.17bd0000.js"><link rel="prefetch" href="/assets/js/81.61c95baa.js"><link rel="prefetch" href="/assets/js/82.47542276.js"><link rel="prefetch" href="/assets/js/83.d50da8a1.js"><link rel="prefetch" href="/assets/js/85.ba31a46e.js"><link rel="prefetch" href="/assets/js/86.25ae161a.js"><link rel="prefetch" href="/assets/js/87.6071f1fc.js"><link rel="prefetch" href="/assets/js/88.c17bb1b0.js"><link rel="prefetch" href="/assets/js/89.e26cc04c.js"><link rel="prefetch" href="/assets/js/9.b1432945.js"><link rel="prefetch" href="/assets/js/90.89a45223.js"><link rel="prefetch" href="/assets/js/91.7c956f7e.js"><link rel="prefetch" href="/assets/js/92.d6a680ee.js"><link rel="prefetch" href="/assets/js/93.3a54e06d.js"><link rel="prefetch" href="/assets/js/94.bdb42033.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92f25611.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link router-link-active">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link">
  Dev Tools
</a></div><div class="nav-item"><a href="/computers/" class="nav-link">
  Computers
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-6c2342f8><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b" data-v-f9b87572 data-v-6c2342f8><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-6c2342f8><img src="/img/github.webp" data-v-f9b87572></a></span> <a href="https://github.com/marcinjahn/knowledge-website" target="_blank" rel="noopener noreferrer" class="repo-link">
    Code on GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/programming/" aria-current="page" class="sidebar-link">/programming/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>.NET</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Rust</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/programming/rust/overview.html" class="sidebar-link">Overview</a></li><li><a href="/programming/rust/cargo.html" class="sidebar-link">Cargo</a></li><li><a href="/programming/rust/basics.html" class="sidebar-link">Basics</a></li><li><a href="/programming/rust/ownership.html" class="sidebar-link">Ownership</a></li><li><a href="/programming/rust/structs.html" class="sidebar-link">Structures</a></li><li><a href="/programming/rust/enums.html" class="sidebar-link">Enums</a></li><li><a href="/programming/rust/organization.html" class="sidebar-link">Organization</a></li><li><a href="/programming/rust/collections.html" class="sidebar-link">Collections</a></li><li><a href="/programming/rust/error-handling.html" class="sidebar-link">Error Handling</a></li><li><a href="/programming/rust/generics.html" class="sidebar-link">Generics</a></li><li><a href="/programming/rust/traits.html" class="sidebar-link">Traits</a></li><li><a href="/programming/rust/lifetimes.html" aria-current="page" class="active sidebar-link">Lifetimes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/programming/rust/lifetimes.html#lifetime-elision" class="sidebar-link">Lifetime Elision</a></li><li class="sidebar-sub-header"><a href="/programming/rust/lifetimes.html#lifetime-annotations" class="sidebar-link">Lifetime Annotations</a></li><li class="sidebar-sub-header"><a href="/programming/rust/lifetimes.html#static-lifetime" class="sidebar-link">Static Lifetime</a></li></ul></li><li><a href="/programming/rust/closures.html" class="sidebar-link">Closures</a></li><li><a href="/programming/rust/pointers.html" class="sidebar-link">Raw Pointers</a></li><li><a href="/programming/rust/smart-pointers.html" class="sidebar-link">Smart Pointers</a></li><li><a href="/programming/rust/concurrency.html" class="sidebar-link">Concurrency</a></li><li><a href="/programming/rust/testing.html" class="sidebar-link">Testing</a></li><li><a href="/programming/rust/tips.html" class="sidebar-link">Tips</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="lifetimes"><a href="#lifetimes" class="header-anchor">#</a> Lifetimes</h1> <p>References have their lifetimes, which define a scope for when a reference is
valid. Lifetimes can be implicitly infered but sometimes we need to specify them
explicitly. The main aim of lifetimes is to <strong>prevent dangling references</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Validity of lifetimes is checked during compilation by the <strong>borrow checker</strong>.</p></div> <p>Example:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">{</span>
  <span class="token keyword">let</span> r<span class="token punctuation">;</span>                <span class="token comment">// ---------+-- 'a</span>
                        <span class="token comment">//          |</span>
  <span class="token punctuation">{</span>                     <span class="token comment">//          |</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>          <span class="token comment">// -+-- 'b  |</span>
    r <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>             <span class="token comment">//  |       |</span>
  <span class="token punctuation">}</span>                     <span class="token comment">// -+       |</span>
                        <span class="token comment">//          |</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;r: {}&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//          |</span>
<span class="token punctuation">}</span>                       <span class="token comment">// ---------+</span>
</code></pre></div><p>The program will not compile, because we're trying to print reference <code>r</code>, which
points to <code>x</code> that already went out of scope (its lifetime <code>'b</code> is over).</p> <h2 id="lifetime-elision"><a href="#lifetime-elision" class="header-anchor">#</a> Lifetime Elision</h2> <p>Not all usages of references require explicit lifetime annotations. There are
some situations where the compiler is able to infer the proper lifetimes on its
own.</p> <p>There are three rules of how compiler infers lifetimes. They apply to functions
and methods:</p> <ol><li>Each parameter that is a reference gets its own lifetime parameter.</li> <li>If there is exactly one input parameter, its lifetime is assigned to all
output parameters (that's one functions with one parameter don't need
lifetime specifications).</li> <li>If there are multiple input parameters, but one of them is <code>&amp;self</code> or <code>mut &amp;self</code> (so, it's a method), the lifetime of <code>self</code> is alligned to all output
parameters.</li></ol> <p>If after applying these rules there are still some references left without
lifetime information, compilation will fail and explicit lifetime information
will be required.</p> <h2 id="lifetime-annotations"><a href="#lifetime-annotations" class="header-anchor">#</a> Lifetime Annotations</h2> <p>Lifetime annotations describe the relationships of the lifetimes of multiple
references to each other without affecting the lifetimes.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token operator">&amp;</span><span class="token keyword">i32</span>        <span class="token comment">// a reference</span>
<span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span>     <span class="token comment">// a reference with an explicit lifetime</span>
<span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">mut</span> <span class="token keyword">i32</span> <span class="token comment">// a mutable reference with an explicit lifetime</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>'a</code> is a common naming convention for lifetimes. It could be some word too.</p></div> <h3 id="functions"><a href="#functions" class="header-anchor">#</a> Functions</h3> <p>Lifetime annotations in functions have meaning only when multiple types have
annotations. Then the compiler can understand if some bindings have the same or
different lifetimes.</p> <p>Here's a function that will not compile due to lack of lifetime annotations:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">longest</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> x<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> y<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The compiler needs to know how the returned reference is related to the parameters
of the function.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When returning a reference from a function, it has to be one of the references
passed as arguments of the function. Otherwise, the reference would have to be
created from some local function's variable. The returned value would be a
dangling pointer!</p> <p>What if I want to return a reference to some global/static value? Isn't it allowed?</p></div> <p>Here's a valid version:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">longest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> x<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> y<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Generics</p> <p>Lifetimes are defined similarly to generic types.</p></div> <p>Potentially, the compiler could infer the lifetime knowledge from the code
itself - since I'm returning either <code>x</code> or <code>y</code>, probably the lifetime of the
result should be the smallest common lifetime of these. However, that would bind
the lifetime of the result with that particular implementation! If I, as an
author of that function, change this implementation one day to always return
<code>x</code>, the lifetime infered by the compiler will change! It could than break some
code of clients of this function. That's why Rust requires us to specify the
lifetime information explicitly.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When returning a reference from a function, the lifetime parameter for the
return type needs to match the lifetime parameter for one of the parameters.</p></div> <p>Since the function can return either <code>x</code> or <code>y</code> reference, the lifetime of both
the parameters and the return value will be the same - <code>'a</code>. The function
signature now tells Rust that for some lifetime <code>'a</code>, the function takes two
parameters, both of which are string slices that live at least as long as
lifetime <code>'a</code>. Additionally, the string slice returned from the function will
live at least as long as lifetime <code>'a</code>.</p> <p>When we pass concrete references to <code>longest</code>, the concrete lifetime that is
substituted for <code>'a</code> is the part of the scope of <code>x</code> that overlaps with the
scope of <code>y</code>. In other words, the generic lifetime <code>'a</code> will get the concrete
lifetime that is <strong>equal to the smaller of the lifetimes of <code>x</code> and <code>y</code></strong>.
Because we’ve annotated the returned reference with the same lifetime parameter
<code>'a</code>, the returned reference will also be valid for the length of the smaller of
the lifetimes of <code>x</code> and <code>y</code>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When we specify the lifetime parameters in the function signature, <strong>we’re not
changing the lifetimes</strong> of any values passed in or returned. Rather, we’re
specifying that the borrow checker should reject any values that don’t adhere to
these constraints.</p></div> <h4 id="using-a-function-with-lifetimes-defined"><a href="#using-a-function-with-lifetimes-defined" class="header-anchor">#</a> Using a function with lifetimes defined</h4> <p>Here're examples of how lifetimes help in enforcing proper usage of references
in terms of scope:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> string1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;long string is long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> string2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">longest</span><span class="token punctuation">(</span>string1<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> string2<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;The longest string is {}&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// GOOD</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the code above, <code>string2</code> has shorter lifetime than <code>string1</code>. It means that
the lifetime of <code>result</code> will end at the same time as <code>string2</code>'s. Since we're
using <code>result</code> when the lifetime is still valid, the code compiles and runs.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> string1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;long string is long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> string2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;xyz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token function">longest</span><span class="token punctuation">(</span>string1<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> string2<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;The longest string is {}&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the code above, the situation is similar, however, we're trying to use (print)
<code>result</code> outside of the inner scope, when the lifetime of <code>string2</code> is already
over. Since the lifetime of <code>result</code> is the same as that of <code>string2</code>, <code>result</code>
cannot be used at this point. The code fails to compile.</p> <h3 id="structs"><a href="#structs" class="header-anchor">#</a> Structs</h3> <p>If a struct contains references as fields, they all need to have lifetime
annotations.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">ImportantExcerpt</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> langs <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;rust,js,c#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> first_lang <span class="token operator">=</span> novel<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Could not find a ','&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token class-name">ImportantExcerpt</span> <span class="token punctuation">{</span>
    part<span class="token punctuation">:</span> first_lang<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This annotation means an instance of <code>ImportantExcerpt</code> can’t outlive the
reference it holds in its <code>part</code> field.</p> <h4 id="struct-methods"><a href="#struct-methods" class="header-anchor">#</a> Struct Methods</h4> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token class-name">ImportantExcerpt</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">announce_and_return_part</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Attention please: {}&quot;</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>part
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Thanks to the <a href="#lifetime-elision">elision rules</a> we don't have to annotate the
method explicitly. The lifetime of the output <code>&amp;str</code> is the same as the lifetime
of the object (<code>&amp;self</code>).</p> <h2 id="static-lifetime"><a href="#static-lifetime" class="header-anchor">#</a> Static Lifetime</h2> <p>There is a special lifetime - <code>'static</code> - which marks a value pointed by a
reference to be &quot;alive&quot; during the entire execution of the program.</p> <div class="custom-block tip"><p class="custom-block-title">String Literals</p> <p>All string literals have <code>'static</code> lifetime. We can annotate them explicitly:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;Explicit static lifetime&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token string">&quot;Implicit static lifetime&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>The texts are stored directly in program's binary.</p></div></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/programming/rust/traits.html" class="prev">
        Traits
      </a></span> <span class="next"><a href="/programming/rust/closures.html">
        Closures
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/marcinjahn/knowledge-website/edit/main/src/docs/programming/rust/lifetimes.md" target="_blank" rel="noopener noreferrer">Feel free to contribute to this article!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/27/2022, 8:32:52 AM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5d8103b3.js" defer></script><script src="/assets/js/2.3c69ec5e.js" defer></script><script src="/assets/js/84.ff013a66.js" defer></script>
  </body>
</html>
