<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP Procol | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="My personal knowledge base for all the IT-related topics">
    <meta property="og:url" content="/technologies/networking/tcp.html">
    <meta property="og:site_name" content="Marcin Jahn | Technology Notebook">
    <meta property="og:title" content="TCP Procol">
    <meta property="og:description" content="Transport Control Protocol (TCP) Allows 2 endpoints to exchange data reliably ovet the network. It is a Transport (4th) layer of OSI. Pros acknowledgment - parties have to confirm ">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Technology Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.78248196.css" as="style"><link rel="preload" href="/assets/js/app.bf5f5821.js" as="script"><link rel="preload" href="/assets/js/2.859bd0f8.js" as="script"><link rel="preload" href="/assets/js/119.3091ce55.js" as="script"><link rel="prefetch" href="/assets/js/10.2b5797e0.js"><link rel="prefetch" href="/assets/js/100.697d0e4a.js"><link rel="prefetch" href="/assets/js/101.2b5417f8.js"><link rel="prefetch" href="/assets/js/102.bc633d0e.js"><link rel="prefetch" href="/assets/js/103.7837014d.js"><link rel="prefetch" href="/assets/js/104.153f92e7.js"><link rel="prefetch" href="/assets/js/105.41a4f809.js"><link rel="prefetch" href="/assets/js/106.9884fb4c.js"><link rel="prefetch" href="/assets/js/107.701a1eff.js"><link rel="prefetch" href="/assets/js/108.a0d3d4b9.js"><link rel="prefetch" href="/assets/js/109.5eac4fe8.js"><link rel="prefetch" href="/assets/js/11.db4361ce.js"><link rel="prefetch" href="/assets/js/110.186349a9.js"><link rel="prefetch" href="/assets/js/111.d0277325.js"><link rel="prefetch" href="/assets/js/112.a1076941.js"><link rel="prefetch" href="/assets/js/113.2a33e8d8.js"><link rel="prefetch" href="/assets/js/114.2613d8d5.js"><link rel="prefetch" href="/assets/js/115.1b4e7558.js"><link rel="prefetch" href="/assets/js/116.e1eda73b.js"><link rel="prefetch" href="/assets/js/117.66650b37.js"><link rel="prefetch" href="/assets/js/118.a2edfe8f.js"><link rel="prefetch" href="/assets/js/12.f0db8451.js"><link rel="prefetch" href="/assets/js/120.3980308d.js"><link rel="prefetch" href="/assets/js/121.f33a34c9.js"><link rel="prefetch" href="/assets/js/122.f6f86cda.js"><link rel="prefetch" href="/assets/js/123.930b6f48.js"><link rel="prefetch" href="/assets/js/124.bafaab56.js"><link rel="prefetch" href="/assets/js/13.2d4d2efb.js"><link rel="prefetch" href="/assets/js/14.862d31bf.js"><link rel="prefetch" href="/assets/js/15.940aec2b.js"><link rel="prefetch" href="/assets/js/16.11fbffb9.js"><link rel="prefetch" href="/assets/js/17.2329054e.js"><link rel="prefetch" href="/assets/js/18.70bcada4.js"><link rel="prefetch" href="/assets/js/19.bcc3273d.js"><link rel="prefetch" href="/assets/js/20.d7bef4b0.js"><link rel="prefetch" href="/assets/js/21.645b7f8e.js"><link rel="prefetch" href="/assets/js/22.6cd835d3.js"><link rel="prefetch" href="/assets/js/23.0082a966.js"><link rel="prefetch" href="/assets/js/24.780e7797.js"><link rel="prefetch" href="/assets/js/25.70ffc5d2.js"><link rel="prefetch" href="/assets/js/26.d5b48f5b.js"><link rel="prefetch" href="/assets/js/27.a89bab68.js"><link rel="prefetch" href="/assets/js/28.9db5cfb4.js"><link rel="prefetch" href="/assets/js/29.8debde2d.js"><link rel="prefetch" href="/assets/js/3.f58aa2db.js"><link rel="prefetch" href="/assets/js/30.faf769c9.js"><link rel="prefetch" href="/assets/js/31.125000da.js"><link rel="prefetch" href="/assets/js/32.fa41c4aa.js"><link rel="prefetch" href="/assets/js/33.7487efab.js"><link rel="prefetch" href="/assets/js/34.4974810c.js"><link rel="prefetch" href="/assets/js/35.6ec22e4e.js"><link rel="prefetch" href="/assets/js/36.85149ed9.js"><link rel="prefetch" href="/assets/js/37.d97ebc15.js"><link rel="prefetch" href="/assets/js/38.8bea259f.js"><link rel="prefetch" href="/assets/js/39.5b2f295f.js"><link rel="prefetch" href="/assets/js/4.8628d78e.js"><link rel="prefetch" href="/assets/js/40.542639da.js"><link rel="prefetch" href="/assets/js/41.a0931265.js"><link rel="prefetch" href="/assets/js/42.eebee7f8.js"><link rel="prefetch" href="/assets/js/43.93e70475.js"><link rel="prefetch" href="/assets/js/44.36569d9e.js"><link rel="prefetch" href="/assets/js/45.d3b3e2eb.js"><link rel="prefetch" href="/assets/js/46.bb544619.js"><link rel="prefetch" href="/assets/js/47.2145f744.js"><link rel="prefetch" href="/assets/js/48.d5709f6d.js"><link rel="prefetch" href="/assets/js/49.7d88a1ab.js"><link rel="prefetch" href="/assets/js/5.469b5143.js"><link rel="prefetch" href="/assets/js/50.57a14f38.js"><link rel="prefetch" href="/assets/js/51.5a116b8b.js"><link rel="prefetch" href="/assets/js/52.a54a59bf.js"><link rel="prefetch" href="/assets/js/53.9075d9af.js"><link rel="prefetch" href="/assets/js/54.34f8aadb.js"><link rel="prefetch" href="/assets/js/55.345d8a8d.js"><link rel="prefetch" href="/assets/js/56.6ff5833e.js"><link rel="prefetch" href="/assets/js/57.f5618df9.js"><link rel="prefetch" href="/assets/js/58.55ed0371.js"><link rel="prefetch" href="/assets/js/59.e8689e7a.js"><link rel="prefetch" href="/assets/js/6.12637fb2.js"><link rel="prefetch" href="/assets/js/60.1158f326.js"><link rel="prefetch" href="/assets/js/61.44b53976.js"><link rel="prefetch" href="/assets/js/62.2c845e6d.js"><link rel="prefetch" href="/assets/js/63.86321556.js"><link rel="prefetch" href="/assets/js/64.82de4224.js"><link rel="prefetch" href="/assets/js/65.2807528e.js"><link rel="prefetch" href="/assets/js/66.8b65a316.js"><link rel="prefetch" href="/assets/js/67.af845a49.js"><link rel="prefetch" href="/assets/js/68.2b737861.js"><link rel="prefetch" href="/assets/js/69.f2e79d15.js"><link rel="prefetch" href="/assets/js/7.ed62b6c5.js"><link rel="prefetch" href="/assets/js/70.ad782527.js"><link rel="prefetch" href="/assets/js/71.9f04b273.js"><link rel="prefetch" href="/assets/js/72.265c217d.js"><link rel="prefetch" href="/assets/js/73.caa49c63.js"><link rel="prefetch" href="/assets/js/74.8f080b02.js"><link rel="prefetch" href="/assets/js/75.31b725a9.js"><link rel="prefetch" href="/assets/js/76.c7869928.js"><link rel="prefetch" href="/assets/js/77.beb33c83.js"><link rel="prefetch" href="/assets/js/78.7edc4cb2.js"><link rel="prefetch" href="/assets/js/79.dd452921.js"><link rel="prefetch" href="/assets/js/8.14da4f18.js"><link rel="prefetch" href="/assets/js/80.35515aa0.js"><link rel="prefetch" href="/assets/js/81.a5359a03.js"><link rel="prefetch" href="/assets/js/82.ebc0590e.js"><link rel="prefetch" href="/assets/js/83.6d74d9ac.js"><link rel="prefetch" href="/assets/js/84.c86f763d.js"><link rel="prefetch" href="/assets/js/85.134b2532.js"><link rel="prefetch" href="/assets/js/86.307bf8cb.js"><link rel="prefetch" href="/assets/js/87.4e1fcfa4.js"><link rel="prefetch" href="/assets/js/88.9f0e74b9.js"><link rel="prefetch" href="/assets/js/89.a9d853ad.js"><link rel="prefetch" href="/assets/js/9.b1a2cbe8.js"><link rel="prefetch" href="/assets/js/90.002dcf18.js"><link rel="prefetch" href="/assets/js/91.d63630b5.js"><link rel="prefetch" href="/assets/js/92.ad9f33f3.js"><link rel="prefetch" href="/assets/js/93.6c07b207.js"><link rel="prefetch" href="/assets/js/94.8bfbd035.js"><link rel="prefetch" href="/assets/js/95.4a61b8ba.js"><link rel="prefetch" href="/assets/js/96.929a853f.js"><link rel="prefetch" href="/assets/js/97.39c8e6cf.js"><link rel="prefetch" href="/assets/js/98.bcd0a192.js"><link rel="prefetch" href="/assets/js/99.0366d616.js">
    <link rel="stylesheet" href="/assets/css/0.styles.78248196.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link">
  Tools and Infrastructure
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/dev-tools/" class="nav-link">
  Tools and Infrastructure
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/technologies/" aria-current="page" class="sidebar-link">/technologies/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web Protocols</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/technologies/networking/osi-model.html" class="sidebar-link">OSI Model</a></li><li><a href="/technologies/networking/tcp.html" aria-current="page" class="active sidebar-link">TCP Procol</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#pros" class="sidebar-link">Pros</a></li><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#cons" class="sidebar-link">Cons</a></li><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#connection" class="sidebar-link">Connection</a></li><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#connection-states" class="sidebar-link">Connection States</a></li><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#tcp-handshake" class="sidebar-link">TCP Handshake</a></li><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#receive-window-size" class="sidebar-link">Receive Window Size</a></li><li class="sidebar-sub-header"><a href="/technologies/networking/tcp.html#retransmissions" class="sidebar-link">Retransmissions</a></li></ul></li><li><a href="/technologies/networking/udp.html" class="sidebar-link">UDP Protocol</a></li><li><a href="/technologies/networking/http.html" class="sidebar-link">HTTP Protocol</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blockchain</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="transport-control-protocol-tcp"><a href="#transport-control-protocol-tcp" class="header-anchor">#</a> Transport Control Protocol (TCP)</h1> <p>Allows 2 endpoints to exchange data reliably ovet the network. It is a Transport
(4th) layer of OSI.</p> <h2 id="pros"><a href="#pros" class="header-anchor">#</a> Pros</h2> <ul><li><strong>acknowledgment</strong> - parties have to confirm that the data got received.
Thanks to it, there is a guarantee of delivery</li> <li><strong>congestion control</strong> -</li> <li><strong>ordered packets</strong> - TCP will put all packets in order when they get received</li></ul> <h2 id="cons"><a href="#cons" class="header-anchor">#</a> Cons</h2> <ul><li><strong>larger packets</strong> - all of the control requires a lot of information to be
sent over the wire. Because of that, it takes more bandwidth and it is slower
than UDP</li> <li><strong>stateful</strong> - restarting a server in the middle of some information
transmission will require the transmission to be started again.</li> <li><strong>server memory</strong> - because of connection being stateful, the server's memory
get filled up with all the connections.</li></ul> <h2 id="connection"><a href="#connection" class="header-anchor">#</a> Connection</h2> <p>Connection between two computers is identified by:</p> <ul><li>source IP</li> <li>source port</li> <li>destination IP</li> <li>destination port</li></ul> <p>Both machines (clisent and server) stores information about the established
connection.</p> <h2 id="connection-states"><a href="#connection-states" class="header-anchor">#</a> Connection States</h2> <p>TCP has 11 possible connection states:</p> <ul><li><strong>Closed</strong> - there's no connection yet</li> <li><strong>Established</strong> - connection open with 3-way handshake. We can begin to use it</li> <li><strong>Time Wait</strong> - We shut down the connection and we need to wait until we can
use it again (?)</li> <li>...</li></ul> <h2 id="tcp-handshake"><a href="#tcp-handshake" class="header-anchor">#</a> TCP Handshake</h2> <ol><li><p><em>Client</em> sends <strong>SYN</strong> to the <em>Server</em>. the values being sent:</p> <ul><li><strong>Initial Sequence Number</strong></li> <li>Flags: SYN</li> <li>Window size - max buffer size that the client can receive at once</li> <li>TCP Options:
<ul><li>max segment size - MSS - (1460)</li> <li>windows scale - 2^number to multiply the &quot;window size&quot; to get the
actual size (0-14)</li> <li>timestamps</li> <li>SACK permitted (Selective ACKnowledgments)</li></ul></li></ul></li> <li><p><em>Server</em> sends <strong>SYN/ACK</strong> back to the <em>Client</em>. Values sent:</p> <ul><li>Flag: SYN and ACK (acknowledgement of Client's SYN)</li> <li>Windows Size - max buffer size that the Server can receive at once</li> <li>TCP Options:
<ul><li>max segment size - MSS - (1460)</li> <li>SACK permitted</li> <li>window scale - 2^number to multiply the &quot;window size&quot; to get the
actual size (0-14)</li></ul></li></ul> <p>Based on the comparison of TCP Options of Client and Server, the actual
options are chosen (support for timestamps, SACK, etc.) so that both parties
can handle the communication. Some values can vary, like max segment size.</p> <p>Sometimes the network might have further restrictions and, i.e. a router
might change the MSS to some lower value.</p></li> <li><p><em>Client</em> sends <strong>ACK</strong> to the <em>Server</em>.</p></li></ol> <h2 id="receive-window-size"><a href="#receive-window-size" class="header-anchor">#</a> Receive Window Size</h2> <p>Both the client and the server send their window sizes, which is an amount of
space in the buffer. Based on that the other side might decide how much data to
send in a packet. It's not uncommon to see client-side receive window size to be
bigger than the server's receive window size. That's because usually clients
receive most of the data.</p> <p>Every TCP connection has a separate receive window buffer. That's why the amount
of connections is limited.</p> <p>Client and server communciate their window sizes in every packet. This number
might descrease and increase as the buffer gets smaller or bigger.</p> <p>Maximum window size is around 1GB.</p> <h3 id="zero-window-size"><a href="#zero-window-size" class="header-anchor">#</a> Zero Window Size</h3> <p>If the receiver of data is not able to keep up with the amount of data it
receives, the buffer might be filled up completely. In such case, the receiver
would send &quot;0&quot; as its receive window size. The server would wait for the client
to report that there is some space. If client doesn't send anything like that,
the server can ask about it.</p> <p>Such situation can happen when the receiver runs out of resources and it cannot
efficiently handle the receive buffer.</p> <p>Ideally, the window size should be set so that the communication does not stop
due to lack of buffer space and the client should send ACKs before the server
stops transmitting bytes.</p> <h2 id="retransmissions"><a href="#retransmissions" class="header-anchor">#</a> Retransmissions</h2> <h3 id="time-based-standard-retransmission"><a href="#time-based-standard-retransmission" class="header-anchor">#</a> Time-based (Standard Retransmission)</h3> <p>WHen a server transmits a packet of data, it sets a timer. If there is no ACK
from the client by the time the timer runs out, the server will retransmit the
data.</p> <h3 id="fast-retransmission"><a href="#fast-retransmission" class="header-anchor">#</a> Fast Retransmission</h3> <p>It requires the SACK option. If the server sees 2-3 duplicate ACKa, it'll do a
retransmission. This is caused by the network delay, when packets travel slow.</p> <h3 id="spurious-retransmission"><a href="#spurious-retransmission" class="header-anchor">#</a> Spurious Retransmission</h3> <p>Server resends a packet that has already been received. It might happen due to
undelivered ACK, so that server thinks that the packed was not acknowledged.</p></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technologies/networking/osi-model.html" class="prev">
        OSI Model
      </a></span> <span class="next"><a href="/technologies/networking/udp.html">
        UDP Protocol
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/20/2022, 9:25:09 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.bf5f5821.js" defer></script><script src="/assets/js/2.859bd0f8.js" defer></script><script src="/assets/js/119.3091ce55.js" defer></script>
  </body>
</html>
