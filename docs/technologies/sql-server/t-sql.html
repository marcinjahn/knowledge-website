<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>T-SQL | Marcin Jahn | Technology Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="T-SQL query language of SQL Server">
    <meta property="og:url" content="/technologies/sql-server/t-sql.html">
    <meta property="og:site_name" content="Marcin Jahn | Technology Notebook">
    <meta property="og:title" content="T-SQL">
    <meta property="og:description" content="T-SQL query language of SQL Server">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Technology Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="white">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.f7c29e46.css" as="style"><link rel="preload" href="/assets/js/app.1a75dedc.js" as="script"><link rel="preload" href="/assets/js/2.ebe3edc5.js" as="script"><link rel="preload" href="/assets/js/130.f70e3680.js" as="script"><link rel="prefetch" href="/assets/js/10.9a87b115.js"><link rel="prefetch" href="/assets/js/100.a004066b.js"><link rel="prefetch" href="/assets/js/101.98d7eae4.js"><link rel="prefetch" href="/assets/js/102.d367dc9c.js"><link rel="prefetch" href="/assets/js/103.48646cdd.js"><link rel="prefetch" href="/assets/js/104.b5ac1a10.js"><link rel="prefetch" href="/assets/js/105.5449f057.js"><link rel="prefetch" href="/assets/js/106.afe0985e.js"><link rel="prefetch" href="/assets/js/107.7b588ec7.js"><link rel="prefetch" href="/assets/js/108.56996842.js"><link rel="prefetch" href="/assets/js/109.3fc97ef4.js"><link rel="prefetch" href="/assets/js/11.289c0888.js"><link rel="prefetch" href="/assets/js/110.4ff693bc.js"><link rel="prefetch" href="/assets/js/111.a7cd6d21.js"><link rel="prefetch" href="/assets/js/112.50094470.js"><link rel="prefetch" href="/assets/js/113.723f2756.js"><link rel="prefetch" href="/assets/js/114.a1debb6a.js"><link rel="prefetch" href="/assets/js/115.bb77c326.js"><link rel="prefetch" href="/assets/js/116.390c4c56.js"><link rel="prefetch" href="/assets/js/117.7c55998f.js"><link rel="prefetch" href="/assets/js/118.7173ed9d.js"><link rel="prefetch" href="/assets/js/119.5e5d0f5a.js"><link rel="prefetch" href="/assets/js/12.02062816.js"><link rel="prefetch" href="/assets/js/120.73fd5a69.js"><link rel="prefetch" href="/assets/js/121.312e7da5.js"><link rel="prefetch" href="/assets/js/122.4925846d.js"><link rel="prefetch" href="/assets/js/123.fa848433.js"><link rel="prefetch" href="/assets/js/124.6bfe76c2.js"><link rel="prefetch" href="/assets/js/125.44de8350.js"><link rel="prefetch" href="/assets/js/126.14d6ac82.js"><link rel="prefetch" href="/assets/js/127.5867b31f.js"><link rel="prefetch" href="/assets/js/128.65b80027.js"><link rel="prefetch" href="/assets/js/129.2aca6f5a.js"><link rel="prefetch" href="/assets/js/13.27855381.js"><link rel="prefetch" href="/assets/js/131.aae7f80a.js"><link rel="prefetch" href="/assets/js/14.47dc7f50.js"><link rel="prefetch" href="/assets/js/15.06e55b5f.js"><link rel="prefetch" href="/assets/js/16.851551ba.js"><link rel="prefetch" href="/assets/js/17.d49024cc.js"><link rel="prefetch" href="/assets/js/18.9a028418.js"><link rel="prefetch" href="/assets/js/19.1561b47a.js"><link rel="prefetch" href="/assets/js/20.cc990a73.js"><link rel="prefetch" href="/assets/js/21.9009db40.js"><link rel="prefetch" href="/assets/js/22.dedd33bd.js"><link rel="prefetch" href="/assets/js/23.07b672f1.js"><link rel="prefetch" href="/assets/js/24.7d474002.js"><link rel="prefetch" href="/assets/js/25.41d4fd6e.js"><link rel="prefetch" href="/assets/js/26.e7fac7da.js"><link rel="prefetch" href="/assets/js/27.6547052b.js"><link rel="prefetch" href="/assets/js/28.3d0140b9.js"><link rel="prefetch" href="/assets/js/29.0fc86592.js"><link rel="prefetch" href="/assets/js/3.77d5e480.js"><link rel="prefetch" href="/assets/js/30.9ab402b6.js"><link rel="prefetch" href="/assets/js/31.e66781af.js"><link rel="prefetch" href="/assets/js/32.e45aef6d.js"><link rel="prefetch" href="/assets/js/33.f53f22a0.js"><link rel="prefetch" href="/assets/js/34.1249180a.js"><link rel="prefetch" href="/assets/js/35.d13e15f7.js"><link rel="prefetch" href="/assets/js/36.0af61c54.js"><link rel="prefetch" href="/assets/js/37.0fbda6ba.js"><link rel="prefetch" href="/assets/js/38.4ad6cce9.js"><link rel="prefetch" href="/assets/js/39.9ba7ed65.js"><link rel="prefetch" href="/assets/js/4.6bd850ca.js"><link rel="prefetch" href="/assets/js/40.0ee2c23c.js"><link rel="prefetch" href="/assets/js/41.20eb987d.js"><link rel="prefetch" href="/assets/js/42.f169c791.js"><link rel="prefetch" href="/assets/js/43.8132a52b.js"><link rel="prefetch" href="/assets/js/44.856fd0bb.js"><link rel="prefetch" href="/assets/js/45.15f169bf.js"><link rel="prefetch" href="/assets/js/46.687b60ce.js"><link rel="prefetch" href="/assets/js/47.081774d3.js"><link rel="prefetch" href="/assets/js/48.d1b52774.js"><link rel="prefetch" href="/assets/js/49.6a74ef12.js"><link rel="prefetch" href="/assets/js/5.a753d39d.js"><link rel="prefetch" href="/assets/js/50.f6a3f3d1.js"><link rel="prefetch" href="/assets/js/51.bb86f3e5.js"><link rel="prefetch" href="/assets/js/52.8bbc3a7d.js"><link rel="prefetch" href="/assets/js/53.3a845119.js"><link rel="prefetch" href="/assets/js/54.5ad9bb9a.js"><link rel="prefetch" href="/assets/js/55.cd1cdae9.js"><link rel="prefetch" href="/assets/js/56.e54de15a.js"><link rel="prefetch" href="/assets/js/57.86f052bc.js"><link rel="prefetch" href="/assets/js/58.7a473a12.js"><link rel="prefetch" href="/assets/js/59.b5644728.js"><link rel="prefetch" href="/assets/js/6.e008b738.js"><link rel="prefetch" href="/assets/js/60.f4919ab7.js"><link rel="prefetch" href="/assets/js/61.c3a1966d.js"><link rel="prefetch" href="/assets/js/62.3730af2e.js"><link rel="prefetch" href="/assets/js/63.7180471c.js"><link rel="prefetch" href="/assets/js/64.9ff2a2b8.js"><link rel="prefetch" href="/assets/js/65.b4959742.js"><link rel="prefetch" href="/assets/js/66.022a948d.js"><link rel="prefetch" href="/assets/js/67.c53ffcde.js"><link rel="prefetch" href="/assets/js/68.370f2a85.js"><link rel="prefetch" href="/assets/js/69.9ef7b74a.js"><link rel="prefetch" href="/assets/js/7.705d8a11.js"><link rel="prefetch" href="/assets/js/70.0e611821.js"><link rel="prefetch" href="/assets/js/71.c137fc8e.js"><link rel="prefetch" href="/assets/js/72.31fc1a87.js"><link rel="prefetch" href="/assets/js/73.3b62c1c7.js"><link rel="prefetch" href="/assets/js/74.52ddd888.js"><link rel="prefetch" href="/assets/js/75.5f2ec06a.js"><link rel="prefetch" href="/assets/js/76.d55ba59e.js"><link rel="prefetch" href="/assets/js/77.1d156bb8.js"><link rel="prefetch" href="/assets/js/78.3bc9f378.js"><link rel="prefetch" href="/assets/js/79.33623219.js"><link rel="prefetch" href="/assets/js/8.ad403723.js"><link rel="prefetch" href="/assets/js/80.b889712b.js"><link rel="prefetch" href="/assets/js/81.af4f2ca2.js"><link rel="prefetch" href="/assets/js/82.f7f69ab9.js"><link rel="prefetch" href="/assets/js/83.bee96ebf.js"><link rel="prefetch" href="/assets/js/84.670c4455.js"><link rel="prefetch" href="/assets/js/85.f0a77343.js"><link rel="prefetch" href="/assets/js/86.b79edaab.js"><link rel="prefetch" href="/assets/js/87.3daf94a0.js"><link rel="prefetch" href="/assets/js/88.99e05927.js"><link rel="prefetch" href="/assets/js/89.283f97fa.js"><link rel="prefetch" href="/assets/js/9.dda0363d.js"><link rel="prefetch" href="/assets/js/90.6f2f7cd7.js"><link rel="prefetch" href="/assets/js/91.bb692fd1.js"><link rel="prefetch" href="/assets/js/92.6e3aa945.js"><link rel="prefetch" href="/assets/js/93.4602eb2c.js"><link rel="prefetch" href="/assets/js/94.6f90dd2a.js"><link rel="prefetch" href="/assets/js/95.b99b5d66.js"><link rel="prefetch" href="/assets/js/96.02fcde20.js"><link rel="prefetch" href="/assets/js/97.dc3b4edd.js"><link rel="prefetch" href="/assets/js/98.3585a636.js"><link rel="prefetch" href="/assets/js/99.57422738.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7c29e46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Technology Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/meta/" class="nav-link">
  Meta
</a></div> <span class="external-services" data-v-10a38898><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-f9b87572 data-v-10a38898><img src="/img/linkedin.webp" data-v-f9b87572></a><a target="_blank" href="https://github.com/marcinjahn" data-v-f9b87572 data-v-10a38898><img src="/img/github.webp" data-v-f9b87572></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/technologies/" aria-current="page" class="sidebar-link">/technologies/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Web Protocols</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Blockchain</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>SQL Server</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/technologies/sql-server/" aria-current="page" class="sidebar-link">Overview</a></li><li><a href="/technologies/sql-server/t-sql.html" aria-current="page" class="active sidebar-link">T-SQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technologies/sql-server/t-sql.html#types" class="sidebar-link">Types</a></li><li class="sidebar-sub-header"><a href="/technologies/sql-server/t-sql.html#functions" class="sidebar-link">Functions</a></li><li class="sidebar-sub-header"><a href="/technologies/sql-server/t-sql.html#operations" class="sidebar-link">Operations</a></li><li class="sidebar-sub-header"><a href="/technologies/sql-server/t-sql.html#tips" class="sidebar-link">Tips</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Azure</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="t-sql"><a href="#t-sql" class="header-anchor">#</a> T-SQL</h1> <p>Every RDBMS vendor uses their own variation of SQL. MS implemented T-SQL
(Transactional Structured Query Language) for their MS SQL Server offering.</p> <p>SQL is strongly typed.</p> <h2 id="types"><a href="#types" class="header-anchor">#</a> Types</h2> <ul><li>text:
<ul><li><em>char(n)</em> - fixed length - good when we know the length or when length is
less than 3 (more optimized than varchar(n)) (non-Unicode)</li> <li><em>varchar(n)</em> - variable length (up to <em>n</em>) (non-Unicode)</li> <li><em>nchar(n)</em> - fixed length (Unicode)</li> <li><em>nvarchar(n)</em> - variable length (up to <em>n</em>) (Unicode)</li></ul></li> <li>integers:
<ul><li><em>tinyint</em> (1 byte - 0-255)</li> <li><em>smallint</em> (2 bytes)</li> <li><em>int</em> (4 bytes)</li> <li><em>bigint</em> (8 bytes)</li></ul></li> <li>decimals:
<ul><li><em>decimal/numeric</em> (5-17 bytes) - optionally, we can provide precision and
scale</li> <li><em>money</em> (8 bytes) - 4 decimal places</li> <li><em>smallmoney</em> (4 bytes)</li></ul></li> <li>date/time:
<ul><li><em>date</em> (3 bytes)</li> <li><em>time</em> - time precision might be adjusted</li> <li><em>datetime</em> (8 bytes) - legacy type</li> <li><em>smalldatetime</em> (4 bytes)</li> <li><em>datetime2</em> (6-8 bytes) - adjustable precision, it's a good choice in
general</li> <li><em>datetimeoffset</em> (10 bytes) - with timezone</li></ul></li> <li>boolean
<ul><li><em>bit</em></li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">money</p> <p>The <em>money</em> and <em>smallmoney</em> sizes are unique to SQL Server, so potentially it's
not the best choice.</p></div> <h3 id="casting"><a href="#casting" class="header-anchor">#</a> Casting</h3> <p>We can cast types using the <code>CAST</code> function. E.g.:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> CAST<span class="token punctuation">(</span><span class="token number">7</span> <span class="token keyword">AS</span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token comment">-- Without the cast, the resoult would be '3'</span>
</code></pre></div><p>SQL can also cast by itself trying to guess the intention:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">'4'</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment">-- Returns 8 by converting '4' to a number</span>
</code></pre></div><h2 id="functions"><a href="#functions" class="header-anchor">#</a> Functions</h2> <p>SQL Server comes with a bunch of buit-in functions (like <code>GETDATE</code>, <code>SQRT</code>,
etc.), which we can use in our queries. We can also create our own functions.</p> <h2 id="operations"><a href="#operations" class="header-anchor">#</a> Operations</h2> <h3 id="creating-a-db"><a href="#creating-a-db" class="header-anchor">#</a> Creating a DB</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> BobsShoes<span class="token punctuation">;</span>
GO
</code></pre></div><h3 id="creating-a-table"><a href="#creating-a-table" class="header-anchor">#</a> Creating a table</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- set the right database context</span>
<span class="token keyword">USE</span> BobsShoes<span class="token punctuation">;</span>
GO

<span class="token comment">-- schema (namespace)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> Orders 
    <span class="token keyword">AUTHORIZATION</span> dbo<span class="token punctuation">;</span>
GO

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders<span class="token punctuation">.</span>Customers <span class="token punctuation">(</span>
    CustID <span class="token keyword">int</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
        <span class="token keyword">CONSTRAINT</span> PK_Customers_CustID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    CustName nvarchar<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    CustStreet nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    CustCity nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    CustStateProv nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    CustCountry nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    CustPostalCode nvarchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    SalutationID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> 
        <span class="token keyword">CONSTRAINT</span> FK_Customers_SaluationID_Salutations_SalutationID 
            <span class="token keyword">REFERENCES</span> Orders<span class="token punctuation">.</span>Salutations <span class="token punctuation">(</span>SalutationID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders<span class="token punctuation">.</span>Stock <span class="token punctuation">(</span>
    StockID <span class="token keyword">int</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
        <span class="token keyword">CONSTRAINT</span> PK_Stock_StockID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    
    StockSKU <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    StockSize <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    StockName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    StockPrice <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders<span class="token punctuation">.</span>Orders <span class="token punctuation">(</span>  
    OrderID <span class="token keyword">int</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
        <span class="token keyword">CONSTRAINT</span> PK_Orders_OrderID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    OrderDate <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    OrderRequestedDate <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    OrderDeliveryDate datetime2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    CustID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token comment">--,</span>
        <span class="token keyword">CONSTRAINT</span> FK_Orders_CustID_Customers_CustID 
            <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> Orders<span class="token punctuation">.</span>Customers <span class="token punctuation">(</span>CustID<span class="token punctuation">)</span><span class="token punctuation">,</span>
    OrderIsExpedited <span class="token keyword">bit</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
 <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders<span class="token punctuation">.</span>OrderItems <span class="token punctuation">(</span>
    OrderItemID <span class="token keyword">int</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
        <span class="token keyword">CONSTRAINT</span> PK_OrderItems_OrderItemID <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    OrderID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token comment">--,</span>
        <span class="token keyword">CONSTRAINT</span> FK_OrderItems_OrderID_Orders_OrderID
            <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> Orders<span class="token punctuation">.</span>Orders <span class="token punctuation">(</span>OrderID<span class="token punctuation">)</span><span class="token punctuation">,</span>
    StockID <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token comment">--,</span>
        <span class="token keyword">CONSTRAINT</span> FK_OrderItems_StockID_Stock_StockID
            <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> Orders<span class="token punctuation">.</span>Stock <span class="token punctuation">(</span>StockID<span class="token punctuation">)</span><span class="token punctuation">,</span>
    Quantity <span class="token keyword">smallint</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Discount <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>TotalPrice</code> is a calculated colum (the values can be persisted with the
<code>PERSISTED</code> keyword</li> <li><code>Orders.OrderTracking</code> - <code>Orders</code> is the schema, <code>OrdreTracking</code> is table's
name</li></ul> <h3 id="inserting-rows"><a href="#inserting-rows" class="header-anchor">#</a> Inserting rows</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Orders<span class="token punctuation">.</span>Stock <span class="token punctuation">(</span>
        StockSKU<span class="token punctuation">,</span> 
        StockName<span class="token punctuation">,</span> 
        StockSize<span class="token punctuation">,</span> 
        StockPrice<span class="token punctuation">)</span>

<span class="token keyword">VALUES</span>
    <span class="token punctuation">(</span><span class="token string">'OXFORD01'</span><span class="token punctuation">,</span> <span class="token string">'Oxford'</span><span class="token punctuation">,</span> <span class="token string">'10_D'</span><span class="token punctuation">,</span> <span class="token number">50.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'BABYSHO1'</span><span class="token punctuation">,</span> <span class="token string">'BabySneakers'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token number">20.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">'HEELS001'</span><span class="token punctuation">,</span> <span class="token string">'Killer Heels'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token number">75.</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="queries"><a href="#queries" class="header-anchor">#</a> Queries</h3> <h4 id="order-of-execution"><a href="#order-of-execution" class="header-anchor">#</a> Order of Execution</h4> <p>A <code>SELECT</code> statement is executed in the following order:</p> <ol><li><code>FROM</code> - dataset is prepared</li> <li><code>WHERE</code> filters data using predicates</li> <li><code>GROUP BY</code> - rows combined into groups</li> <li><code>HAVING</code> - another filter - for groups this time</li> <li><code>SELECT</code> - evaluates a provided list of expressions on every row</li> <li><code>ORDER BY</code> - ordering</li> <li><code>OFFSET - FETCH</code> - limit the number of rows</li></ol> <p>Examples:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">'ABC'</span> <span class="token keyword">AS</span> Something
<span class="token keyword">FROM</span> Orders

<span class="token comment">-- returns:</span>
<span class="token comment">-- Something</span>
<span class="token comment">-- ---------</span>
<span class="token comment">-- 'ABC'</span>
<span class="token comment">-- 'ABC'</span>
<span class="token comment">-- 'ABC'</span>
<span class="token comment">-- ... -- as many 'ABC's as many rows the Orders table has</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Just SELECT</p> <p>SQL Server allows execution of queries that have only the <code>SELECT</code> clause, such
as <code>SELECT 2*2;</code>.</p></div> <h4 id="join"><a href="#join" class="header-anchor">#</a> JOIN</h4> <ul><li><p><strong>CROSS JOIN</strong> - A <strong>Cartesian Product</strong> of two tables - every entity from table A
is matched with every element from table B - it's rarely useful</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> Customers
<span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> Orders<span class="token punctuation">;</span>
</code></pre></div><p>Result:</p> <table><thead><tr><th>Customer</th> <th>Country</th> <th>OrderID</th> <th>OrderDate</th> <th>Customer</th></tr></thead> <tbody><tr><td>Bob</td> <td>NULL</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Chen</td> <td>China</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Jack</td> <td>USA</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Kelly</td> <td>USA</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Sunil</td> <td>India</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Bob</td> <td>NULL</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Chen</td> <td>China</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Jack</td> <td>USA</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Kelly</td> <td>USA</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Sunil</td> <td>India</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Bob</td> <td>NULL</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Chen</td> <td>China</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Jack</td> <td>USA</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Kelly</td> <td>USA</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Sunil</td> <td>India</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Bob</td> <td>NULL</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr> <tr><td>Chen</td> <td>China</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr> <tr><td>Jack</td> <td>USA</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr> <tr><td>Kelly</td> <td>USA</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr> <tr><td>Sunil</td> <td>India</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr></tbody></table> <p>We have 5 Customers, and 4 Orders. We see every customer combined with every
order using cartesian product - 20 rows. It doesn't really make any sense.</p></li> <li><p><strong>INNER JOIN</strong> - It starts with a CROSS JOIN, and then uses a <em>Join Predicate</em>
(like <code>ON A.Name = B.Name</code>) to extract only the rows where the predicate
evaluates to true. E.g. if predicate was <code>ON 1=1</code>, we'd get the same result as
for the CROSS JOIN.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> Customers <span class="token keyword">AS</span> C
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Orders <span class="token keyword">AS</span> O
<span class="token keyword">ON</span> C<span class="token punctuation">.</span>Customer <span class="token operator">=</span> O<span class="token punctuation">.</span>Customer<span class="token punctuation">;</span>
</code></pre></div><p>Result:</p> <table><thead><tr><th>Customer</th> <th>Country</th> <th>OrderID</th> <th>OrderDate</th> <th>Customer</th></tr></thead> <tbody><tr><td>Jack</td> <td>USA</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Bob</td> <td>NULL</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Jack</td> <td>USA</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Chen</td> <td>China</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr></tbody></table> <p>Jack did two orders. We do not see the customers that didn't do any orders.</p></li> <li><p><strong>LEFT/RIGHT OUTER JOIN</strong> - Works like an INNER JOIN, however, we can specify that
entities of one of the sets (tables) will be takes even if predicate is not
satisfied. The choice of the set is made with <code>LEFT</code> or <code>RIGHT</code>. The selected
set is a <strong>Reserved Set</strong>.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> Customers <span class="token keyword">AS</span> C
<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> Orders <span class="token keyword">AS</span> O
<span class="token keyword">ON</span> C<span class="token punctuation">.</span>Customer <span class="token operator">=</span> O<span class="token punctuation">.</span>Customer<span class="token punctuation">;</span>
</code></pre></div><p>Result:</p> <table><thead><tr><th>Customer</th> <th>Country</th> <th>OrderID</th> <th>OrderDate</th> <th>Customer</th></tr></thead> <tbody><tr><td>Bob</td> <td>NULL</td> <td>2</td> <td>2019-01-01</td> <td>Bob</td></tr> <tr><td>Chen</td> <td>China</td> <td>4</td> <td>2019-01-16</td> <td>Chen</td></tr> <tr><td>Jack</td> <td>USA</td> <td>1</td> <td>2019-01-01</td> <td>Jack</td></tr> <tr><td>Jack</td> <td>USA</td> <td>3</td> <td>2019-01-15</td> <td>Jack</td></tr> <tr><td>Kelly</td> <td>USA</td> <td>NULL</td> <td>NULL</td> <td>NULL</td></tr> <tr><td>Sunil</td> <td>India</td> <td>NULL</td> <td>NULL</td> <td>NULL</td></tr></tbody></table> <p>The customers which did not make any orders are present as well. The columns
of the Orders table are NULLed for them.</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">Default</p> <p>If we just use the <code>JOIN</code> keyword in the query, the <code>INNER JOIN</code> will be used.</p> <p>If we use <code>LEFT/RIGHT JOIN</code>, the <code>LEFT/RIGHT OUTER JOIN</code> will be used.</p></div> <h4 id="where"><a href="#where" class="header-anchor">#</a> WHERE</h4> <p>Due to the fact that SQL includes NULLs, we have to deal with <strong>Ternary Logic</strong>.
On top of <code>true</code>/<code>false</code> there is a possibllity of an <code>unknown</code> result. To test
for <code>unknown</code> we use the <code>IS NULL</code>/<code>IS NOT NULL</code> operators.</p> <div class="custom-block tip"><p class="custom-block-title">Not Equal</p> <p>Both the <code>!=</code> and <code>&lt;&gt;</code> are inequality operators. It's better to use the <code>&lt;&gt;</code>
though since it follows the ISO standard.</p></div> <h4 id="group-by"><a href="#group-by" class="header-anchor">#</a> GROUP BY</h4> <p><code>GROUP BY</code> is useful when we do not care about individual entities, but rather
about some aggreagation of them (&quot;How many people...&quot;, &quot;What's the average...&quot;).
We get a single answer for the entire group instead of getting answers for every
individual.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Country<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Count <span class="token comment">-- COUNT(*) refers to each group</span>
<span class="token keyword">FROM</span> Customers
<span class="token keyword">WHERE</span> Country <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Country<span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Country</th> <th>Count</th></tr></thead> <tbody><tr><td>China</td> <td>1</td></tr> <tr><td>India</td> <td>1</td></tr> <tr><td>USA</td> <td>2</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">SELECT *</p> <p>When using <code>GROUP BY</code>, we can no longer use <code>SELECT *</code>. <code>GROUP BY</code> returns an
aggreagation on some colums, the other columns are not included.</p></div> <div class="custom-block tip"><p class="custom-block-title">NULL</p> <p>When using <code>GROUP BY</code> on some column, the rows with the NULL value on that
column fall into the same group (NULL).</p></div> <h5 id="having"><a href="#having" class="header-anchor">#</a> HAVING</h5> <p>After grouping we can apply filtering on top of it - using the <code>HAVING</code> clause.
The difference from <code>WHERE</code> is the fact that <code>WHERE</code> is applied to individual
rows, while <code>HAVING</code> is applied to groups. Basically, the order of when they are
applied differs.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Country<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Count
<span class="token keyword">FROM</span> Customers
<span class="token keyword">WHERE</span> Country <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Country
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">-- We cannot use the 'Count' alias here</span>
</code></pre></div><h4 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h4> <p>Some remarks:</p> <ul><li><p>We cannot create expressions based on aliases used in different expressions.
For example, <code>SELECT (Quantity * Price) AS Total, 0.9 * Total FROM Items;</code>
will not work, because <code>Total</code> will be unrecognized.</p></li> <li><p><code>DISTINCT</code> eliminates duplicates (NULLs are treated as equal). It looks at all
the <code>SELECT</code>ed columns and removes rows that are exactly the same.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Country
<span class="token keyword">FROM</span> Customers<span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">ALL</p> <p>Without <code>DISTINCT</code>, every <code>SELECT</code> is actually a <code>SELECT ALL</code> - it returns
all the rows that were retrieved.</p></div></li> <li><p>Dealing with NULLs:</p> <ul><li><p><code>ISNULL(X, Y)</code> function replaces column X (if it's null) with Y. It's a
simplified version of a more general <code>COALESCE</code> function (which is
available in other RDBMSs as well).</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> ISNULL<span class="token punctuation">(</span>Country<span class="token punctuation">,</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span> Country
<span class="token keyword">FROM</span> Customers<span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h4 id="order-by"><a href="#order-by" class="header-anchor">#</a> ORDER BY</h4> <p>Some facts:</p> <ul><li>NULLs have always the lowest ordering value (Postgres uses the opposite logic,
but allows to change that)</li> <li>we can refer to aliases defined in <code>SELECT</code></li> <li>ascending order is the default</li> <li>the order of rows that have the same values for the column(s) we're ordering by is
undeterministic</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> Orders
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> OrderDate <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment">-- With GROUP BY</span>
<span class="token keyword">SELECT</span> Item<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>Quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> NumbersOfItemsSold
<span class="token keyword">FROM</span> OrderItems
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Item
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> NumbersOfItemsSold
</code></pre></div><h2 id="tips"><a href="#tips" class="header-anchor">#</a> Tips</h2> <ul><li><p><code>TOP</code> is an SQL Server-only feature</p> <ul><li><code>OFFSET - FETCH</code> is a more standard way, it also simplifies paging</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Item<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>Quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> NumbersOfItemsSold
<span class="token keyword">FROM</span> OrderItems
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Item
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> NumbersOfItemsSold <span class="token keyword">DESC</span>
<span class="token keyword">OFFSET</span> <span class="token number">0</span> <span class="token keyword">ROWS</span> <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token number">3</span> <span class="token keyword">ROWS</span> ONLY<span class="token punctuation">;</span> <span class="token comment">-- Like TOP(3), but with paging</span>
</code></pre></div></li></ul></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technologies/sql-server/" class="prev router-link-active">
        Overview
      </a></span> <span class="next"><a href="/technologies/mongodb/nosql.html">
        NoSQL Overview
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/19/2022, 7:33:24 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1a75dedc.js" defer></script><script src="/assets/js/2.ebe3edc5.js" defer></script><script src="/assets/js/130.f70e3680.js" defer></script>
  </body>
</html>
