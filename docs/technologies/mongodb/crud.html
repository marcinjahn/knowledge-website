<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CRUD | Marcin Jahn | Tech Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="MongoDB CRUD operations">
    <meta property="og:url" content="/technologies/mongodb/crud.html">
    <meta property="og:site_name" content="Marcin Jahn | Tech Notebook">
    <meta property="og:title" content="CRUD">
    <meta property="og:description" content="MongoDB CRUD operations">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Tech Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="#7D84B2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.e1f31b71.css" as="style"><link rel="preload" href="/assets/js/app.22c9c92e.js" as="script"><link rel="preload" href="/assets/js/34.31ac4316.js" as="script"><link rel="preload" href="/assets/js/1.b47f5ac5.js" as="script"><link rel="preload" href="/assets/js/153.e5d9e635.js" as="script"><link rel="prefetch" href="/assets/js/10.6ce44a49.js"><link rel="prefetch" href="/assets/js/100.1e343455.js"><link rel="prefetch" href="/assets/js/101.66036a9f.js"><link rel="prefetch" href="/assets/js/102.dbd5f8ac.js"><link rel="prefetch" href="/assets/js/103.990cf897.js"><link rel="prefetch" href="/assets/js/104.634b75ed.js"><link rel="prefetch" href="/assets/js/105.4ba13ec9.js"><link rel="prefetch" href="/assets/js/106.b20d3d0e.js"><link rel="prefetch" href="/assets/js/107.a1008d78.js"><link rel="prefetch" href="/assets/js/108.bef24d7b.js"><link rel="prefetch" href="/assets/js/109.b0a76ba5.js"><link rel="prefetch" href="/assets/js/11.62bc70e0.js"><link rel="prefetch" href="/assets/js/110.669699ff.js"><link rel="prefetch" href="/assets/js/111.73332903.js"><link rel="prefetch" href="/assets/js/112.595671ac.js"><link rel="prefetch" href="/assets/js/113.2b65afac.js"><link rel="prefetch" href="/assets/js/114.e9278ec3.js"><link rel="prefetch" href="/assets/js/115.38e835c1.js"><link rel="prefetch" href="/assets/js/116.e18ce095.js"><link rel="prefetch" href="/assets/js/117.8716a17e.js"><link rel="prefetch" href="/assets/js/118.639cac5f.js"><link rel="prefetch" href="/assets/js/119.e6cf5ab2.js"><link rel="prefetch" href="/assets/js/12.82aed312.js"><link rel="prefetch" href="/assets/js/120.189c7f8b.js"><link rel="prefetch" href="/assets/js/121.5ce9cfba.js"><link rel="prefetch" href="/assets/js/122.2d975d4f.js"><link rel="prefetch" href="/assets/js/123.f17751b7.js"><link rel="prefetch" href="/assets/js/124.9344fd00.js"><link rel="prefetch" href="/assets/js/125.37060300.js"><link rel="prefetch" href="/assets/js/126.da749dab.js"><link rel="prefetch" href="/assets/js/127.6ecf6a43.js"><link rel="prefetch" href="/assets/js/128.dce948dd.js"><link rel="prefetch" href="/assets/js/129.e2334036.js"><link rel="prefetch" href="/assets/js/13.8501ef49.js"><link rel="prefetch" href="/assets/js/130.28b70b30.js"><link rel="prefetch" href="/assets/js/131.5d64108b.js"><link rel="prefetch" href="/assets/js/132.01bd4460.js"><link rel="prefetch" href="/assets/js/133.f1b0b6b7.js"><link rel="prefetch" href="/assets/js/134.4f325df7.js"><link rel="prefetch" href="/assets/js/135.55861f05.js"><link rel="prefetch" href="/assets/js/136.e3a04c1e.js"><link rel="prefetch" href="/assets/js/137.0ed66438.js"><link rel="prefetch" href="/assets/js/138.e75ddf54.js"><link rel="prefetch" href="/assets/js/139.5afdf913.js"><link rel="prefetch" href="/assets/js/14.d4a588f3.js"><link rel="prefetch" href="/assets/js/140.1ac21268.js"><link rel="prefetch" href="/assets/js/141.84728838.js"><link rel="prefetch" href="/assets/js/142.f3e01928.js"><link rel="prefetch" href="/assets/js/143.a5db5028.js"><link rel="prefetch" href="/assets/js/144.08c06342.js"><link rel="prefetch" href="/assets/js/145.5971ce78.js"><link rel="prefetch" href="/assets/js/146.3888e912.js"><link rel="prefetch" href="/assets/js/147.78e8de89.js"><link rel="prefetch" href="/assets/js/148.f11988b1.js"><link rel="prefetch" href="/assets/js/149.b6d54880.js"><link rel="prefetch" href="/assets/js/15.1944b6ba.js"><link rel="prefetch" href="/assets/js/150.ab772764.js"><link rel="prefetch" href="/assets/js/151.f6b51d0f.js"><link rel="prefetch" href="/assets/js/152.e4c69bc2.js"><link rel="prefetch" href="/assets/js/154.f111520f.js"><link rel="prefetch" href="/assets/js/155.08b5b581.js"><link rel="prefetch" href="/assets/js/156.7231ac6b.js"><link rel="prefetch" href="/assets/js/157.4fdbc5e7.js"><link rel="prefetch" href="/assets/js/158.5e399539.js"><link rel="prefetch" href="/assets/js/159.91e6d81d.js"><link rel="prefetch" href="/assets/js/16.59d18f2b.js"><link rel="prefetch" href="/assets/js/160.115ade6d.js"><link rel="prefetch" href="/assets/js/161.800b7f65.js"><link rel="prefetch" href="/assets/js/162.36ef5e38.js"><link rel="prefetch" href="/assets/js/163.ef8042fd.js"><link rel="prefetch" href="/assets/js/164.2dbcb351.js"><link rel="prefetch" href="/assets/js/165.a5bf9663.js"><link rel="prefetch" href="/assets/js/166.7ad7e037.js"><link rel="prefetch" href="/assets/js/167.76163d57.js"><link rel="prefetch" href="/assets/js/168.d731dea4.js"><link rel="prefetch" href="/assets/js/169.b616542f.js"><link rel="prefetch" href="/assets/js/17.607b50f0.js"><link rel="prefetch" href="/assets/js/170.0a49a394.js"><link rel="prefetch" href="/assets/js/18.5fbd0cb7.js"><link rel="prefetch" href="/assets/js/19.3948de26.js"><link rel="prefetch" href="/assets/js/2.494d3044.js"><link rel="prefetch" href="/assets/js/20.be25fcdc.js"><link rel="prefetch" href="/assets/js/21.ffd9de8e.js"><link rel="prefetch" href="/assets/js/22.15a3a5b1.js"><link rel="prefetch" href="/assets/js/23.fa676f8d.js"><link rel="prefetch" href="/assets/js/24.c624514a.js"><link rel="prefetch" href="/assets/js/25.ef85c688.js"><link rel="prefetch" href="/assets/js/26.9fc77621.js"><link rel="prefetch" href="/assets/js/27.3b7745a9.js"><link rel="prefetch" href="/assets/js/28.3115b11b.js"><link rel="prefetch" href="/assets/js/29.9caf0e23.js"><link rel="prefetch" href="/assets/js/30.c65180e2.js"><link rel="prefetch" href="/assets/js/31.af3cd59d.js"><link rel="prefetch" href="/assets/js/32.049a5e71.js"><link rel="prefetch" href="/assets/js/33.c1fb3e12.js"><link rel="prefetch" href="/assets/js/35.bb23f66f.js"><link rel="prefetch" href="/assets/js/36.50a7ff1a.js"><link rel="prefetch" href="/assets/js/37.94db5401.js"><link rel="prefetch" href="/assets/js/38.00a24f0e.js"><link rel="prefetch" href="/assets/js/39.e887e441.js"><link rel="prefetch" href="/assets/js/4.e9258899.js"><link rel="prefetch" href="/assets/js/40.c44e28ba.js"><link rel="prefetch" href="/assets/js/41.d1ae7813.js"><link rel="prefetch" href="/assets/js/42.9be5ebf1.js"><link rel="prefetch" href="/assets/js/43.373267a9.js"><link rel="prefetch" href="/assets/js/44.cb7960c2.js"><link rel="prefetch" href="/assets/js/45.5e2d5209.js"><link rel="prefetch" href="/assets/js/46.d799469e.js"><link rel="prefetch" href="/assets/js/47.d9b19830.js"><link rel="prefetch" href="/assets/js/48.60dad23b.js"><link rel="prefetch" href="/assets/js/49.dc36b786.js"><link rel="prefetch" href="/assets/js/5.e0e7db7d.js"><link rel="prefetch" href="/assets/js/50.8d4d7b6b.js"><link rel="prefetch" href="/assets/js/51.0c1468eb.js"><link rel="prefetch" href="/assets/js/52.d20f0b7e.js"><link rel="prefetch" href="/assets/js/53.64e9837d.js"><link rel="prefetch" href="/assets/js/54.6b008899.js"><link rel="prefetch" href="/assets/js/55.c735796a.js"><link rel="prefetch" href="/assets/js/56.91cdfcb2.js"><link rel="prefetch" href="/assets/js/57.2a5ba189.js"><link rel="prefetch" href="/assets/js/58.453abc66.js"><link rel="prefetch" href="/assets/js/59.f038591d.js"><link rel="prefetch" href="/assets/js/6.9eaa0cdd.js"><link rel="prefetch" href="/assets/js/60.a766acbc.js"><link rel="prefetch" href="/assets/js/61.11115f16.js"><link rel="prefetch" href="/assets/js/62.9137119c.js"><link rel="prefetch" href="/assets/js/63.7f4050d3.js"><link rel="prefetch" href="/assets/js/64.b3c40c58.js"><link rel="prefetch" href="/assets/js/65.c9e2b84a.js"><link rel="prefetch" href="/assets/js/66.83b71114.js"><link rel="prefetch" href="/assets/js/67.77b955b0.js"><link rel="prefetch" href="/assets/js/68.54c6b6b0.js"><link rel="prefetch" href="/assets/js/69.c087a7c5.js"><link rel="prefetch" href="/assets/js/7.303df4e5.js"><link rel="prefetch" href="/assets/js/70.cbb8df8d.js"><link rel="prefetch" href="/assets/js/71.fbd225c7.js"><link rel="prefetch" href="/assets/js/72.ddd27448.js"><link rel="prefetch" href="/assets/js/73.63654172.js"><link rel="prefetch" href="/assets/js/74.9f8abdc8.js"><link rel="prefetch" href="/assets/js/75.ece45ddf.js"><link rel="prefetch" href="/assets/js/76.13fc6146.js"><link rel="prefetch" href="/assets/js/77.00b115ae.js"><link rel="prefetch" href="/assets/js/78.bbcdd70a.js"><link rel="prefetch" href="/assets/js/79.63643d7b.js"><link rel="prefetch" href="/assets/js/8.7c5c4661.js"><link rel="prefetch" href="/assets/js/80.80c0fe43.js"><link rel="prefetch" href="/assets/js/81.76133266.js"><link rel="prefetch" href="/assets/js/82.c22591bc.js"><link rel="prefetch" href="/assets/js/83.7c4d7cd1.js"><link rel="prefetch" href="/assets/js/84.8f803945.js"><link rel="prefetch" href="/assets/js/85.3c5a57f2.js"><link rel="prefetch" href="/assets/js/86.d619433b.js"><link rel="prefetch" href="/assets/js/87.07bdaed7.js"><link rel="prefetch" href="/assets/js/88.2be26c0f.js"><link rel="prefetch" href="/assets/js/89.062ed02c.js"><link rel="prefetch" href="/assets/js/9.e23ce7d2.js"><link rel="prefetch" href="/assets/js/90.8d253134.js"><link rel="prefetch" href="/assets/js/91.094de06f.js"><link rel="prefetch" href="/assets/js/92.628bb6f6.js"><link rel="prefetch" href="/assets/js/93.665ec6f0.js"><link rel="prefetch" href="/assets/js/94.2d731d2c.js"><link rel="prefetch" href="/assets/js/95.760d48d8.js"><link rel="prefetch" href="/assets/js/96.56e08bd6.js"><link rel="prefetch" href="/assets/js/97.3e4780a3.js"><link rel="prefetch" href="/assets/js/98.6a913650.js"><link rel="prefetch" href="/assets/js/99.734c09a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e1f31b71.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Tech Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/technologies/" aria-current="page" class="sidebar-link">/technologies/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/network.webp"></span> <span>Networking</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/security.webp"></span> <span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/blockchain.webp"></span> <span>Blockchain</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/linux.webp"></span> <span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/kubernetes.webp"></span> <span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/sql-server.webp"></span> <span>SQL Server</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span class="img-container"><img src="/sidebar-imgs/mongodb.webp"></span> <span>MongoDB</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/technologies/mongodb/nosql.html" class="sidebar-link">NoSQL Overview</a></li><li><a href="/technologies/mongodb/mongo-overview.html" class="sidebar-link">MongoDB Overview</a></li><li><a href="/technologies/mongodb/crud.html" aria-current="page" class="active sidebar-link">CRUD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technologies/mongodb/crud.html#create" class="sidebar-link">CREATE</a></li><li class="sidebar-sub-header"><a href="/technologies/mongodb/crud.html#read" class="sidebar-link">READ</a></li><li class="sidebar-sub-header"><a href="/technologies/mongodb/crud.html#update" class="sidebar-link">UPDATE</a></li><li class="sidebar-sub-header"><a href="/technologies/mongodb/crud.html#delete" class="sidebar-link">DELETE</a></li></ul></li><li><a href="/technologies/mongodb/free-text-search.html" class="sidebar-link">Free Text Search</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/git.webp"></span> <span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/ansible.webp"></span> <span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/azure.webp"></span> <span>Azure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/gcp.webp"></span> <span>Google Cloud</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="querying"><a href="#querying" class="header-anchor">#</a> Querying</h1> <h2 id="create"><a href="#create" class="header-anchor">#</a> CREATE</h2> <ul><li><code>db.{collection}.insertOne()</code></li> <li><code>db.{collection}.insertMany()</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">insert</p> <p>There's also the <code>insert()</code> command, but it's deprecated.</p></div> <h3 id="insertone"><a href="#insertone" class="header-anchor">#</a> insertOne</h3> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>newusers<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;DisplayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Marcin Jahn&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;UserName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;marcinjahn&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Job&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Technology Evangelist&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Area&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IIoT&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;IsManager&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ProgrammingLanguages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;C#&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Rust&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  acknowledged<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  insertedId<span class="token operator">:</span> ObjectId(<span class="token string">&quot;625db707dcaea66b703dd542&quot;</span>)
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>acknowledged: true</code> part means that the command was acknowledged by the
ReplicaSet. It does not mean that the command was successful. It depends on
the selected <a href="#write-concern">Write Concern</a>.</p> <h3 id="insertmany"><a href="#insertmany" class="header-anchor">#</a> insertMany</h3> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>newusers<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;DisplayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Adam Black&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;UserName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;adamblack&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Job&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Software Developer&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Area&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IIoT&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;IsManager&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ProgrammingLanguages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;PHP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ruby&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;DisplayName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John Smith&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;UserName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;johnsmith&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Job&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DBA&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;Area&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IIoT&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;IsManager&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ProgrammingLanguages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;T-SQL&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  acknowledged<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  insertedIds<span class="token operator">:</span> <span class="token punctuation">{</span>
    '<span class="token number">0</span>'<span class="token operator">:</span> ObjectId(<span class="token string">&quot;625db928dcaea66b703dd543&quot;</span>)<span class="token punctuation">,</span>
    '<span class="token number">1</span>'<span class="token operator">:</span> ObjectId(<span class="token string">&quot;625db928dcaea66b703dd544&quot;</span>)
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>By default, all write operations are atomic on the level of a single document.
When we write/modify multiple documents, we can make the whole operation atomic
by using distributed transactions.</p> <p>Insert operation will create a collection if it doesn't exist yet.</p> <p>We can provide a second parameter <code>{&quot;ordered&quot;: false}</code> to speed up the
<code>insertMany</code>. This way, MongoDB does not have to insert documents in order and
can do it parallelly.</p> <h3 id="id"><a href="#id" class="header-anchor">#</a> _id</h3> <p>Every document has an <code>_id</code> field. If the provided document doesn't have it,
MongoDB will add it by itself. It must be unique. By default, it's of type
ObjectId (BSON), but we can set it ourselves as any type.</p> <h2 id="read"><a href="#read" class="header-anchor">#</a> READ</h2> <ul><li><code>db.{collection}.find()</code></li> <li><code>db.{collection}.findOne()</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">Cursor</p> <p><code>find</code> returns a cursor object, which exposes a few methods on it (like <code>sort</code>,
<code>count</code>, <code>limit</code>, <code>skip</code>, etc.).</p> <p><code>findOne</code> returns just a single document, without these methods.</p></div> <p>These operations is used for queries. When invoked without
parameters, it returns all the documents. The optional parameters are:</p> <ul><li><code>filter</code></li> <li><code>projection</code></li> <li><code>readConcern</code> (useful for Replica Set)</li></ul> <p>We can also <code>skip</code> and <code>limit</code> results. It's useful for <strong>paging</strong>.</p> <p>Some example:</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>rating<span class="token operator">:</span> <span class="token punctuation">{</span>$gte<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rating<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">readConcern</span><span class="token punctuation">(</span><span class="token string">&quot;majority&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="filter"><a href="#filter" class="header-anchor">#</a> Filter</h3> <p>The <a href="https://www.mongodb.com/docs/manual/reference/operator/query/" target="_blank" rel="noopener noreferrer">MongoDB
documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
contains a list of all the supported operators.</p> <p>Examples:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// All documents with `name` equal to &quot;Marcin&quot;. It's a simplified version of `{ name: { $eq: 'Marcin' } }`</span>
<span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Marcin'</span> <span class="token punctuation">}</span> <span class="token comment">// or { name: { $eq: 'Marcin' } }</span>

<span class="token comment">// Search for a document with a specific id.</span>
<span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function">ObjectId</span><span class="token punctuation">(</span><span class="token number">2</span>jdf8sdnrbwuru8fsd3wrewfd<span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">// All documents where the `amount` field is greater than 5.</span>
<span class="token punctuation">{</span> amount<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token comment">// If `cast` is an array, it will return all the documents which contains &quot;John Smith&quot; as one of the array's elements.</span>
<span class="token punctuation">{</span> cast<span class="token operator">:</span> <span class="token string">&quot;John Smith&quot;</span> <span class="token punctuation">}</span>

<span class="token comment">// When looking for a value within an object we can separate fields with a `.`. The key has to be decorated with a `&quot;`. It can also be used with objects within arrays</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name.last&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Smith&quot;</span> <span class="token punctuation">}</span>

<span class="token comment">// Joining multiple conditions with AND.</span>
<span class="token punctuation">{</span> $and<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span>amount<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">&quot;name.last&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Smith&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>

<span class="token comment">// IN</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tom&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token comment">// for arrays, if any value provided in the filter is found in the array, there's a match</span>

<span class="token comment">// NOT IN</span>
<span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> $nin<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Tom&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><p>A full example: <code>db.{collection}.find({name: 'Marcin'})</code>.</p> <div class="custom-block tip"><p class="custom-block-title">$not vs $ne</p> <p><code>{ amount: { $ne: 5 } }</code> and <code>{ amount: { $not: 5 } }</code> are different. <code>$not</code>
will also return documents that do not even have the &quot;amount&quot; field. <code>$ne</code> will
only return documents that have this field.</p></div> <div class="custom-block tip"><p class="custom-block-title">Regular Expressions</p> <p>The <code>$in</code> operator can be used with regular expressions:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Cars that start with 'F'</span>
db<span class="token punctuation">.</span>cars<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^F</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>There's also a <code>$regex$</code> filter.</p></div> <div class="custom-block tip"><p class="custom-block-title">Conversions</p> <p>Implicit number conversions may occur in our filters. For example, if a value is
an int, but we pass it as a float, it will still work.</p></div> <div class="custom-block tip"><p class="custom-block-title">Arrays and Objects</p> <p>When comparing objects and arrays we need to provide them in full. The internal
elements have to be provided in the same orded as they were stored in the DB.</p></div> <div class="custom-block tip"><p class="custom-block-title">Comments</p> <p>As part of a filter, we can also include the <code>$comment</code> field, which is a string
that explains the filter. These commends end up in the tracing logs.</p></div> <h4 id="expr"><a href="#expr" class="header-anchor">#</a> $expr</h4> <p>There is also a way to filter documents based on operations on various fields
within a document. For example, we could return only those documents where the
difference between the values of fields &quot;totalSeats&quot; and &quot;registeredSeats&quot; is
greater than 5:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    $expr<span class="token operator">:</span> <span class="token punctuation">{</span>
        $gt<span class="token operator">:</span> <span class="token punctuation">[</span>
            $subtract<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;$totalSeats&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$registeredSeats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            NumberDecimal(<span class="token number">5</span>)
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="arrays"><a href="#arrays" class="header-anchor">#</a> Arrays</h4> <p>There are operators to be used with arrays:</p> <ul><li><p><code>{$all: [...]}</code> - matches if an array contains all of the provided elements
(order doesn't matter)</p></li> <li><p><code>{$size: n}</code> - matches if an array contains <code>n</code> elements</p></li> <li><p><code>$elemMatch</code> - multiple conditions to be matched for an array item. It is
useful when the array item is an object</p> <p>Example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Document sample:</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;skils&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;flying&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lvl&quot;</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;driving&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lvl&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">//Query:</span>
db<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> skills<span class="token operator">:</span> <span class="token punctuation">{</span> $elemMatch<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;flying&quot;</span><span class="token punctuation">,</span> lvl<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <div class="custom-block warning"><p class="custom-block-title">$eg</p> <p>The <code>$eq</code> operator can be used as well, but it requires the elements to match
exactly (even order needs to be the same).</p></div> <h4 id="special-cases"><a href="#special-cases" class="header-anchor">#</a> Special Cases</h4> <p>Here are some special cases for queries;</p> <ul><li><p>NULL values</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// returns all documents where the filed is NULL explicitly, and those where it doesn't exist at all</span>
db<span class="token punctuation">.</span>cars<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>To find only explicit NULLs, it's better to use <code>{ $type: &quot;null&quot; }</code></p></li> <li><p>documents where a field doesn't exist</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// $exists: true would return also documents where the field is set to NULL explicitly</span>
db<span class="token punctuation">.</span>cars<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token punctuation">{</span> $exists<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>query by a specific <a href="(https://www.mongodb.com/docs/manual/reference/bson-types/)">BSON
type</a></p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>cars<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token punctuation">{</span> $type<span class="token operator">:</span> <span class="token string">&quot;string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// { $type: 2 } would also work</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NULL</p> <p>&quot;null&quot; is also a type.</p></div></li></ul> <h3 id="projections"><a href="#projections" class="header-anchor">#</a> Projections</h3> <p>Projections are used to specify the fields to return from the source documents.
It's a bit like a <code>SELECT</code> in SQL.</p> <div class="custom-block tip"><p class="custom-block-title">_id</p> <p>The &quot;_id&quot; field is always included unless explicitly disabled with <code>_id: 0</code>.</p></div> <p>Example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> runtime<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">&quot;awards.wins&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
</code></pre></div><p>As a result, 4 fields will be returned per document: &quot;title&quot;, &quot;runtime&quot;,
&quot;award.wins&quot;, &quot;_id&quot; (if they exist in source documents).</p> <p>We can also use projections to exlude just the specified fields:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> runtime<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
</code></pre></div><p>Everything but &quot;title&quot; and &quot;runtime&quot; will be returned.</p> <div class="custom-block warning"><p class="custom-block-title">No mixing</p> <p>We can't mix inclusions/exclusions in one query, unless we're excluding &quot;_id&quot;
while including other fields. In other words, if &quot;_id&quot; is not involved we can
use only &quot;1&quot;s or &quot;0&quot;s in a projection.</p></div> <h4 id="arrays-2"><a href="#arrays-2" class="header-anchor">#</a> Arrays</h4> <p>Arrays have their own projection operators:</p> <ul><li><p><code>$slice</code> - limits the number of items of an array to be returned</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Max two elements in the 'skills' array will be returned per document</span>
db<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skills<span class="token operator">:</span> <span class="token punctuation">{</span> $slice<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>There is also another variant which allows to skip <code>m</code> elementes and return
<code>n</code> elements (<code>[m,n]</code>):</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Return second and third skill only (per document)</span>
db<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skills<span class="token operator">:</span> <span class="token punctuation">{</span> $slice<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>$</code> - a bit similar to <code>$slice</code>, but returns first <code>n</code> items that match the filter</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Returns only players who can drive, the returned documents will have only &quot;driving&quot;</span>
<span class="token comment">// skill present, even if it doesn't come first in the array</span>
db<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> 
    <span class="token punctuation">{</span> skills<span class="token operator">:</span> <span class="token string">&quot;driving&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token punctuation">{</span> <span class="token string">&quot;skills.$&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>$elemMatch</code> - useful for object items in the array. It can further filter the
documents with specified confitions</p> <p>Example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Document samples:</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;skils&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;flying&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lvl&quot;</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;driving&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lvl&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">//Query:</span>
db<span class="token punctuation">.</span>players<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> skills<span class="token operator">:</span> <span class="token punctuation">{</span> $elemMatch<span class="token operator">:</span> <span class="token punctuation">{</span> lvl<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// We'll get both documents back:</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;skils&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;flying&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lvl&quot;</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mark&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Filter vs Projection</p> <p>The filter's <code>$elemMatch</code> is different from the projection's <code>$elemMatch</code>.
The first one affects the number of documents being returned. The latter one
only impacts the content of array field of a document.</p></div></li></ul> <h3 id="read-concern"><a href="#read-concern" class="header-anchor">#</a> Read Concern</h3> <p>This parameter allows us to specify the level of consistency and isolation that
are expected. We can either opt for higher consistency or higher availability.
There is a way to specify a global read concern that will be used by default.</p> <p>Levels:</p> <ul><li><strong>Local</strong> - The query returns data from the instance with no guarantee that the
data has been written to a majority of the replica set members (i.e. may be
rolled back). It's the <strong>default</strong>.</li> <li><strong>Available</strong> - Similar to &quot;Local&quot;, but it cannot be used with causally
consistent sessions and transactions. For sharded clusters, it's the fastest
query.</li> <li><strong>Majority</strong> - returns document that was accepted by the majority of
replicas</li> <li><strong>Linearizable</strong> - The query returns data that reflects all successful
majority-acknowledged writes that completed prior to the start of the read
operation. The query may wait for concurrently executing writes to propagate
to a majority of replica set members before returning results. This query
might take more time, it makes sense to specify a timeout.</li> <li><strong>Snapshot</strong> - For use with multi-document projections.</li></ul> <h3 id="limit"><a href="#limit" class="header-anchor">#</a> Limit</h3> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span><span class="token punctuation">{</span>collection<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="sort"><a href="#sort" class="header-anchor">#</a> Sort</h3> <p>We can provide an object with field names that should be sorted.</p> <p>An example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    rating<span class="token operator">:</span> <span class="token number">-1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>title</code> field will be sorted in an ascending order, while the <code>rating</code> field
will be sorted in a descending order.</p> <p>An example:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// Get ratins in a descending order</span>
db.movies.find(<span class="token punctuation">{</span>rating<span class="token operator">:</span> <span class="token punctuation">{</span>$gte<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span>).sort(<span class="token punctuation">{</span> rating<span class="token operator">:</span> <span class="token number">-1</span> <span class="token punctuation">}</span>)
</code></pre></div><p>We can sort by multiple fields. The order of the fields in the sort object
matters.</p> <h3 id="timeout"><a href="#timeout" class="header-anchor">#</a> Timeout</h3> <p>To specify a timeout we can add <code>maxTimeMS</code> to our query. An example:</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>rating<span class="token operator">:</span> <span class="token punctuation">{</span>$gte<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxTimeMS</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="agregations"><a href="#agregations" class="header-anchor">#</a> Agregations</h3> <p>We can get the count of documents satisfying the query by adding
<code>.count()</code> at the end of the command.</p> <p>We can get a count of all the documents in a collection with <code>countDocuments()</code>.</p> <h3 id="collation"><a href="#collation" class="header-anchor">#</a> Collation</h3> <p>There is a way to fine tune collation of the query, making sure that the proper
language is used, casing, and many more.</p> <h2 id="update"><a href="#update" class="header-anchor">#</a> UPDATE</h2> <p>Documents in the DB can be updated.</p> <div class="custom-block warning"><p class="custom-block-title">_id</p> <p>The <code>_id</code> field cannot be updated.</p></div> <h3 id="write-concern"><a href="#write-concern" class="header-anchor">#</a> Write Concern</h3> <p>Similarly to <a href="#read-concern">Read Concern</a>, we have Write Concern (the <code>w</code>
parameter). Levels:</p> <ul><li><strong>0</strong> - no acknowledgment is requested</li> <li><strong>1</strong> - only acknowledgment from the Primary node is needed</li> <li><strong>(n)</strong> - Primary + (n-1) Secondary nodes.</li> <li><strong>&quot;majority&quot;</strong> - majority of nodes should acknowledge</li></ul> <p>We can also specify a timeout (<code>wtimeout</code>) for write concern. It makes sense to
always specify it. A <code>0</code> value will be indefinite timeout.</p> <h3 id="commands"><a href="#commands" class="header-anchor">#</a> Commands</h3> <p>The update commands are:</p> <ul><li><code>db.{collection}.updateOne()</code> - some fields are updated</li> <li><code>db.{collection}.updateMany()</code></li> <li><code>db.{collection}.replaceOne()</code> - the whole document is replaced</li></ul> <div class="custom-block tip"><p class="custom-block-title">Atomicity</p> <p>Atomicity is at the level of a single document.</p></div> <p>Examples:</p> <p>We can specify the filter for a document to find, and the changes to be made:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> 
        title<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">&quot;The Old Movie&quot;</span> <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The New Movie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// Response:</span>
<span class="token punctuation">{</span>
  acknowledged<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  insertedId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  matchedCount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  modifiedCount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  upsertedCount<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Multiple documents can be updated as well:</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> 
        year<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token number">1994</span> <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">1996</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>A document can be completely replaced, meaning that unspecified fields will be
lost. As a result, only the <code>_id</code> parameter stays the same, the only other
parameter is <code>year</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">replaceOne</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> 
        title<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">&quot;Scarface&quot;</span> <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">1234</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">updateOne</p> <p><code>updateOne</code> will work on the first of the documents returned by the supplied
filter.</p></div> <h4 id="more-options"><a href="#more-options" class="header-anchor">#</a> More Options</h4> <p>With the 3rd parameter we can specify some additional options for the update,
for example for it to be an &quot;upsert&quot;. If no documents are found to be updated, a
new document will be created with the specified fields. It works with
<code>updateOne</code> and <code>updateMany</code>.</p> <p>An example:</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> 
        year<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token number">1994</span> <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;year&quot;</span><span class="token operator">:</span> <span class="token number">2222</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        upsert<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>If there were no movies with <code>year</code> equal to &quot;1994&quot;, no documents will be
updated. However, a single new document will be addded with <code>{year: 2222}</code> as
its content.</p> <div class="custom-block tip"><p class="custom-block-title">$set</p> <p>If we specify some field that did not exist in the original documented, that
field will be added.</p></div> <p>Additionally, for upsert, we can specify <code>$setOnInsert</code>, which defines default
values for a documented in case it needs to be created.</p> <p>Other options include:</p> <ul><li><code>w</code> for <a href="#write-concern">Write Concern</a></li> <li><code>wtimeout</code> for the <a href="#write-concern">timeout</a>.</li> <li><code>arrayFilters</code></li></ul> <h3 id="operators"><a href="#operators" class="header-anchor">#</a> Operators</h3> <p>Update may use the following operators:</p> <ul><li><p><code>$set</code> - sets a value of a field</p></li> <li><p><code>$unset</code> - removes a field</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> $unset<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;takenSeats&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>$inc</code> - increment the field's value</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> $inc<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;takenSeats&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><p>If the field doesn't exist, the starting value is assumed to be 0.
A negative value may be used as well.</p></li> <li><p><code>$mul</code> - multiplies the field's value</p></li></ul> <p>The <a href="https://www.mongodb.com/docs/manual/reference/operator/update/" target="_blank" rel="noopener noreferrer">MongoDB
Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> contain
the complete list of update operators.</p> <h4 id="arrays-3"><a href="#arrays-3" class="header-anchor">#</a> Arrays</h4> <p>Arrays have their own update operators:</p> <ul><li><code>$pop</code> - removes a single value from an array either from the beginning or the
end.</li> <li><code>$pull</code> - removes multiple elements, that meet some condition, from an array</li> <li><code>$push</code> - adds values to the array. There are modifiers that specify the
position of elements, or multiple values to be added.</li></ul> <p>There's also the <code>arrayFilters</code> option that specifies elements that should be
updated in an array (e.g., with <code>$inc</code>).</p> <h2 id="delete"><a href="#delete" class="header-anchor">#</a> DELETE</h2> <p>The commands for deletion are:</p> <ul><li><code>db.{collection}.deleteOne()</code></li> <li><code>db.{collection}.deleteMany()</code></li> <li><code>db.{collection}.remove()</code> - pretty much the same as the two above, there is a
special parameter to control whether just one or many document should be
removed.</li></ul> <p>Indexes are not dropped implicitly. We need to remove them explicitly if we want
that.</p> <p>Similarly to <a href="#update">UPDATE</a>, DELETE supports <a href="#write-concern">Write
Concerns</a>.</p> <h3 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h3> <p>Deleting a single document:</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">&quot;Scarface&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Deleting multiple documents:</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>movies<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rating<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Remove all</p> <p><code>db.{collection}.deleteMany({})</code> will remove all the documents in a collection.</p></div></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technologies/mongodb/mongo-overview.html" class="prev">
        MongoDB Overview
      </a></span> <span class="next"><a href="/technologies/mongodb/free-text-search.html">
        Free Text Search
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/25/2022, 6:40:43 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.22c9c92e.js" defer></script><script src="/assets/js/34.31ac4316.js" defer></script><script src="/assets/js/1.b47f5ac5.js" defer></script><script src="/assets/js/153.e5d9e635.js" defer></script>
  </body>
</html>
