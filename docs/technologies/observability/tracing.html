<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tracing | Marcin Jahn | Tech Notebook</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-ZSM2N36X8P"></script>
    <script>(function() { if (window.location.href.startsWith('http://localhost')) { return; } window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZSM2N36X8P'); })();</script>
    <meta name="description" content="Intorduction to OpenTelemetry tracing">
    <meta property="og:url" content="/technologies/observability/tracing.html">
    <meta property="og:site_name" content="Marcin Jahn | Tech Notebook">
    <meta property="og:title" content="Tracing">
    <meta property="og:description" content="Intorduction to OpenTelemetry tracing">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Marcin Jahn | Tech Notebook">
    <meta property="article:author" content="Marcin Jahn">
    <meta name="theme-color" content="#7D84B2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.d40b778b.css" as="style"><link rel="preload" href="/assets/js/app.305cd9d8.js" as="script"><link rel="preload" href="/assets/js/4.1cfa6f61.js" as="script"><link rel="preload" href="/assets/js/1.edb2ab2a.js" as="script"><link rel="preload" href="/assets/js/34.d77d7187.js" as="script"><link rel="prefetch" href="/assets/js/10.dc6545b5.js"><link rel="prefetch" href="/assets/js/100.b614f95d.js"><link rel="prefetch" href="/assets/js/101.05ad5c11.js"><link rel="prefetch" href="/assets/js/102.661ebf57.js"><link rel="prefetch" href="/assets/js/103.fcbb808c.js"><link rel="prefetch" href="/assets/js/104.6cc1e851.js"><link rel="prefetch" href="/assets/js/105.07a182ac.js"><link rel="prefetch" href="/assets/js/106.5206b197.js"><link rel="prefetch" href="/assets/js/107.93c504a8.js"><link rel="prefetch" href="/assets/js/108.084f3ee9.js"><link rel="prefetch" href="/assets/js/109.defcf4dc.js"><link rel="prefetch" href="/assets/js/11.16ab3733.js"><link rel="prefetch" href="/assets/js/110.bdab5b85.js"><link rel="prefetch" href="/assets/js/111.0c66504a.js"><link rel="prefetch" href="/assets/js/112.a8687c80.js"><link rel="prefetch" href="/assets/js/113.212ee23d.js"><link rel="prefetch" href="/assets/js/114.9d5899dd.js"><link rel="prefetch" href="/assets/js/115.55b02f18.js"><link rel="prefetch" href="/assets/js/116.ee26ba98.js"><link rel="prefetch" href="/assets/js/117.822a038e.js"><link rel="prefetch" href="/assets/js/118.9020f802.js"><link rel="prefetch" href="/assets/js/119.fafd4ad2.js"><link rel="prefetch" href="/assets/js/12.641a04df.js"><link rel="prefetch" href="/assets/js/120.3c7bc15c.js"><link rel="prefetch" href="/assets/js/121.a985747a.js"><link rel="prefetch" href="/assets/js/122.a264ea9a.js"><link rel="prefetch" href="/assets/js/123.294d2a56.js"><link rel="prefetch" href="/assets/js/124.ba9b17dc.js"><link rel="prefetch" href="/assets/js/125.f658e4b8.js"><link rel="prefetch" href="/assets/js/126.dbd95a0f.js"><link rel="prefetch" href="/assets/js/127.6b5f169d.js"><link rel="prefetch" href="/assets/js/128.3208154c.js"><link rel="prefetch" href="/assets/js/129.9395c903.js"><link rel="prefetch" href="/assets/js/13.db8faa28.js"><link rel="prefetch" href="/assets/js/130.c30363b1.js"><link rel="prefetch" href="/assets/js/131.0ac97651.js"><link rel="prefetch" href="/assets/js/132.219a579b.js"><link rel="prefetch" href="/assets/js/133.6f0f76bc.js"><link rel="prefetch" href="/assets/js/134.2e4d205f.js"><link rel="prefetch" href="/assets/js/135.7352d5aa.js"><link rel="prefetch" href="/assets/js/136.0d5260c6.js"><link rel="prefetch" href="/assets/js/137.30ebfd60.js"><link rel="prefetch" href="/assets/js/138.a05d9bc7.js"><link rel="prefetch" href="/assets/js/139.d1b43bbf.js"><link rel="prefetch" href="/assets/js/14.dd40fe72.js"><link rel="prefetch" href="/assets/js/140.7b183f53.js"><link rel="prefetch" href="/assets/js/141.f786d450.js"><link rel="prefetch" href="/assets/js/142.132e09c2.js"><link rel="prefetch" href="/assets/js/143.9315f2c0.js"><link rel="prefetch" href="/assets/js/144.27197b2d.js"><link rel="prefetch" href="/assets/js/145.ad848e74.js"><link rel="prefetch" href="/assets/js/146.afe10bf4.js"><link rel="prefetch" href="/assets/js/147.653da260.js"><link rel="prefetch" href="/assets/js/148.14c7fb28.js"><link rel="prefetch" href="/assets/js/149.4d06ed0f.js"><link rel="prefetch" href="/assets/js/15.418e5643.js"><link rel="prefetch" href="/assets/js/150.28d706d5.js"><link rel="prefetch" href="/assets/js/151.f6423af3.js"><link rel="prefetch" href="/assets/js/152.f42ecd3b.js"><link rel="prefetch" href="/assets/js/153.7a010124.js"><link rel="prefetch" href="/assets/js/154.44756942.js"><link rel="prefetch" href="/assets/js/155.f52197bd.js"><link rel="prefetch" href="/assets/js/156.f7a8d9d3.js"><link rel="prefetch" href="/assets/js/157.6fd92cd1.js"><link rel="prefetch" href="/assets/js/158.77ad08ca.js"><link rel="prefetch" href="/assets/js/159.4b5cfda4.js"><link rel="prefetch" href="/assets/js/16.adca55aa.js"><link rel="prefetch" href="/assets/js/160.d47835fa.js"><link rel="prefetch" href="/assets/js/161.484f89ab.js"><link rel="prefetch" href="/assets/js/162.253cbb1d.js"><link rel="prefetch" href="/assets/js/163.14bcf174.js"><link rel="prefetch" href="/assets/js/164.6365cc03.js"><link rel="prefetch" href="/assets/js/165.2a22a3a7.js"><link rel="prefetch" href="/assets/js/166.b098fc16.js"><link rel="prefetch" href="/assets/js/167.4866ba31.js"><link rel="prefetch" href="/assets/js/168.c7c68d71.js"><link rel="prefetch" href="/assets/js/169.35a1630d.js"><link rel="prefetch" href="/assets/js/17.11d4552a.js"><link rel="prefetch" href="/assets/js/170.961ad797.js"><link rel="prefetch" href="/assets/js/171.7f6868b3.js"><link rel="prefetch" href="/assets/js/172.aabc133b.js"><link rel="prefetch" href="/assets/js/173.706e156e.js"><link rel="prefetch" href="/assets/js/174.6f3e485a.js"><link rel="prefetch" href="/assets/js/175.859379b9.js"><link rel="prefetch" href="/assets/js/176.680ac26b.js"><link rel="prefetch" href="/assets/js/177.f154db3b.js"><link rel="prefetch" href="/assets/js/178.4774999a.js"><link rel="prefetch" href="/assets/js/179.ecb20097.js"><link rel="prefetch" href="/assets/js/18.3e9f2232.js"><link rel="prefetch" href="/assets/js/19.adf81cd8.js"><link rel="prefetch" href="/assets/js/2.7ef33a7b.js"><link rel="prefetch" href="/assets/js/20.8e9d8be9.js"><link rel="prefetch" href="/assets/js/21.8769002f.js"><link rel="prefetch" href="/assets/js/22.0e685557.js"><link rel="prefetch" href="/assets/js/23.bc1b272d.js"><link rel="prefetch" href="/assets/js/24.ad83b2bc.js"><link rel="prefetch" href="/assets/js/25.4cd54044.js"><link rel="prefetch" href="/assets/js/26.0954e0c7.js"><link rel="prefetch" href="/assets/js/27.1529c380.js"><link rel="prefetch" href="/assets/js/28.30c72f60.js"><link rel="prefetch" href="/assets/js/29.09df7941.js"><link rel="prefetch" href="/assets/js/30.d5a90c4e.js"><link rel="prefetch" href="/assets/js/31.77912057.js"><link rel="prefetch" href="/assets/js/32.40e08ad4.js"><link rel="prefetch" href="/assets/js/33.dd86adbd.js"><link rel="prefetch" href="/assets/js/35.b113f6c7.js"><link rel="prefetch" href="/assets/js/36.04109ccf.js"><link rel="prefetch" href="/assets/js/37.e6207d49.js"><link rel="prefetch" href="/assets/js/38.734aac40.js"><link rel="prefetch" href="/assets/js/39.7446bb4d.js"><link rel="prefetch" href="/assets/js/40.9a9d2cd3.js"><link rel="prefetch" href="/assets/js/41.4b051e7c.js"><link rel="prefetch" href="/assets/js/42.a6e2273e.js"><link rel="prefetch" href="/assets/js/43.338112b6.js"><link rel="prefetch" href="/assets/js/44.b06416af.js"><link rel="prefetch" href="/assets/js/45.a2418a8c.js"><link rel="prefetch" href="/assets/js/46.3d42bbbb.js"><link rel="prefetch" href="/assets/js/47.0ca5be39.js"><link rel="prefetch" href="/assets/js/48.3de6dc6c.js"><link rel="prefetch" href="/assets/js/49.68b04c67.js"><link rel="prefetch" href="/assets/js/5.549b4862.js"><link rel="prefetch" href="/assets/js/50.cd3523b6.js"><link rel="prefetch" href="/assets/js/51.cf0f9311.js"><link rel="prefetch" href="/assets/js/52.26057cfa.js"><link rel="prefetch" href="/assets/js/53.d44b4e79.js"><link rel="prefetch" href="/assets/js/54.d9ef2625.js"><link rel="prefetch" href="/assets/js/55.fa422450.js"><link rel="prefetch" href="/assets/js/56.5c3d322b.js"><link rel="prefetch" href="/assets/js/57.78e2193d.js"><link rel="prefetch" href="/assets/js/58.e4dce92a.js"><link rel="prefetch" href="/assets/js/59.cb2bd608.js"><link rel="prefetch" href="/assets/js/6.ec5930f7.js"><link rel="prefetch" href="/assets/js/60.97715138.js"><link rel="prefetch" href="/assets/js/61.a5119894.js"><link rel="prefetch" href="/assets/js/62.0068c6b7.js"><link rel="prefetch" href="/assets/js/63.9612e4d8.js"><link rel="prefetch" href="/assets/js/64.17417bda.js"><link rel="prefetch" href="/assets/js/65.8a0bebda.js"><link rel="prefetch" href="/assets/js/66.00d59575.js"><link rel="prefetch" href="/assets/js/67.3f059c94.js"><link rel="prefetch" href="/assets/js/68.f4074b4d.js"><link rel="prefetch" href="/assets/js/69.105797a0.js"><link rel="prefetch" href="/assets/js/7.d7443d92.js"><link rel="prefetch" href="/assets/js/70.471d3fef.js"><link rel="prefetch" href="/assets/js/71.c973592f.js"><link rel="prefetch" href="/assets/js/72.6670ee4e.js"><link rel="prefetch" href="/assets/js/73.5574e51c.js"><link rel="prefetch" href="/assets/js/74.1e33859d.js"><link rel="prefetch" href="/assets/js/75.86222be2.js"><link rel="prefetch" href="/assets/js/76.cb845dd5.js"><link rel="prefetch" href="/assets/js/77.c4981ce7.js"><link rel="prefetch" href="/assets/js/78.7988972a.js"><link rel="prefetch" href="/assets/js/79.0d2f1666.js"><link rel="prefetch" href="/assets/js/8.38c2a278.js"><link rel="prefetch" href="/assets/js/80.56d66164.js"><link rel="prefetch" href="/assets/js/81.fd2f0354.js"><link rel="prefetch" href="/assets/js/82.00b5154c.js"><link rel="prefetch" href="/assets/js/83.5e2b7d34.js"><link rel="prefetch" href="/assets/js/84.de09646c.js"><link rel="prefetch" href="/assets/js/85.7a285974.js"><link rel="prefetch" href="/assets/js/86.8a887163.js"><link rel="prefetch" href="/assets/js/87.5f605acf.js"><link rel="prefetch" href="/assets/js/88.05ebfd53.js"><link rel="prefetch" href="/assets/js/89.5eeceabf.js"><link rel="prefetch" href="/assets/js/9.9a40a415.js"><link rel="prefetch" href="/assets/js/90.a95468ec.js"><link rel="prefetch" href="/assets/js/91.da9df6a3.js"><link rel="prefetch" href="/assets/js/92.90123533.js"><link rel="prefetch" href="/assets/js/93.28790e64.js"><link rel="prefetch" href="/assets/js/94.68c713c5.js"><link rel="prefetch" href="/assets/js/95.2a35e4db.js"><link rel="prefetch" href="/assets/js/96.b4f2bc29.js"><link rel="prefetch" href="/assets/js/97.fb46aaee.js"><link rel="prefetch" href="/assets/js/98.7e991e10.js"><link rel="prefetch" href="/assets/js/99.1cc7e689.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d40b778b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar boxshadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Marcin Jahn | Tech Notebook</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/programming/" class="nav-link">
  Programming
</a></div><div class="nav-item"><a href="/technologies/" class="nav-link router-link-active">
  Technologies
</a></div><div class="nav-item"><a href="/projects/" class="nav-link">
  Projects
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div> <span class="external-services" data-v-6d74c91a><a target="_blank" href="https://www.linkedin.com/in/marcin-jahn-63a9b915b/?locale=en_US" data-v-06466073 data-v-6d74c91a><img src="/img/linkedin.webp" data-v-06466073></a><a target="_blank" href="https://github.com/marcinjahn" data-v-06466073 data-v-6d74c91a><img src="/img/github.webp" data-v-06466073></a><a target="_blank" href="https://www.cirro.services" data-v-06466073 data-v-6d74c91a><span data-v-06466073>cirro.services</span></a></span> <!----></nav>  <ul class="sidebar-links"><li><a href="/technologies/" aria-current="page" class="sidebar-link">/technologies/</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/network.webp"></span> <span>Networking</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/security.webp"></span> <span>Security</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/linux.webp"></span> <span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/kubernetes.webp"></span> <span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span class="img-container"><img src="/sidebar-imgs/observability.webp"></span> <span>Observability</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/technologies/observability/tracing.html" aria-current="page" class="active sidebar-link">Tracing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technologies/observability/tracing.html#architecture" class="sidebar-link">Architecture</a></li><li class="sidebar-sub-header"><a href="/technologies/observability/tracing.html#traces" class="sidebar-link">Traces</a></li><li class="sidebar-sub-header"><a href="/technologies/observability/tracing.html#collector" class="sidebar-link">Collector</a></li><li class="sidebar-sub-header"><a href="/technologies/observability/tracing.html#tips" class="sidebar-link">Tips</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/sql-server.webp"></span> <span>SQL Server</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/mongodb.webp"></span> <span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/git.webp"></span> <span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/ansible.webp"></span> <span>Ansible</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/azure.webp"></span> <span>Azure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/gcp.webp"></span> <span>Google Cloud</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span class="img-container"><img src="/sidebar-imgs/blockchain.webp"></span> <span>Blockchain</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content"><div class="content__default"><h1 id="tracing"><a href="#tracing" class="header-anchor">#</a> Tracing</h1> <p>Tracing is one of the pillards of <strong>Observability</strong>. It is analogous to stack
trace of a program, but in the distributed world of (micro)services.</p> <p>First, it started as seperate efforts of various entites, nowadays it is
standardized under the <a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">Open Telemetry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> initiative (a
part of <a href="https://www.cncf.io/" target="_blank" rel="noopener noreferrer">CNCF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>A <strong>trace</strong> is a collection of <strong>spans</strong> - time-bound operations that are part
of some scenario. Most often these are network calls, but they can also
represent other things. We could  actually represent a &quot;traditional&quot; call stack
of a single process with spans of a trace. Although possible, it's not the
recommended approach. It is alright though to include the most important parts
of a single process (especially the ones that take majority of time of a trace)
in a trace.</p> <p>Here's an illustration that represents tracing, found in the <a href="https://www.jaegertracing.io/docs/1.41/architecture/" target="_blank" rel="noopener noreferrer">Jaeger
Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/jaeger-example.75276063.png" alt="Jaeger Example"></p> <h2 id="architecture"><a href="#architecture" class="header-anchor">#</a> Architecture</h2> <p>Most often, the general tracing setup looks like this:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>The <em>SDK</em> and <em>Collector</em> are a part of OpenTelemetry. The UI needs to be
something that conforms to the OpenTelemetry standard, e.g.
<a href="https://www.jaegertracing.io" target="_blank" rel="noopener noreferrer">Jaeger<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The choice of teh database is dictated
by both the Collector and UI, since both theses entities will access the
database.</p> <p>The architecture could differ, some new actors could be added (like agents), or
removed (e.g., Jaeger could be run with in-memory database).</p> <p>Here's how it could look like with Agent added:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>The purpose of having an Agent is to relax the burden of network communication
between the App and the Collector. The communication with the Collector could be
slow. The communication between the App and the Agent should be fast (Agent
could be a side-car of our App).</p> <p>Other than that, the Agent is actually the same app as Collector. It has a bunch
of configuration that could be useful for us (explained down below).</p> <h3 id="sdk"><a href="#sdk" class="header-anchor">#</a> SDK</h3> <p>Looking at a single app, the SDK works in a pipeline, like this:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><h4 id="instrumentation"><a href="#instrumentation" class="header-anchor">#</a> Instrumentation</h4> <p>Instrumentation is the origin of every span. We can create spans manually, or
automatically via auto-instrumentation. Auto-instrumentation is specific to
various protocols/frameworks. E.g., we could install auto-instrumentation for
Express or Nest.js, and it will automatically create spans for every incoming
request. Many frameworks have some accompanying auto-instrumentation (often
various versions for the same framework).</p> <p>Spans may have some additional metadata attached. These are <strong>Resources</strong>. We
can add some data to every span, enriching them. Examples include:</p> <ul><li>git commit ID of the running process</li> <li>container ID of the running process</li></ul> <p>There are also additional apckages called <strong>Detectors</strong>. They are able to
automatically attach some environment-specific data to our Resources. Examples
could include Azure Detector or AWS Detector. These would automatically include
some cloud-specific data to our spans. Similarly, git Detector would attach
commit ID (if <code>.git</code> directory is part of the deployment). A detector could also
discover the name of our service (e.g., based on <code>package.json</code>).</p> <p>All the setup of tracing is wrapped in a provied - e.g. <code>NodeProvider</code> for
Node.js apps.</p> <h5 id="custom-intrumentation"><a href="#custom-intrumentation" class="header-anchor">#</a> Custom Intrumentation</h5> <p>The SDK allows us to implement custom intrumentations. That may come useful when
some framework or library does not have any available instrumentations.
Auto-intrumentation helps in keeping the code clean of tracing logic. Manual
instrumentation on the other hand, &quot;pollutes&quot; the code with non-business logic.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Sometimes, manual instrumentation is the right choice! It's only the cases that
are non-seldom and well-defined that benefit the most from auto-instrumentation.</p> <p>It's often best to start with manual instrumentation and create
auto-instrumentation based on it later on.</p></div> <h4 id="processors"><a href="#processors" class="header-anchor">#</a> Processors</h4> <p>Processors sit between the instrumentation and exporters. Most often, they are
used for batching. Out-of-the-box, the following processors are available:</p> <ul><li>SimpleProcessor - just relays every single span to the Exporter</li> <li>BatchProcessor - batches spans and relays these batches to the Exporter</li> <li>NoOpProcessor - drops every span, nothing will be sent</li> <li>MultipleProcessor - allows to compose multiple processors in a single pipeline</li></ul> <h4 id="propagation"><a href="#propagation" class="header-anchor">#</a> Propagation</h4> <p>In some cases, it is difficult to attach tracing metadata in the messaging with
other services. WebSockets could be an example of such messaging. WebSockets do
not support any way of sending metadata, like headers in HTTP. Because of that,
data like <code>traceId</code> needs to be sent as part of application message. The SDK
comes with a propagator that can both inject and extract that metadata from the
messages. Both the sender and the receiver need to be aware of this metadata
being there.</p> <p>Another example could be Redis - it also does not support metadata.</p> <h5 id="formats"><a href="#formats" class="header-anchor">#</a> Formats</h5> <p>There are a bunch of formats of tracing that have emerged since tracing was
born. The one used by default by the OpenTelemetry SDK is the <a href="https://www.w3.org/TR/trace-context/" target="_blank" rel="noopener noreferrer">W3C Trace
Context<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. In short, it includes tracing
information (like trace ID) in an HTTP header called <code>traceparent</code>.</p> <p>There are also other standards, like Jaeger and B3. These are considered legacy,
and shouldn't be used by new projects. However, there are cases where we want to
integrate with older systems that still use the proprietary format. The
OpenTelemetry SDK supports us with that via propagators. By default, the W3C propagator is used. A propagator basically does two things:</p> <ul><li><strong>extracts</strong> tracing metadata from the incoming communication (like an HTTP request)</li> <li><strong>injects</strong> tracing metadata into the messages going out</li></ul> <p>A propagator really needs to implement just these 2 methods, and it can be used in tracing initialization.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It might happen that only one side of propagation is needed, e.g. extraction. We
might be integrating with some system that sends us tracing headers in Jaeger
fomat, but we might not want to propagate tracing in that format further on,
since W3C is the format we want to use.</p> <p>OpenTelemetry does not have any APIs to enable/disable specific side of
propagation. Instead, we'd need to implement some kind of &quot;wrapper&quot; that blocks
the functionality we don't need.</p> <p>More on that
<a href="https://github.com/open-telemetry/opentelemetry-specification/issues/3153" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h2 id="traces"><a href="#traces" class="header-anchor">#</a> Traces</h2> <p>Traces are composed of spans. Spans are composed of:</p> <ul><li>timestamps (start and end)</li> <li>origin service</li> <li>events - things that happened during the span, but do not deserve their own
separate span. Potentially, that could be due to the fact that they do not
have start-end timestamps.</li> <li>attributes - key-value pairs of meta-data (similar to Resources, but we can
attach them ad-hoc, isntead of predefining for all spans)</li> <li>errors - if an exception occurs during the span, the error message could be added.</li> <li>traceId - each span belongs to some trace.</li></ul> <p>An important concept is how traceId is being shared among services. There always
is some root service where the journey starts. That service generates the
traceId. Any call to other services will include that traceId. This way, when
these downstream services record their spans, they will attach the traceId that
they received.</p> <p>Traces are being sent by all the services to the collector (could be via Agents,
but it doens't matter in this context). Interestingly, a root service (or any
other service in the chain) may decide not to trace (e.g. due to sampling
configuration). That decision may be transmitted to the &quot;child&quot; services. If
these services are properly configured, they will respect the upstream decision,
and will not trace the traffic.</p> <h2 id="collector"><a href="#collector" class="header-anchor">#</a> Collector</h2> <p>The collector works very similarly to the SDK in an app. It has a pipeline:</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>There could be many receivers, processors, and exporters. Instead of
initializing the pipeline in code (like we do with the SDK), we do it in YAML.</p> <p>Processors include things like Sampling.</p> <h3 id="sampling"><a href="#sampling" class="header-anchor">#</a> Sampling</h3> <p>One of the most important things to configure in a Collector is <strong>Sampling</strong>. In
bigger systems, the amount of traces that we collect could have significant
impact on the costs and performance.</p> <p>In general, the following samping strategies should be applied:</p> <ul><li><strong>100%</strong> sampling - when we don't have a lot of traffic in the systems, it might
be alright to just log everything</li> <li><strong>20-50%</strong> - debugging issues - this amount of traces should be enough to debug
some system-wide issue</li> <li><strong>5-10%</strong> - typical setup - it should be enough for general monitoring of the
system. If something fails, we'll record 10% of failures</li> <li><strong>5%</strong> - understanding the system architecture</li></ul> <p>The sampling may be configured with more details, like logging 10% of traces
uncless there's an error - then, we'd always log it.</p> <p>Sampling can be done on two levels:</p> <ul><li>app (SDK) - <strong>head-sampling</strong> - apps decide what to send</li> <li>collector - <strong>tail-sampling</strong> - apps send everything</li></ul> <p>Some mix of the two could also be utilized.</p> <p>The difference between the two is about the point in time when the decision to
sample is being made.</p> <h4 id="head-sampling"><a href="#head-sampling" class="header-anchor">#</a> Head-Sampling</h4> <p>In head-sampling, when the root service decides not to trace some request, it
will ask downstream services not to trace as well. If, during that journey, some
error occurs, trafific will not be traced (unlesss some child service is
configured otherwise, but it will not help us with missing spans from the parent
that did not want to trace).</p> <p>Service that makes the sampling decision makes it <em>before</em> a potential issue
occurs. It's non-ideal.</p> <div class="custom-block tip"><p class="custom-block-title">0%</p> <p>In tail-sampling, even with 0% sampling configured, services will still transfer
tracing header between each other - that's needed for downstream services
to know that they should not send traces to the collector!</p></div> <h3 id="tail-sampling"><a href="#tail-sampling" class="header-anchor">#</a> Tail-Sampling</h3> <p>In tail-sampling, the collector has access to the whole trace and may decide
whether it wants to store it or not. The decision can be made based on various
factors:</p> <ul><li>span(s) latency</li> <li>some attribute values (e.g. HTTP status codes)</li> <li>span(s) status codes (since traces can have errors attached)</li> <li>rate limiting (e.g. max 50/s)</li> <li>probabilistic (e.g. 50%)</li></ul> <div class="custom-block tip"><p class="custom-block-title">Decision time</p> <p>Spans arrive at the collector asynchronously. The collector cannot really tell
if at some point in time all the spans composing a given trace were already
collected. This is why one of the parameters affecting sampling is <em>decision
time</em>. This is the timespan that the collector should allow for incoming spans
to come in (starting from the first one that came in) until the sampling
decision is made.
Before making the decision to sample, spans are stored in-memory.</p></div> <div class="custom-block warning"><p class="custom-block-title">Load Balancing</p> <p>In bigger systems, with multiple collector replicas, it's important to configure
trace affinity, so that one collector wil receive all the spans belonging to a
single trace. That way, sampling decisions may be better informed.</p></div> <hr> <p>Head vs tail sampling:</p> <ul><li>when we only want to log errors - Tail</li> <li>when we want to log only traces with latency problems - Tail</li> <li>when we want to log only specific routes - Head</li></ul> <h2 id="tips"><a href="#tips" class="header-anchor">#</a> Tips</h2> <ul><li>In Node.js, tracing needs to be enabled before even importing any other
non-tracing related dependencies!</li></ul></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technologies/kubernetes/helm.html" class="prev">
        Helm
      </a></span> <span class="next"><a href="/technologies/sql-server/">
        Overview
      </a>
      →
    </span></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/12/2023, 5:06:33 PM</span></div></footer> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.305cd9d8.js" defer></script><script src="/assets/js/4.1cfa6f61.js" defer></script><script src="/assets/js/1.edb2ab2a.js" defer></script><script src="/assets/js/34.d77d7187.js" defer></script>
  </body>
</html>
