---
title: Overview and Middleware
description: General information about ASP.NET Core and middleware
tags: .net, asp.net, c#
lang: en-US
---

# ASP.NET Core Overview

ASP.NET Core allows to build the following main kinds of applications:

- Razor Pages
- Web APIs

Both these application kinds use the ASP.NET Core MVC framework behind the
scenes.

A common thing is the `HttpContext` object, which flows through the middleware
containing all the infromation about the request, with potential additions from
the middleware. The response is also added to the `HttpContext` object.

## ActionResult

The following results can be returned from controllers:

- `PageResult` - HTML for a Razor Pages framework page
- `ViewResult` - HTML for an MVC framework controller
- `RedirectToPageResult` - returns 302
- `RedirectResult` - sends 302, but the target does not have to be a Razor Page
- `FileResult` - returns a file
- `ContentResult` - returns a provided string (not to be used with Razor Pages)
- `StatusCodeResult` - specified HTTP status code, optionally with some payload
  (not to be used with Razor Pages)
- `NotFoundResult` - 404

Some of the results have helper methods (such as `Page()` instead of `return new
PageResult()`);

## Middleware

The **middleware** are C# classes or functions that handle HTTP requests and
responses. They are chained together, forming a pipeline, similarly to how
`HTTPHandler`s can be chained in an `HTTPClient`.

All the requests pass through the middleware, so it's the right place to handle
common cross-cutting concerns. The middleware can process the request/response,
optionally modify it and pass on in the pipeline.

Requests/responses travel through the pipeline as `HttpContext` objects that can
be modified.

Middleware components should be small and handle just one responsibility.

Middleware can short-circuit the request causing it not to be passed to the
middleware parts behind it. If some middleware receives a request, it will also
receive a response going back.

::: tip 404
ASP.NET Core adds a middleware returning `404` in the end of the pipeline.
If none of our middleware handles the requests, that `404` one handles it.
:::

Middleware is added to the `WebApplication` (.NET 6) or to the
`IApplicationBuilder` (prior to .NET 6).

In general, middleware is added like this:

```cs
app.UseMiddleware<WelcomePageMiddleware>();
```

Often, middleware comess with extension methods that are more readable:

```cs
app.UseWelcomePage(); // calls the above behind the scenes
```

::: tip Use
Methods starting with `Use` are a convention for adding middleware.
:::

### Errors

The error handling should be added to the pipeline as early as possible to
handle all errors. Useful middleware:

- `DeveloperExceptionPageMiddleware` - displays stacktrace of an exception
- `ExceptionHandlerMiddleware` - alternative to the above, more suitable for
  production
- `StatusCodePagesMiddleware` - transforms raw error codes into some meaningful
  error-pages, it can redirect to different pages for different errors. It
  executes only if response payload is empty, making it possible to use it
  together with the `ExceptionHandlerMiddleware`.


::: tip Error Loop
In case of an exception, the `ExceptionHandlerMiddleware` reexecutes the
middleware pipeline by redirecting to `/Error` (redirecting internally, not with
30X). If during that redirection another exeption is thrown, a raw error will be
returned to the user.
:::

### EndpointMiddleware

The actual content is generated by various `EndpointMiddleware`.